import { Component, ElementRef, HostListener, ViewChild, ViewContainerRef } from '@angular/core';
import { Subject, Subscription } from 'rxjs';
import { PoChartAxisXLabelArea, PoChartPadding } from './helpers/po-chart-default-values.constant';
import { PoDefaultColors } from '../../services/po-color/po-colors.constant';
import { PoChartBaseComponent } from './po-chart-base.component';
import { PoChartType } from './enums/po-chart-type.enum';
import * as i0 from "@angular/core";
import * as i1 from "../../services/po-color/po-color.service";
import * as i2 from "./services/po-chart-svg-container.service";
import * as i3 from "./services/po-chart-maths.service";
import * as i4 from "@angular/common";
import * as i5 from "./po-chart-container/po-chart-container.component";
import * as i6 from "./po-chart-legend/po-chart-legend.component";
import * as i7 from "./directives/po-resize-observer.directive";
const _c0 = ["chartContainer"];
const _c1 = ["chartHeader"];
const _c2 = ["chartLegend"];
const _c3 = ["chartWrapper"];
function PoChartComponent_ng_template_7_Template(rf, ctx) { }
function PoChartComponent_div_9_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainer(0);
} }
function PoChartComponent_div_9_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div");
    i0.ɵɵtemplate(1, PoChartComponent_div_9_ng_container_1_Template, 1, 0, "ng-container", 9);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    i0.ɵɵnextContext();
    const _r5 = i0.ɵɵreference(11);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("ngTemplateOutlet", _r5);
} }
function PoChartComponent_ng_template_10_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelement(0, "po-chart-legend", 10, 11);
} if (rf & 2) {
    const ctx_r6 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-series", ctx_r6.chartSeries)("p-type", ctx_r6.type);
} }
/**
 * @docsExtends PoChartBaseComponent
 *
 * @example
 *
 * <example name="po-chart-basic" title="PO Chart Basic">
 *  <file name="sample-po-chart-basic/sample-po-chart-basic.component.html"> </file>
 *  <file name="sample-po-chart-basic/sample-po-chart-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-chart-labs" title="PO Chart Labs">
 *  <file name="sample-po-chart-labs/sample-po-chart-labs.component.html"> </file>
 *  <file name="sample-po-chart-labs/sample-po-chart-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-chart-coffee-ranking" title="PO Chart - Coffee Ranking">
 *  <file name="sample-po-chart-coffee-ranking/sample-po-chart-coffee-ranking.component.html"> </file>
 *  <file name="sample-po-chart-coffee-ranking/sample-po-chart-coffee-ranking.component.ts"> </file>
 * </example>
 */
export class PoChartComponent extends PoChartBaseComponent {
    constructor(colorService, changeDetector, containerService, componentFactoryResolver, elementRef, mathsService, renderer) {
        super(colorService);
        this.colorService = colorService;
        this.changeDetector = changeDetector;
        this.containerService = containerService;
        this.componentFactoryResolver = componentFactoryResolver;
        this.elementRef = elementRef;
        this.mathsService = mathsService;
        this.renderer = renderer;
        this.calculatedComponentRefElement = false;
        this.calculatedSvgContainerElement = false;
        this.initialized = false;
        this.windowResizeListener = new Subject();
        this.subscription = new Subscription();
        this.mappings = {};
        this.onResize = () => {
            this.getSvgContainerSize();
            this.windowResizeListener.next({});
        };
    }
    ngAfterViewInit() {
        this.initialized = true;
        this.getSvgContainerSize();
    }
    ngDoCheck() {
        const charWrapperWidth = this.chartWrapper.nativeElement.offsetWidth;
        const isDynamicChart = this.getComponentType(this.type);
        // Permite que o chart seja calculado na primeira vez que o componente torna-se visível,
        // evitando com isso, problemas com Tabs ou Divs que iniciem escondidas.
        // Quando modificada a estrutura dos gráficos do tipo circular isto será melhorado.
        if (charWrapperWidth && this.initialized && !isDynamicChart && !this.calculatedSvgContainerElement) {
            this.getSvgContainerSize();
            this.calculatedSvgContainerElement = true;
        }
    }
    ngOnDestroy() {
        this.subscription.unsubscribe();
        this.removeWindowResizeListener();
    }
    resizeAction() {
        this.getSvgContainerSize();
        this.windowResizeListener.next({});
        this.changeDetector.detectChanges();
    }
    ngOnInit() {
        this.getSvgContainerSize();
    }
    rebuildComponentRef() {
        if (this.componentRef) {
            this.componentRef.destroy();
        }
    }
    calculateAxisXLabelArea() {
        const axisXLabels = this.chartType === PoChartType.Bar ? this.categories : this.chartSeries;
        return this.getAxisXLabelArea(this.mathsService.getLongestDataValue(axisXLabels, this.chartType, this.options));
    }
    getSvgContainerSize() {
        let axisXLabelWidth;
        const { chartHeaderHeight, chartLegendHeight, chartWrapperWidth } = this.getChartMeasurements();
        if (!this.isTypeCircular) {
            axisXLabelWidth = this.calculateAxisXLabelArea();
        }
        this.svgContainerSize = {
            ...this.containerService.calculateSVGContainerMeasurements(this.height, chartWrapperWidth, chartHeaderHeight, chartLegendHeight),
            axisXLabelWidth
        };
    }
    chartLegendHeight(chartLegend) {
        return chartLegend ? chartLegend.nativeElement.offsetHeight : 0;
    }
    createComponent() {
        const componentType = this.getComponentType(this.type);
        const factory = this.componentFactoryResolver.resolveComponentFactory(componentType);
        this.componentRef = this.chartContainer.createComponent(factory);
        const instance = this.componentRef.instance;
        this.setComponentRefProperties(instance);
        return instance;
    }
    dynamicComponentSetting() {
        const instance = this.createComponent();
        this.setResizeListenerSubscribe(instance);
        this.changeDetector.detectChanges();
        this.setClickSubscribe(instance);
        this.setHoverSubscribe(instance);
    }
    getAxisXLabelArea(axisXLabel) {
        const labelPoChartPadding = PoChartPadding / 3;
        const spanElement = this.renderer.createElement('span');
        this.renderer.addClass(spanElement, 'po-chart-axis-x-label');
        spanElement.innerHTML = axisXLabel;
        this.renderer.appendChild(this.elementRef.nativeElement, spanElement);
        const axisXLabelWidth = Math.ceil(spanElement.offsetWidth) + labelPoChartPadding;
        this.renderer.removeChild(this.elementRef.nativeElement, spanElement);
        return axisXLabelWidth > PoChartAxisXLabelArea ? axisXLabelWidth : PoChartAxisXLabelArea;
    }
    getComponentType(typeName) {
        return this.mappings[typeName];
    }
    getChartMeasurements() {
        const chartWrapperWidth = this.chartWrapper.nativeElement.offsetWidth;
        const chartHeaderHeight = this.chartHeader.nativeElement.offsetHeight;
        const chartLegendHeight = this.chartLegendHeight(this.chartLegend);
        return { chartWrapperWidth, chartHeaderHeight, chartLegendHeight };
    }
    removeWindowResizeListener() {
        if (this.onResize) {
            this.onResize = () => { };
        }
    }
    setComponentRefProperties(instance) {
        const { chartHeaderHeight, chartLegendHeight, chartWrapperWidth } = this.getChartMeasurements();
        instance.chartHeader = chartHeaderHeight;
        instance.chartLegend = chartLegendHeight;
        instance.chartWrapper = chartWrapperWidth;
        instance.colors = PoDefaultColors[0];
        instance.height = this.height;
        instance.type = this.type;
        instance.series = this.chartSeries || [];
    }
    setClickSubscribe(instance) {
        this.subscription.add(instance.onSerieClick.subscribe(event => {
            this.onSeriesClick(event);
        }));
    }
    setHoverSubscribe(instance) {
        this.subscription.add(instance.onSerieHover.subscribe(event => {
            this.onSeriesHover(event);
        }));
    }
    setResizeListenerSubscribe(instance) {
        this.subscription.add(this.windowResizeListener.subscribe(() => {
            const measuresForComponentRef = this.getChartMeasurements();
            instance.chartWrapper = measuresForComponentRef.chartWrapperWidth;
            instance.chartHeader = measuresForComponentRef.chartHeaderHeight;
            instance.chartLegend = measuresForComponentRef.chartLegendHeight;
        }));
    }
}
PoChartComponent.ɵfac = function PoChartComponent_Factory(t) { return new (t || PoChartComponent)(i0.ɵɵdirectiveInject(i1.PoColorService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i2.PoChartSvgContainerService), i0.ɵɵdirectiveInject(i0.ComponentFactoryResolver), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i3.PoChartMathsService), i0.ɵɵdirectiveInject(i0.Renderer2)); };
PoChartComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoChartComponent, selectors: [["po-chart"]], viewQuery: function PoChartComponent_Query(rf, ctx) { if (rf & 1) {
        i0.ɵɵviewQuery(_c0, 7, ViewContainerRef);
        i0.ɵɵviewQuery(_c1, 7);
        i0.ɵɵviewQuery(_c2, 5, ElementRef);
        i0.ɵɵviewQuery(_c3, 7);
    } if (rf & 2) {
        let _t;
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.chartContainer = _t.first);
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.chartHeader = _t.first);
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.chartLegend = _t.first);
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.chartWrapper = _t.first);
    } }, hostBindings: function PoChartComponent_HostBindings(rf, ctx) { if (rf & 1) {
        i0.ɵɵlistener("resize", function PoChartComponent_resize_HostBindingHandler() { return ctx.onResize(); }, false, i0.ɵɵresolveWindow);
    } }, features: [i0.ɵɵInheritDefinitionFeature], decls: 12, vars: 7, consts: [[1, "po-chart-wrapper", 3, "p-resize-observer"], ["chartWrapper", ""], [1, "po-chart-header"], ["chartHeader", ""], [1, "po-chart-title"], [3, "p-options", "p-type", "p-series", "p-categories", "p-container-size", "p-serie-click", "p-serie-hover"], ["chartContainer", ""], [4, "ngIf"], ["chartLegendGroup", ""], [4, "ngTemplateOutlet"], [3, "p-series", "p-type"], ["chartLegend", ""]], template: function PoChartComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵelementStart(0, "div", 0, 1);
        i0.ɵɵlistener("p-resize-observer", function PoChartComponent_Template_div_p_resize_observer_0_listener() { return ctx.resizeAction(); });
        i0.ɵɵelementStart(2, "div", 2, 3)(4, "div", 4);
        i0.ɵɵtext(5);
        i0.ɵɵelementEnd()();
        i0.ɵɵelementStart(6, "po-chart-container", 5);
        i0.ɵɵlistener("p-serie-click", function PoChartComponent_Template_po_chart_container_p_serie_click_6_listener($event) { return ctx.onSeriesClick($event); })("p-serie-hover", function PoChartComponent_Template_po_chart_container_p_serie_hover_6_listener($event) { return ctx.onSeriesHover($event); });
        i0.ɵɵelementEnd();
        i0.ɵɵtemplate(7, PoChartComponent_ng_template_7_Template, 0, 0, "ng-template", null, 6, i0.ɵɵtemplateRefExtractor);
        i0.ɵɵtemplate(9, PoChartComponent_div_9_Template, 2, 1, "div", 7);
        i0.ɵɵelementEnd();
        i0.ɵɵtemplate(10, PoChartComponent_ng_template_10_Template, 2, 2, "ng-template", null, 8, i0.ɵɵtemplateRefExtractor);
    } if (rf & 2) {
        i0.ɵɵadvance(5);
        i0.ɵɵtextInterpolate(ctx.title);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("p-options", ctx.options)("p-type", ctx.chartType)("p-series", ctx.chartSeries)("p-categories", ctx.categories)("p-container-size", ctx.svgContainerSize);
        i0.ɵɵadvance(3);
        i0.ɵɵproperty("ngIf", (ctx.options == null ? null : ctx.options.legend) !== false);
    } }, dependencies: [i4.NgIf, i4.NgTemplateOutlet, i5.PoChartContainerComponent, i6.PoChartLegendComponent, i7.PoResizeObserverDirective], encapsulation: 2 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoChartComponent, [{
        type: Component,
        args: [{ selector: 'po-chart', template: "<div #chartWrapper class=\"po-chart-wrapper\" (p-resize-observer)=\"resizeAction()\">\n  <div #chartHeader class=\"po-chart-header\">\n    <div class=\"po-chart-title\">{{ title }}</div>\n  </div>\n\n  <po-chart-container\n    [p-options]=\"options\"\n    [p-type]=\"chartType\"\n    [p-series]=\"chartSeries\"\n    [p-categories]=\"categories\"\n    [p-container-size]=\"svgContainerSize\"\n    (p-serie-click)=\"onSeriesClick($event)\"\n    (p-serie-hover)=\"onSeriesHover($event)\"\n  ></po-chart-container>\n\n  <!-- Inje\u00E7\u00E3o de gr\u00E1ficos do tipo gauge. Remover na deprecia\u00E7\u00E3o.  -->\n  <ng-template #chartContainer></ng-template>\n\n  <div *ngIf=\"options?.legend !== false\">\n    <ng-container *ngTemplateOutlet=\"chartLegendGroup\"></ng-container>\n  </div>\n</div>\n\n<ng-template #chartLegendGroup>\n  <po-chart-legend #chartLegend [p-series]=\"chartSeries\" [p-type]=\"type\"> </po-chart-legend>\n</ng-template>\n" }]
    }], function () { return [{ type: i1.PoColorService }, { type: i0.ChangeDetectorRef }, { type: i2.PoChartSvgContainerService }, { type: i0.ComponentFactoryResolver }, { type: i0.ElementRef }, { type: i3.PoChartMathsService }, { type: i0.Renderer2 }]; }, { chartContainer: [{
            type: ViewChild,
            args: ['chartContainer', { read: ViewContainerRef, static: true }]
        }], chartHeader: [{
            type: ViewChild,
            args: ['chartHeader', { static: true }]
        }], chartLegend: [{
            type: ViewChild,
            args: ['chartLegend', { read: ElementRef }]
        }], chartWrapper: [{
            type: ViewChild,
            args: ['chartWrapper', { static: true }]
        }], onResize: [{
            type: HostListener,
            args: ['window:resize']
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9jb21wb25lbnRzL3BvLWNoYXJ0L3BvLWNoYXJ0LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1jaGFydC9wby1jaGFydC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBR0wsU0FBUyxFQUlULFVBQVUsRUFDVixZQUFZLEVBRVosU0FBUyxFQUNULGdCQUFnQixFQUdqQixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUU3QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsY0FBYyxFQUFFLE1BQU0sNENBQTRDLENBQUM7QUFDbkcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBRTdFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBR2pFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7O0lDTHJELHdCQUFrRTs7O0lBRHBFLDJCQUF1QztJQUNyQyx5RkFBa0U7SUFDcEUsaUJBQU07Ozs7SUFEVyxlQUFrQztJQUFsQyxzQ0FBa0M7OztJQUtuRCwwQ0FBMEY7OztJQUE1RCw2Q0FBd0IsdUJBQUE7O0FESXhEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBbUJHO0FBS0gsTUFBTSxPQUFPLGdCQUFpQixTQUFRLG9CQUFvQjtJQWtCeEQsWUFDWSxZQUE0QixFQUM5QixjQUFpQyxFQUNqQyxnQkFBNEMsRUFDNUMsd0JBQWtELEVBQ2xELFVBQXNCLEVBQ3RCLFlBQWlDLEVBQ2pDLFFBQW1CO1FBRTNCLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztR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RUFBRTtZQUVNLFdBQVc7a0JBQTFELFNBQVM7bUJBQUMsYUFBYSxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRTtZQUVELFlBQVk7a0JBQXhELFNBQVM7bUJBQUMsY0FBYyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtZQXdCM0MsUUFBUTtrQkFEUCxZQUFZO21CQUFDLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gIENvbXBvbmVudFJlZixcbiAgRG9DaGVjayxcbiAgRWxlbWVudFJlZixcbiAgSG9zdExpc3RlbmVyLFxuICBPbkRlc3Ryb3ksXG4gIFZpZXdDaGlsZCxcbiAgVmlld0NvbnRhaW5lclJlZixcbiAgT25Jbml0LFxuICBSZW5kZXJlcjJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBQb0NoYXJ0QXhpc1hMYWJlbEFyZWEsIFBvQ2hhcnRQYWRkaW5nIH0gZnJvbSAnLi9oZWxwZXJzL3BvLWNoYXJ0LWRlZmF1bHQtdmFsdWVzLmNvbnN0YW50JztcbmltcG9ydCB7IFBvRGVmYXVsdENvbG9ycyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BvLWNvbG9yL3BvLWNvbG9ycy5jb25zdGFudCc7XG5cbmltcG9ydCB7IFBvQ2hhcnRCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9wby1jaGFydC1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb0NoYXJ0U3ZnQ29udGFpbmVyU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvcG8tY2hhcnQtc3ZnLWNvbnRhaW5lci5zZXJ2aWNlJztcbmltcG9ydCB7IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tY2hhcnQtdHlwZXMvcG8tY2hhcnQtZHluYW1pYy10eXBlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb0NoYXJ0VHlwZSB9IGZyb20gJy4vZW51bXMvcG8tY2hhcnQtdHlwZS5lbnVtJztcbmltcG9ydCB7IFBvQ29sb3JTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG8tY29sb3IvcG8tY29sb3Iuc2VydmljZSc7XG5pbXBvcnQgeyBQb0NoYXJ0TWF0aHNTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9wby1jaGFydC1tYXRocy5zZXJ2aWNlJztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgUG9DaGFydEJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1jaGFydC1iYXNpY1wiIHRpdGxlPVwiUE8gQ2hhcnQgQmFzaWNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWNoYXJ0LWJhc2ljL3NhbXBsZS1wby1jaGFydC1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jaGFydC1iYXNpYy9zYW1wbGUtcG8tY2hhcnQtYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tY2hhcnQtbGFic1wiIHRpdGxlPVwiUE8gQ2hhcnQgTGFic1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tY2hhcnQtbGFicy9zYW1wbGUtcG8tY2hhcnQtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jaGFydC1sYWJzL3NhbXBsZS1wby1jaGFydC1sYWJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLWNoYXJ0LWNvZmZlZS1yYW5raW5nXCIgdGl0bGU9XCJQTyBDaGFydCAtIENvZmZlZSBSYW5raW5nXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jaGFydC1jb2ZmZWUtcmFua2luZy9zYW1wbGUtcG8tY2hhcnQtY29mZmVlLXJhbmtpbmcuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tY2hhcnQtY29mZmVlLXJhbmtpbmcvc2FtcGxlLXBvLWNoYXJ0LWNvZmZlZS1yYW5raW5nLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvLWNoYXJ0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLWNoYXJ0LmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQb0NoYXJ0Q29tcG9uZW50IGV4dGVuZHMgUG9DaGFydEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBEb0NoZWNrLCBPbkRlc3Ryb3ksIE9uSW5pdCB7XG4gIEBWaWV3Q2hpbGQoJ2NoYXJ0Q29udGFpbmVyJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmLCBzdGF0aWM6IHRydWUgfSkgY2hhcnRDb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XG5cbiAgQFZpZXdDaGlsZCgnY2hhcnRIZWFkZXInLCB7IHN0YXRpYzogdHJ1ZSB9KSBjaGFydEhlYWRlcjogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkKCdjaGFydExlZ2VuZCcsIHsgcmVhZDogRWxlbWVudFJlZiB9KSBjaGFydExlZ2VuZDogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkKCdjaGFydFdyYXBwZXInLCB7IHN0YXRpYzogdHJ1ZSB9KSBjaGFydFdyYXBwZXI6IEVsZW1lbnRSZWY7XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVkQ29tcG9uZW50UmVmRWxlbWVudDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIGNhbGN1bGF0ZWRTdmdDb250YWluZXJFbGVtZW50OiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgY29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8e30+O1xuICBwcml2YXRlIGluaXRpYWxpemVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgd2luZG93UmVzaXplTGlzdGVuZXI6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0KCk7XG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuXG4gIHByaXZhdGUgbWFwcGluZ3MgPSB7fTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgY29sb3JTZXJ2aWNlOiBQb0NvbG9yU2VydmljZSxcbiAgICBwcml2YXRlIGNoYW5nZURldGVjdG9yOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIGNvbnRhaW5lclNlcnZpY2U6IFBvQ2hhcnRTdmdDb250YWluZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgbWF0aHNTZXJ2aWNlOiBQb0NoYXJ0TWF0aHNTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMlxuICApIHtcbiAgICBzdXBlcihjb2xvclNlcnZpY2UpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScpXG4gIG9uUmVzaXplID0gKCkgPT4ge1xuICAgIHRoaXMuZ2V0U3ZnQ29udGFpbmVyU2l6ZSgpO1xuICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIubmV4dCh7fSk7XG4gIH07XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgIHRoaXMuZ2V0U3ZnQ29udGFpbmVyU2l6ZSgpO1xuICB9XG5cbiAgbmdEb0NoZWNrKCkge1xuICAgIGNvbnN0IGNoYXJXcmFwcGVyV2lkdGggPSB0aGlzLmNoYXJ0V3JhcHBlci5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgIGNvbnN0IGlzRHluYW1pY0NoYXJ0ID0gdGhpcy5nZXRDb21wb25lbnRUeXBlKHRoaXMudHlwZSk7XG5cbiAgICAvLyBQZXJtaXRlIHF1ZSBvIGNoYXJ0IHNlamEgY2FsY3VsYWRvIG5hIHByaW1laXJhIHZleiBxdWUgbyBjb21wb25lbnRlIHRvcm5hLXNlIHZpc8OtdmVsLFxuICAgIC8vIGV2aXRhbmRvIGNvbSBpc3NvLCBwcm9ibGVtYXMgY29tIFRhYnMgb3UgRGl2cyBxdWUgaW5pY2llbSBlc2NvbmRpZGFzLlxuICAgIC8vIFF1YW5kbyBtb2RpZmljYWRhIGEgZXN0cnV0dXJhIGRvcyBncsOhZmljb3MgZG8gdGlwbyBjaXJjdWxhciBpc3RvIHNlcsOhIG1lbGhvcmFkby5cbiAgICBpZiAoY2hhcldyYXBwZXJXaWR0aCAmJiB0aGlzLmluaXRpYWxpemVkICYmICFpc0R5bmFtaWNDaGFydCAmJiAhdGhpcy5jYWxjdWxhdGVkU3ZnQ29udGFpbmVyRWxlbWVudCkge1xuICAgICAgdGhpcy5nZXRTdmdDb250YWluZXJTaXplKCk7XG4gICAgICB0aGlzLmNhbGN1bGF0ZWRTdmdDb250YWluZXJFbGVtZW50ID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMucmVtb3ZlV2luZG93UmVzaXplTGlzdGVuZXIoKTtcbiAgfVxuXG4gIHJlc2l6ZUFjdGlvbigpIHtcbiAgICB0aGlzLmdldFN2Z0NvbnRhaW5lclNpemUoKTtcbiAgICB0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyLm5leHQoe30pO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5nZXRTdmdDb250YWluZXJTaXplKCk7XG4gIH1cblxuICByZWJ1aWxkQ29tcG9uZW50UmVmKCkge1xuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZikge1xuICAgICAgdGhpcy5jb21wb25lbnRSZWYuZGVzdHJveSgpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBjYWxjdWxhdGVBeGlzWExhYmVsQXJlYSgpIHtcbiAgICBjb25zdCBheGlzWExhYmVscyA9IHRoaXMuY2hhcnRUeXBlID09PSBQb0NoYXJ0VHlwZS5CYXIgPyB0aGlzLmNhdGVnb3JpZXMgOiB0aGlzLmNoYXJ0U2VyaWVzO1xuXG4gICAgcmV0dXJuIHRoaXMuZ2V0QXhpc1hMYWJlbEFyZWEodGhpcy5tYXRoc1NlcnZpY2UuZ2V0TG9uZ2VzdERhdGFWYWx1ZShheGlzWExhYmVscywgdGhpcy5jaGFydFR5cGUsIHRoaXMub3B0aW9ucykpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFN2Z0NvbnRhaW5lclNpemUoKSB7XG4gICAgbGV0IGF4aXNYTGFiZWxXaWR0aDtcbiAgICBjb25zdCB7IGNoYXJ0SGVhZGVySGVpZ2h0LCBjaGFydExlZ2VuZEhlaWdodCwgY2hhcnRXcmFwcGVyV2lkdGggfSA9IHRoaXMuZ2V0Q2hhcnRNZWFzdXJlbWVudHMoKTtcblxuICAgIGlmICghdGhpcy5pc1R5cGVDaXJjdWxhcikge1xuICAgICAgYXhpc1hMYWJlbFdpZHRoID0gdGhpcy5jYWxjdWxhdGVBeGlzWExhYmVsQXJlYSgpO1xuICAgIH1cblxuICAgIHRoaXMuc3ZnQ29udGFpbmVyU2l6ZSA9IHtcbiAgICAgIC4uLnRoaXMuY29udGFpbmVyU2VydmljZS5jYWxjdWxhdGVTVkdDb250YWluZXJNZWFzdXJlbWVudHMoXG4gICAgICAgIHRoaXMuaGVpZ2h0LFxuICAgICAgICBjaGFydFdyYXBwZXJXaWR0aCxcbiAgICAgICAgY2hhcnRIZWFkZXJIZWlnaHQsXG4gICAgICAgIGNoYXJ0TGVnZW5kSGVpZ2h0XG4gICAgICApLFxuICAgICAgYXhpc1hMYWJlbFdpZHRoXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY2hhcnRMZWdlbmRIZWlnaHQoY2hhcnRMZWdlbmQ6IEVsZW1lbnRSZWYpIHtcbiAgICByZXR1cm4gY2hhcnRMZWdlbmQgPyBjaGFydExlZ2VuZC5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodCA6IDA7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNvbXBvbmVudCgpIHtcbiAgICBjb25zdCBjb21wb25lbnRUeXBlID0gdGhpcy5nZXRDb21wb25lbnRUeXBlKHRoaXMudHlwZSk7XG4gICAgY29uc3QgZmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGNvbXBvbmVudFR5cGUpO1xuXG4gICAgdGhpcy5jb21wb25lbnRSZWYgPSB0aGlzLmNoYXJ0Q29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5KTtcblxuICAgIGNvbnN0IGluc3RhbmNlID0gPFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudD50aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcblxuICAgIHRoaXMuc2V0Q29tcG9uZW50UmVmUHJvcGVydGllcyhpbnN0YW5jZSk7XG5cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIGR5bmFtaWNDb21wb25lbnRTZXR0aW5nKCkge1xuICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5jcmVhdGVDb21wb25lbnQoKTtcblxuICAgIHRoaXMuc2V0UmVzaXplTGlzdGVuZXJTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIHRoaXMuc2V0Q2xpY2tTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICAgIHRoaXMuc2V0SG92ZXJTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRBeGlzWExhYmVsQXJlYShheGlzWExhYmVsOiBhbnkpIHtcbiAgICBjb25zdCBsYWJlbFBvQ2hhcnRQYWRkaW5nID0gUG9DaGFydFBhZGRpbmcgLyAzO1xuICAgIGNvbnN0IHNwYW5FbGVtZW50ID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHNwYW5FbGVtZW50LCAncG8tY2hhcnQtYXhpcy14LWxhYmVsJyk7XG4gICAgc3BhbkVsZW1lbnQuaW5uZXJIVE1MID0gYXhpc1hMYWJlbDtcblxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsIHNwYW5FbGVtZW50KTtcbiAgICBjb25zdCBheGlzWExhYmVsV2lkdGggPSBNYXRoLmNlaWwoc3BhbkVsZW1lbnQub2Zmc2V0V2lkdGgpICsgbGFiZWxQb0NoYXJ0UGFkZGluZztcbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCBzcGFuRWxlbWVudCk7XG5cbiAgICByZXR1cm4gYXhpc1hMYWJlbFdpZHRoID4gUG9DaGFydEF4aXNYTGFiZWxBcmVhID8gYXhpc1hMYWJlbFdpZHRoIDogUG9DaGFydEF4aXNYTGFiZWxBcmVhO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb21wb25lbnRUeXBlKHR5cGVOYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMubWFwcGluZ3NbdHlwZU5hbWVdO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDaGFydE1lYXN1cmVtZW50cygpIHtcbiAgICBjb25zdCBjaGFydFdyYXBwZXJXaWR0aCA9IHRoaXMuY2hhcnRXcmFwcGVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgY29uc3QgY2hhcnRIZWFkZXJIZWlnaHQgPSB0aGlzLmNoYXJ0SGVhZGVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgIGNvbnN0IGNoYXJ0TGVnZW5kSGVpZ2h0ID0gdGhpcy5jaGFydExlZ2VuZEhlaWdodCh0aGlzLmNoYXJ0TGVnZW5kKTtcblxuICAgIHJldHVybiB7IGNoYXJ0V3JhcHBlcldpZHRoLCBjaGFydEhlYWRlckhlaWdodCwgY2hhcnRMZWdlbmRIZWlnaHQgfTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlV2luZG93UmVzaXplTGlzdGVuZXIoKSB7XG4gICAgaWYgKHRoaXMub25SZXNpemUpIHtcbiAgICAgIHRoaXMub25SZXNpemUgPSAoKSA9PiB7fTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldENvbXBvbmVudFJlZlByb3BlcnRpZXMoaW5zdGFuY2U6IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCkge1xuICAgIGNvbnN0IHsgY2hhcnRIZWFkZXJIZWlnaHQsIGNoYXJ0TGVnZW5kSGVpZ2h0LCBjaGFydFdyYXBwZXJXaWR0aCB9ID0gdGhpcy5nZXRDaGFydE1lYXN1cmVtZW50cygpO1xuXG4gICAgaW5zdGFuY2UuY2hhcnRIZWFkZXIgPSBjaGFydEhlYWRlckhlaWdodDtcbiAgICBpbnN0YW5jZS5jaGFydExlZ2VuZCA9IGNoYXJ0TGVnZW5kSGVpZ2h0O1xuICAgIGluc3RhbmNlLmNoYXJ0V3JhcHBlciA9IGNoYXJ0V3JhcHBlcldpZHRoO1xuICAgIGluc3RhbmNlLmNvbG9ycyA9IFBvRGVmYXVsdENvbG9yc1swXTtcbiAgICBpbnN0YW5jZS5oZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICBpbnN0YW5jZS50eXBlID0gdGhpcy50eXBlO1xuICAgIGluc3RhbmNlLnNlcmllcyA9IHRoaXMuY2hhcnRTZXJpZXMgfHwgW107XG4gIH1cblxuICBwcml2YXRlIHNldENsaWNrU3Vic2NyaWJlKGluc3RhbmNlOiBQb0NoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbi5hZGQoXG4gICAgICBpbnN0YW5jZS5vblNlcmllQ2xpY2suc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgICAgdGhpcy5vblNlcmllc0NsaWNrKGV2ZW50KTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0SG92ZXJTdWJzY3JpYmUoaW5zdGFuY2U6IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uLmFkZChcbiAgICAgIGluc3RhbmNlLm9uU2VyaWVIb3Zlci5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgICB0aGlzLm9uU2VyaWVzSG92ZXIoZXZlbnQpO1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRSZXNpemVMaXN0ZW5lclN1YnNjcmliZShpbnN0YW5jZTogUG9DaGFydER5bmFtaWNUeXBlQ29tcG9uZW50KSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKFxuICAgICAgdGhpcy53aW5kb3dSZXNpemVMaXN0ZW5lci5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICBjb25zdCBtZWFzdXJlc0ZvckNvbXBvbmVudFJlZiA9IHRoaXMuZ2V0Q2hhcnRNZWFzdXJlbWVudHMoKTtcblxuICAgICAgICBpbnN0YW5jZS5jaGFydFdyYXBwZXIgPSBtZWFzdXJlc0ZvckNvbXBvbmVudFJlZi5jaGFydFdyYXBwZXJXaWR0aDtcbiAgICAgICAgaW5zdGFuY2UuY2hhcnRIZWFkZXIgPSBtZWFzdXJlc0ZvckNvbXBvbmVudFJlZi5jaGFydEhlYWRlckhlaWdodDtcbiAgICAgICAgaW5zdGFuY2UuY2hhcnRMZWdlbmQgPSBtZWFzdXJlc0ZvckNvbXBvbmVudFJlZi5jaGFydExlZ2VuZEhlaWdodDtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxufVxuIiwiPGRpdiAjY2hhcnRXcmFwcGVyIGNsYXNzPVwicG8tY2hhcnQtd3JhcHBlclwiIChwLXJlc2l6ZS1vYnNlcnZlcik9XCJyZXNpemVBY3Rpb24oKVwiPlxuICA8ZGl2ICNjaGFydEhlYWRlciBjbGFzcz1cInBvLWNoYXJ0LWhlYWRlclwiPlxuICAgIDxkaXYgY2xhc3M9XCJwby1jaGFydC10aXRsZVwiPnt7IHRpdGxlIH19PC9kaXY+XG4gIDwvZGl2PlxuXG4gIDxwby1jaGFydC1jb250YWluZXJcbiAgICBbcC1vcHRpb25zXT1cIm9wdGlvbnNcIlxuICAgIFtwLXR5cGVdPVwiY2hhcnRUeXBlXCJcbiAgICBbcC1zZXJpZXNdPVwiY2hhcnRTZXJpZXNcIlxuICAgIFtwLWNhdGVnb3JpZXNdPVwiY2F0ZWdvcmllc1wiXG4gICAgW3AtY29udGFpbmVyLXNpemVdPVwic3ZnQ29udGFpbmVyU2l6ZVwiXG4gICAgKHAtc2VyaWUtY2xpY2spPVwib25TZXJpZXNDbGljaygkZXZlbnQpXCJcbiAgICAocC1zZXJpZS1ob3Zlcik9XCJvblNlcmllc0hvdmVyKCRldmVudClcIlxuICA+PC9wby1jaGFydC1jb250YWluZXI+XG5cbiAgPCEtLSBJbmplw6fDo28gZGUgZ3LDoWZpY29zIGRvIHRpcG8gZ2F1Z2UuIFJlbW92ZXIgbmEgZGVwcmVjaWHDp8Ojby4gIC0tPlxuICA8bmctdGVtcGxhdGUgI2NoYXJ0Q29udGFpbmVyPjwvbmctdGVtcGxhdGU+XG5cbiAgPGRpdiAqbmdJZj1cIm9wdGlvbnM/LmxlZ2VuZCAhPT0gZmFsc2VcIj5cbiAgICA8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwiY2hhcnRMZWdlbmRHcm91cFwiPjwvbmctY29udGFpbmVyPlxuICA8L2Rpdj5cbjwvZGl2PlxuXG48bmctdGVtcGxhdGUgI2NoYXJ0TGVnZW5kR3JvdXA+XG4gIDxwby1jaGFydC1sZWdlbmQgI2NoYXJ0TGVnZW5kIFtwLXNlcmllc109XCJjaGFydFNlcmllc1wiIFtwLXR5cGVdPVwidHlwZVwiPiA8L3BvLWNoYXJ0LWxlZ2VuZD5cbjwvbmctdGVtcGxhdGU+XG4iXX0=