import { EventEmitter, Input, Output, Directive } from '@angular/core';
import { convertToInt, isTypeof } from '../../utils/util';
import { PoChartType } from './enums/po-chart-type.enum';
import * as i0 from "@angular/core";
import * as i1 from "../../services/po-color/po-color.service";
const poChartDefaultHeight = 400;
const poChartMinHeight = 200;
/**
 * @description
 *
 * O `po-chart` é um componente para renderização de dados através de gráficos, com isso facilitando a compreensão e tornando a
 * visualização destes dados mais agradável.
 *
 * Através de suas principais propriedades é possível definir atributos, tais como tipo de gráfico, altura, título, cores customizadas, opções para os eixos, entre outros.
 *
 * O componente permite utilizar em conjunto séries do tipo linha e coluna.
 *
 * Além disso, também é possível definir uma ação que será executada ao clicar em determinado elemento do gráfico
 * e outra que será executada ao passar o *mouse* sobre o elemento.
 *
 * #### Guia de uso para Gráficos
 *
 * > Veja nosso [guia de uso para gráficos](/guides/guide-charts) para auxiliar na construção do seu gráfico,
 * informando em qual caso utilizar, o que devemos evitar e boas práticas relacionada a cores.
 */
export class PoChartBaseComponent {
    constructor(colorService) {
        this.colorService = colorService;
        /**
         * @optional
         *
         * @description
         *
         * Evento executado quando o usuário clicar sobre um elemento do gráfico.
         *
         * O evento emitirá o seguinte parâmetro:
         * - *donut* e *pie*: um objeto contendo a categoria e valor da série.
         * - *area*, *line*, *column* e *bar*: um objeto contendo o nome da série, valor e categoria do eixo do gráfico.
         */
        this.seriesClick = new EventEmitter();
        /**
         * @optional
         *
         * @description
         *
         * Evento executado quando o usuário passar o *mouse* sobre um elemento do gráfico.
         *
         * O evento emitirá o seguinte parâmetro de acordo com o tipo de gráfico:
         * - *donut* e *pie*: um objeto contendo a categoria e valor da série.
         * - *area*, *line*, *column* e *bar*: um objeto contendo a categoria, valor da série e categoria do eixo do gráfico.
         */
        this.seriesHover = new EventEmitter();
        // manipulação das séries tratadas internamente para preservar 'p-series';
        this.chartSeries = [];
    }
    /**
     * @optional
     *
     * @description
     *
     * Define a altura do gráfico.
     *
     * > O valor mínimo aceito nesta propriedade é 200.
     *
     * @default `400px`
     */
    set height(value) {
        const intValue = convertToInt(value);
        let height;
        if (isTypeof(value, 'number')) {
            height = intValue <= poChartMinHeight ? poChartMinHeight : intValue;
        }
        else {
            height = this.setDefaultHeight();
        }
        this._height = height;
        this.getSvgContainerSize();
        this.rebuildComponentRef();
    }
    get height() {
        return this._height || this.setDefaultHeight();
    }
    /**
     * @optional
     *
     * @description
     *
     * Define o tipo de gráfico.
     *
     * É possível também combinar gráficos dos tipos linha e coluna. Para isso, opte pela declaração de `type` conforme a interface `PoChartSerie`.
     *
     * > Note que, se houver declaração de tipo de gráfico tanto em `p-type` quanto em `PochartSerie.type`, o valor `{ type }` da primeira série anulará o valor definido em `p-type`.
     *
     * Se não passado valor, o padrão será relativo à primeira série passada em `p-series`:
     * - Se `p-series = [{ data: [1,2,3] }]`: será `PoChartType.Column`.
     * - Se `p-series = [{ data: 1 }]`: será `PoChartType.Pie`.
     *
     * > Veja os valores válidos no *enum* `PoChartType`.
     */
    set type(value) {
        // O Valor default definido em `p-series` de acordo com a primeira série passada.
        this._type = Object.values(PoChartType).includes(value) ? value : undefined;
        this.rebuildComponentRef();
    }
    get type() {
        return this._type;
    }
    /**
     * @description
     *
     * Define os elementos do gráfico que serão criados dinamicamente.
     */
    set series(value) {
        this._series = value || [];
        if (Array.isArray(this._series) && this._series.length) {
            this.setTypeDefault(this._series[0]);
        }
        else {
            this.transformObjectToArrayObject(this.series);
            this.rebuildComponentRef();
        }
    }
    get series() {
        return this._series;
    }
    /**
     * @optional
     *
     * @description
     *
     * Define os nomes das categorias que serão plotadas no eixo X do gráfico caso seja do tipo `bar`, ou então nos eixos Y do grid de gráficos dos tipos `area`, `columnn` e `line`.
     *
     * > Gráficos do tipo `bar` dimensionam a área do gráfico de acordo com a largura do maior texto de categorias. No entanto, é uma boa prática optar por palavras curtas para que a leitura do gráfico não seja prejudicada.
     *
     * > Caso não seja especificado um valor para a categoria, será plotado um hífen na categoria referente a cada série.
     */
    set categories(value) {
        if (Array.isArray(value)) {
            this._categories = value;
        }
    }
    get categories() {
        return this._categories;
    }
    /**
     * @optional
     *
     * @description
     *
     * Objeto com as configurações usadas no `po-chart`.
     *
     * É possível, por exemplo, definir as configurações de exibição das legendas,
     * configurar os eixos(*axis*) para os gráficos dos tipos `area`, `line`, `column` e `bar` da seguinte forma:
     *
     * ```
     *  chartOptions: PoChartOptions = {
     *    legend: true,
     *    axis: {
     *      minRange: 0,
     *      maxRange: 100,
     *      gridLines: 5,
     *    },
     *  };
     * ```
     */
    set options(value) {
        if (value instanceof Object && !(value instanceof Array)) {
            this._options = value;
            if (this._options.hasOwnProperty('legend') && typeof this._options.legend === 'boolean') {
                this.getSvgContainerSize();
            }
        }
    }
    get options() {
        return this._options;
    }
    get isTypeCircular() {
        return this.defaultType === PoChartType.Pie || this.defaultType === PoChartType.Donut;
    }
    ngOnChanges(changes) {
        const isArrayOfseries = Array.isArray(this.series) && this.series.length > 0;
        if ((changes.series && isArrayOfseries) ||
            (changes.type && isArrayOfseries) ||
            (changes.categories && isArrayOfseries)) {
            this.validateSerieAndAddType(this.series);
        }
        if ((changes.type && !this.isTypeCircular) || (changes.categories && !this.isTypeCircular)) {
            this.svgContainerSize = {
                ...this.svgContainerSize,
                axisXLabelWidth: this.calculateAxisXLabelArea()
            };
        }
    }
    onSeriesClick(event) {
        this.seriesClick.emit(event);
    }
    onSeriesHover(event) {
        this.seriesHover.emit(event);
    }
    setDefaultHeight() {
        return poChartDefaultHeight;
    }
    transformObjectToArrayObject(serie) {
        this.chartSeries = typeof serie === 'object' && Object.keys(serie).length ? [{ ...serie }] : [];
    }
    setTypeDefault(serie) {
        const data = serie.data;
        const serieType = Object.values(PoChartType).includes(serie.type) ? serie.type : undefined;
        this.defaultType = serieType ? serieType : Array.isArray(data) ? PoChartType.Column : PoChartType.Pie;
    }
    validateSerieAndAddType(series) {
        const filteredSeries = series.filter(serie => this.isTypeCircular ? typeof serie.data === 'number' : Array.isArray(serie.data));
        this.chartSeries = this.appendType(this.appendColors(filteredSeries));
    }
    appendColors(series) {
        return this.colorService.getColors(series);
    }
    appendType(series) {
        return series.map((serie, index) => {
            if (index === 0) {
                this.chartType = Object.values(PoChartType).includes(serie.type)
                    ? serie.type
                    : this.type || this.defaultType;
            }
            return { ...serie, type: serie.type || this.chartType };
        });
    }
}
PoChartBaseComponent.ɵfac = function PoChartBaseComponent_Factory(t) { return new (t || PoChartBaseComponent)(i0.ɵɵdirectiveInject(i1.PoColorService)); };
PoChartBaseComponent.ɵdir = /*@__PURE__*/ i0.ɵɵdefineDirective({ type: PoChartBaseComponent, inputs: { title: ["p-title", "title"], height: ["p-height", "height"], type: ["p-type", "type"], series: ["p-series", "series"], categories: ["p-categories", "categories"], options: ["p-options", "options"] }, outputs: { seriesClick: "p-series-click", seriesHover: "p-series-hover" }, features: [i0.ɵɵNgOnChangesFeature] });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoChartBaseComponent, [{
        type: Directive
    }], function () { return [{ type: i1.PoColorService }]; }, { title: [{
            type: Input,
            args: ['p-title']
        }], seriesClick: [{
            type: Output,
            args: ['p-series-click']
        }], seriesHover: [{
            type: Output,
            args: ['p-series-hover']
        }], height: [{
            type: Input,
            args: ['p-height']
        }], type: [{
            type: Input,
            args: ['p-type']
        }], series: [{
            type: Input,
            args: ['p-series']
        }], categories: [{
            type: Input,
            args: ['p-categories']
        }], options: [{
            type: Input,
            args: ['p-options']
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2hhcnQvcG8tY2hhcnQtYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFFakcsT0FBTyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUcxRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7OztBQUt6RCxNQUFNLG9CQUFvQixHQUFHLEdBQUcsQ0FBQztBQUNqQyxNQUFNLGdCQUFnQixHQUFHLEdBQUcsQ0FBQztBQUU3Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7QUFFSCxNQUFNLE9BQWdCLG9CQUFvQjtJQW9MeEMsWUFBc0IsWUFBNEI7UUFBNUIsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBaExsRDs7Ozs7Ozs7OztXQVVHO1FBRUgsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBZ0IsQ0FBQztRQUUvQzs7Ozs7Ozs7OztXQVVHO1FBRUgsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBZ0IsQ0FBQztRQUUvQywwRUFBMEU7UUFDMUUsZ0JBQVcsR0FBd0IsRUFBRSxDQUFDO0lBbUplLENBQUM7SUF2SXREOzs7Ozs7Ozs7O09BVUc7SUFDSCxJQUF1QixNQUFNLENBQUMsS0FBYTtRQUN6QyxNQUFNLFFBQVEsR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckMsSUFBSSxNQUFjLENBQUM7UUFFbkIsSUFBSSxRQUFRLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxFQUFFO1lBQzdCLE1BQU0sR0FBRyxRQUFRLElBQUksZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLGdCQUFn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LENBQUM7b0JBQ3JFLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSTtvQkFDWixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDO2FBQ25DO1lBRUQsT0FBTyxFQUFFLEdBQUcsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7O3dGQTFQbUIsb0JBQW9CO3VFQUFwQixvQkFBb0I7dUZBQXBCLG9CQUFvQjtjQUR6QyxTQUFTO2lFQUdVLEtBQUs7a0JBQXRCLEtBQUs7bUJBQUMsU0FBUztZQWNoQixXQUFXO2tCQURWLE1BQU07bUJBQUMsZ0JBQWdCO1lBZXhCLFdBQVc7a0JBRFYsTUFBTTttQkFBQyxnQkFBZ0I7WUEyQkQsTUFBTTtrQkFBNUIsS0FBSzttQkFBQyxVQUFVO1lBcUNJLElBQUk7a0JBQXhCLEtBQUs7bUJBQUMsUUFBUTtZQWdCUSxNQUFNO2tCQUE1QixLQUFLO21CQUFDLFVBQVU7WUEwQlUsVUFBVTtrQkFBcEMsS0FBSzttQkFBQyxjQUFjO1lBK0JHLE9BQU87a0JBQTlCLEtBQUs7bUJBQUMsV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50RW1pdHRlciwgSW5wdXQsIE91dHB1dCwgRGlyZWN0aXZlLCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgY29udmVydFRvSW50LCBpc1R5cGVvZiB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQgeyBQb0NoYXJ0Q29udGFpbmVyU2l6ZSB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1jaGFydC1jb250YWluZXItc2l6ZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9DaGFydFR5cGUgfSBmcm9tICcuL2VudW1zL3BvLWNoYXJ0LXR5cGUuZW51bSc7XG5pbXBvcnQgeyBQb0NoYXJ0T3B0aW9ucyB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1jaGFydC1vcHRpb25zLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0NoYXJ0U2VyaWUgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tY2hhcnQtc2VyaWUuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvQ29sb3JTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG8tY29sb3IvcG8tY29sb3Iuc2VydmljZSc7XG5cbmNvbnN0IHBvQ2hhcnREZWZhdWx0SGVpZ2h0ID0gNDAwO1xuY29uc3QgcG9DaGFydE1pbkhlaWdodCA9IDIwMDtcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBPIGBwby1jaGFydGAgw6kgdW0gY29tcG9uZW50ZSBwYXJhIHJlbmRlcml6YcOnw6NvIGRlIGRhZG9zIGF0cmF2w6lzIGRlIGdyw6FmaWNvcywgY29tIGlzc28gZmFjaWxpdGFuZG8gYSBjb21wcmVlbnPDo28gZSB0b3JuYW5kbyBhXG4gKiB2aXN1YWxpemHDp8OjbyBkZXN0ZXMgZGFkb3MgbWFpcyBhZ3JhZMOhdmVsLlxuICpcbiAqIEF0cmF2w6lzIGRlIHN1YXMgcHJpbmNpcGFpcyBwcm9wcmllZGFkZXMgw6kgcG9zc8OtdmVsIGRlZmluaXIgYXRyaWJ1dG9zLCB0YWlzIGNvbW8gdGlwbyBkZSBncsOhZmljbywgYWx0dXJhLCB0w610dWxvLCBjb3JlcyBjdXN0b21pemFkYXMsIG9ww6fDtWVzIHBhcmEgb3MgZWl4b3MsIGVudHJlIG91dHJvcy5cbiAqXG4gKiBPIGNvbXBvbmVudGUgcGVybWl0ZSB1dGlsaXphciBlbSBjb25qdW50byBzw6lyaWVzIGRvIHRpcG8gbGluaGEgZSBjb2x1bmEuXG4gKlxuICogQWzDqW0gZGlzc28sIHRhbWLDqW0gw6kgcG9zc8OtdmVsIGRlZmluaXIgdW1hIGHDp8OjbyBxdWUgc2Vyw6EgZXhlY3V0YWRhIGFvIGNsaWNhciBlbSBkZXRlcm1pbmFkbyBlbGVtZW50byBkbyBncsOhZmljb1xuICogZSBvdXRyYSBxdWUgc2Vyw6EgZXhlY3V0YWRhIGFvIHBhc3NhciBvICptb3VzZSogc29icmUgbyBlbGVtZW50by5cbiAqXG4gKiAjIyMjIEd1aWEgZGUgdXNvIHBhcmEgR3LDoWZpY29zXG4gKlxuICogPiBWZWphIG5vc3NvIFtndWlhIGRlIHVzbyBwYXJhIGdyw6FmaWNvc10oL2d1aWRlcy9ndWlkZS1jaGFydHMpIHBhcmEgYXV4aWxpYXIgbmEgY29uc3RydcOnw6NvIGRvIHNldSBncsOhZmljbyxcbiAqIGluZm9ybWFuZG8gZW0gcXVhbCBjYXNvIHV0aWxpemFyLCBvIHF1ZSBkZXZlbW9zIGV2aXRhciBlIGJvYXMgcHLDoXRpY2FzIHJlbGFjaW9uYWRhIGEgY29yZXMuXG4gKi9cbkBEaXJlY3RpdmUoKVxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFBvQ2hhcnRCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgLyoqIERlZmluZSBvIHTDrXR1bG8gZG8gZ3LDoWZpY28uICovXG4gIEBJbnB1dCgncC10aXRsZScpIHRpdGxlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEV2ZW50byBleGVjdXRhZG8gcXVhbmRvIG8gdXN1w6FyaW8gY2xpY2FyIHNvYnJlIHVtIGVsZW1lbnRvIGRvIGdyw6FmaWNvLlxuICAgKlxuICAgKiBPIGV2ZW50byBlbWl0aXLDoSBvIHNlZ3VpbnRlIHBhcsOibWV0cm86XG4gICAqIC0gKmRvbnV0KiBlICpwaWUqOiB1bSBvYmpldG8gY29udGVuZG8gYSBjYXRlZ29yaWEgZSB2YWxvciBkYSBzw6lyaWUuXG4gICAqIC0gKmFyZWEqLCAqbGluZSosICpjb2x1bW4qIGUgKmJhcio6IHVtIG9iamV0byBjb250ZW5kbyBvIG5vbWUgZGEgc8OpcmllLCB2YWxvciBlIGNhdGVnb3JpYSBkbyBlaXhvIGRvIGdyw6FmaWNvLlxuICAgKi9cbiAgQE91dHB1dCgncC1zZXJpZXMtY2xpY2snKVxuICBzZXJpZXNDbGljayA9IG5ldyBFdmVudEVtaXR0ZXI8UG9DaGFydFNlcmllPigpO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEV2ZW50byBleGVjdXRhZG8gcXVhbmRvIG8gdXN1w6FyaW8gcGFzc2FyIG8gKm1vdXNlKiBzb2JyZSB1bSBlbGVtZW50byBkbyBncsOhZmljby5cbiAgICpcbiAgICogTyBldmVudG8gZW1pdGlyw6EgbyBzZWd1aW50ZSBwYXLDom1ldHJvIGRlIGFjb3JkbyBjb20gbyB0aXBvIGRlIGdyw6FmaWNvOlxuICAgKiAtICpkb251dCogZSAqcGllKjogdW0gb2JqZXRvIGNvbnRlbmRvIGEgY2F0ZWdvcmlhIGUgdmFsb3IgZGEgc8OpcmllLlxuICAgKiAtICphcmVhKiwgKmxpbmUqLCAqY29sdW1uKiBlICpiYXIqOiB1bSBvYmpldG8gY29udGVuZG8gYSBjYXRlZ29yaWEsIHZhbG9yIGRhIHPDqXJpZSBlIGNhdGVnb3JpYSBkbyBlaXhvIGRvIGdyw6FmaWNvLlxuICAgKi9cbiAgQE91dHB1dCgncC1zZXJpZXMtaG92ZXInKVxuICBzZXJpZXNIb3ZlciA9IG5ldyBFdmVudEVtaXR0ZXI8UG9DaGFydFNlcmllPigpO1xuXG4gIC8vIG1hbmlwdWxhw6fDo28gZGFzIHPDqXJpZXMgdHJhdGFkYXMgaW50ZXJuYW1lbnRlIHBhcmEgcHJlc2VydmFyICdwLXNlcmllcyc7XG4gIGNoYXJ0U2VyaWVzOiBBcnJheTxQb0NoYXJ0U2VyaWU+ID0gW107XG4gIGNoYXJ0VHlwZTogUG9DaGFydFR5cGU7XG4gIHN2Z0NvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplO1xuXG4gIHByaXZhdGUgX29wdGlvbnM6IFBvQ2hhcnRPcHRpb25zO1xuICBwcml2YXRlIF9jYXRlZ29yaWVzOiBBcnJheTxzdHJpbmc+O1xuICBwcml2YXRlIF9oZWlnaHQ6IG51bWJlcjtcbiAgcHJpdmF0ZSBfc2VyaWVzOiBBcnJheTxQb0NoYXJ0U2VyaWU+O1xuICBwcml2YXRlIF90eXBlOiBQb0NoYXJ0VHlwZTtcblxuICBwcml2YXRlIGRlZmF1bHRUeXBlOiBQb0NoYXJ0VHlwZTtcblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEZWZpbmUgYSBhbHR1cmEgZG8gZ3LDoWZpY28uXG4gICAqXG4gICAqID4gTyB2YWxvciBtw61uaW1vIGFjZWl0byBuZXN0YSBwcm9wcmllZGFkZSDDqSAyMDAuXG4gICAqXG4gICAqIEBkZWZhdWx0IGA0MDBweGBcbiAgICovXG4gIEBJbnB1dCgncC1oZWlnaHQnKSBzZXQgaGVpZ2h0KHZhbHVlOiBudW1iZXIpIHtcbiAgICBjb25zdCBpbnRWYWx1ZSA9IGNvbnZlcnRUb0ludCh2YWx1ZSk7XG4gICAgbGV0IGhlaWdodDogbnVtYmVyO1xuXG4gICAgaWYgKGlzVHlwZW9mKHZhbHVlLCAnbnVtYmVyJykpIHtcbiAgICAgIGhlaWdodCA9IGludFZhbHVlIDw9IHBvQ2hhcnRNaW5IZWlnaHQgPyBwb0NoYXJ0TWluSGVpZ2h0IDogaW50VmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhlaWdodCA9IHRoaXMuc2V0RGVmYXVsdEhlaWdodCgpO1xuICAgIH1cblxuICAgIHRoaXMuX2hlaWdodCA9IGhlaWdodDtcblxuICAgIHRoaXMuZ2V0U3ZnQ29udGFpbmVyU2l6ZSgpO1xuICAgIHRoaXMucmVidWlsZENvbXBvbmVudFJlZigpO1xuICB9XG5cbiAgZ2V0IGhlaWdodCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9oZWlnaHQgfHwgdGhpcy5zZXREZWZhdWx0SGVpZ2h0KCk7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEZWZpbmUgbyB0aXBvIGRlIGdyw6FmaWNvLlxuICAgKlxuICAgKiDDiSBwb3Nzw612ZWwgdGFtYsOpbSBjb21iaW5hciBncsOhZmljb3MgZG9zIHRpcG9zIGxpbmhhIGUgY29sdW5hLiBQYXJhIGlzc28sIG9wdGUgcGVsYSBkZWNsYXJhw6fDo28gZGUgYHR5cGVgIGNvbmZvcm1lIGEgaW50ZXJmYWNlIGBQb0NoYXJ0U2VyaWVgLlxuICAgKlxuICAgKiA+IE5vdGUgcXVlLCBzZSBob3V2ZXIgZGVjbGFyYcOnw6NvIGRlIHRpcG8gZGUgZ3LDoWZpY28gdGFudG8gZW0gYHAtdHlwZWAgcXVhbnRvIGVtIGBQb2NoYXJ0U2VyaWUudHlwZWAsIG8gdmFsb3IgYHsgdHlwZSB9YCBkYSBwcmltZWlyYSBzw6lyaWUgYW51bGFyw6EgbyB2YWxvciBkZWZpbmlkbyBlbSBgcC10eXBlYC5cbiAgICpcbiAgICogU2UgbsOjbyBwYXNzYWRvIHZhbG9yLCBvIHBhZHLDo28gc2Vyw6EgcmVsYXRpdm8gw6AgcHJpbWVpcmEgc8OpcmllIHBhc3NhZGEgZW0gYHAtc2VyaWVzYDpcbiAgICogLSBTZSBgcC1zZXJpZXMgPSBbeyBkYXRhOiBbMSwyLDNdIH1dYDogc2Vyw6EgYFBvQ2hhcnRUeXBlLkNvbHVtbmAuXG4gICAqIC0gU2UgYHAtc2VyaWVzID0gW3sgZGF0YTogMSB9XWA6IHNlcsOhIGBQb0NoYXJ0VHlwZS5QaWVgLlxuICAgKlxuICAgKiA+IFZlamEgb3MgdmFsb3JlcyB2w6FsaWRvcyBubyAqZW51bSogYFBvQ2hhcnRUeXBlYC5cbiAgICovXG4gIEBJbnB1dCgncC10eXBlJykgc2V0IHR5cGUodmFsdWU6IFBvQ2hhcnRUeXBlKSB7XG4gICAgLy8gTyBWYWxvciBkZWZhdWx0IGRlZmluaWRvIGVtIGBwLXNlcmllc2AgZGUgYWNvcmRvIGNvbSBhIHByaW1laXJhIHPDqXJpZSBwYXNzYWRhLlxuICAgIHRoaXMuX3R5cGUgPSAoPGFueT5PYmplY3QpLnZhbHVlcyhQb0NoYXJ0VHlwZSkuaW5jbHVkZXModmFsdWUpID8gdmFsdWUgOiB1bmRlZmluZWQ7XG5cbiAgICB0aGlzLnJlYnVpbGRDb21wb25lbnRSZWYoKTtcbiAgfVxuXG4gIGdldCB0eXBlKCk6IFBvQ2hhcnRUeXBlIHtcbiAgICByZXR1cm4gdGhpcy5fdHlwZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogRGVmaW5lIG9zIGVsZW1lbnRvcyBkbyBncsOhZmljbyBxdWUgc2Vyw6NvIGNyaWFkb3MgZGluYW1pY2FtZW50ZS5cbiAgICovXG4gIEBJbnB1dCgncC1zZXJpZXMnKSBzZXQgc2VyaWVzKHZhbHVlOiBBcnJheTxQb0NoYXJ0U2VyaWU+KSB7XG4gICAgdGhpcy5fc2VyaWVzID0gdmFsdWUgfHwgW107XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLl9zZXJpZXMpICYmIHRoaXMuX3Nlcmllcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuc2V0VHlwZURlZmF1bHQodGhpcy5fc2VyaWVzWzBdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy50cmFuc2Zvcm1PYmplY3RUb0FycmF5T2JqZWN0KHRoaXMuc2VyaWVzKTtcbiAgICAgIHRoaXMucmVidWlsZENvbXBvbmVudFJlZigpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBzZXJpZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlcmllcztcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBvcyBub21lcyBkYXMgY2F0ZWdvcmlhcyBxdWUgc2Vyw6NvIHBsb3RhZGFzIG5vIGVpeG8gWCBkbyBncsOhZmljbyBjYXNvIHNlamEgZG8gdGlwbyBgYmFyYCwgb3UgZW50w6NvIG5vcyBlaXhvcyBZIGRvIGdyaWQgZGUgZ3LDoWZpY29zIGRvcyB0aXBvcyBgYXJlYWAsIGBjb2x1bW5uYCBlIGBsaW5lYC5cbiAgICpcbiAgICogPiBHcsOhZmljb3MgZG8gdGlwbyBgYmFyYCBkaW1lbnNpb25hbSBhIMOhcmVhIGRvIGdyw6FmaWNvIGRlIGFjb3JkbyBjb20gYSBsYXJndXJhIGRvIG1haW9yIHRleHRvIGRlIGNhdGVnb3JpYXMuIE5vIGVudGFudG8sIMOpIHVtYSBib2EgcHLDoXRpY2Egb3B0YXIgcG9yIHBhbGF2cmFzIGN1cnRhcyBwYXJhIHF1ZSBhIGxlaXR1cmEgZG8gZ3LDoWZpY28gbsOjbyBzZWphIHByZWp1ZGljYWRhLlxuICAgKlxuICAgKiA+IENhc28gbsOjbyBzZWphIGVzcGVjaWZpY2FkbyB1bSB2YWxvciBwYXJhIGEgY2F0ZWdvcmlhLCBzZXLDoSBwbG90YWRvIHVtIGjDrWZlbiBuYSBjYXRlZ29yaWEgcmVmZXJlbnRlIGEgY2FkYSBzw6lyaWUuXG4gICAqL1xuICBASW5wdXQoJ3AtY2F0ZWdvcmllcycpIHNldCBjYXRlZ29yaWVzKHZhbHVlOiBBcnJheTxzdHJpbmc+KSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICB0aGlzLl9jYXRlZ29yaWVzID0gdmFsdWU7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGNhdGVnb3JpZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NhdGVnb3JpZXM7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBPYmpldG8gY29tIGFzIGNvbmZpZ3VyYcOnw7VlcyB1c2FkYXMgbm8gYHBvLWNoYXJ0YC5cbiAgICpcbiAgICogw4kgcG9zc8OtdmVsLCBwb3IgZXhlbXBsbywgZGVmaW5pciBhcyBjb25maWd1cmHDp8O1ZXMgZGUgZXhpYmnDp8OjbyBkYXMgbGVnZW5kYXMsXG4gICAqIGNvbmZpZ3VyYXIgb3MgZWl4b3MoKmF4aXMqKSBwYXJhIG9zIGdyw6FmaWNvcyBkb3MgdGlwb3MgYGFyZWFgLCBgbGluZWAsIGBjb2x1bW5gIGUgYGJhcmAgZGEgc2VndWludGUgZm9ybWE6XG4gICAqXG4gICAqIGBgYFxuICAgKiAgY2hhcnRPcHRpb25zOiBQb0NoYXJ0T3B0aW9ucyA9IHtcbiAgICogICAgbGVnZW5kOiB0cnVlLFxuICAgKiAgICBheGlzOiB7XG4gICAqICAgICAgbWluUmFuZ2U6IDAsXG4gICAqICAgICAgbWF4UmFuZ2U6IDEwMCxcbiAgICogICAgICBncmlkTGluZXM6IDUsXG4gICAqICAgIH0sXG4gICAqICB9O1xuICAgKiBgYGBcbiAgICovXG4gIEBJbnB1dCgncC1vcHRpb25zJykgc2V0IG9wdGlvbnModmFsdWU6IFBvQ2hhcnRPcHRpb25zKSB7XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0ICYmICEodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgIHRoaXMuX29wdGlvbnMgPSB2YWx1ZTtcblxuICAgICAgaWYgKHRoaXMuX29wdGlvbnMuaGFzT3duUHJvcGVydHkoJ2xlZ2VuZCcpICYmIHR5cGVvZiB0aGlzLl9vcHRpb25zLmxlZ2VuZCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIHRoaXMuZ2V0U3ZnQ29udGFpbmVyU2l6ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldCBvcHRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNvbG9yU2VydmljZTogUG9Db2xvclNlcnZpY2UpIHt9XG5cbiAgZ2V0IGlzVHlwZUNpcmN1bGFyKCkge1xuICAgIHJldHVybiB0aGlzLmRlZmF1bHRUeXBlID09PSBQb0NoYXJ0VHlwZS5QaWUgfHwgdGhpcy5kZWZhdWx0VHlwZSA9PT0gUG9DaGFydFR5cGUuRG9udXQ7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgY29uc3QgaXNBcnJheU9mc2VyaWVzID0gQXJyYXkuaXNBcnJheSh0aGlzLnNlcmllcykgJiYgdGhpcy5zZXJpZXMubGVuZ3RoID4gMDtcblxuICAgIGlmIChcbiAgICAgIChjaGFuZ2VzLnNlcmllcyAmJiBpc0FycmF5T2ZzZXJpZXMpIHx8XG4gICAgICAoY2hhbmdlcy50eXBlICYmIGlzQXJyYXlPZnNlcmllcykgfHxcbiAgICAgIChjaGFuZ2VzLmNhdGVnb3JpZXMgJiYgaXNBcnJheU9mc2VyaWVzKVxuICAgICkge1xuICAgICAgdGhpcy52YWxpZGF0ZVNlcmllQW5kQWRkVHlwZSh0aGlzLnNlcmllcyk7XG4gICAgfVxuXG4gICAgaWYgKChjaGFuZ2VzLnR5cGUgJiYgIXRoaXMuaXNUeXBlQ2lyY3VsYXIpIHx8IChjaGFuZ2VzLmNhdGVnb3JpZXMgJiYgIXRoaXMuaXNUeXBlQ2lyY3VsYXIpKSB7XG4gICAgICB0aGlzLnN2Z0NvbnRhaW5lclNpemUgPSB7XG4gICAgICAgIC4uLnRoaXMuc3ZnQ29udGFpbmVyU2l6ZSxcbiAgICAgICAgYXhpc1hMYWJlbFdpZHRoOiB0aGlzLmNhbGN1bGF0ZUF4aXNYTGFiZWxBcmVhKClcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgb25TZXJpZXNDbGljayhldmVudDogYW55KTogdm9pZCB7XG4gICAgdGhpcy5zZXJpZXNDbGljay5lbWl0KGV2ZW50KTtcbiAgfVxuXG4gIG9uU2VyaWVzSG92ZXIoZXZlbnQ6IGFueSk6IHZvaWQge1xuICAgIHRoaXMuc2VyaWVzSG92ZXIuZW1pdChldmVudCk7XG4gIH1cblxuICBwcml2YXRlIHNldERlZmF1bHRIZWlnaHQoKSB7XG4gICAgcmV0dXJuIHBvQ2hhcnREZWZhdWx0SGVpZ2h0O1xuICB9XG5cbiAgcHJpdmF0ZSB0cmFuc2Zvcm1PYmplY3RUb0FycmF5T2JqZWN0KHNlcmllKSB7XG4gICAgdGhpcy5jaGFydFNlcmllcyA9IHR5cGVvZiBzZXJpZSA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LmtleXMoc2VyaWUpLmxlbmd0aCA/IFt7IC4uLnNlcmllIH1dIDogW107XG4gIH1cblxuICBwcml2YXRlIHNldFR5cGVEZWZhdWx0KHNlcmllOiBQb0NoYXJ0U2VyaWUpIHtcbiAgICBjb25zdCBkYXRhID0gc2VyaWUuZGF0YTtcbiAgICBjb25zdCBzZXJpZVR5cGUgPSAoPGFueT5PYmplY3QpLnZhbHVlcyhQb0NoYXJ0VHlwZSkuaW5jbHVkZXMoc2VyaWUudHlwZSkgPyBzZXJpZS50eXBlIDogdW5kZWZpbmVkO1xuXG4gICAgdGhpcy5kZWZhdWx0VHlwZSA9IHNlcmllVHlwZSA/IHNlcmllVHlwZSA6IEFycmF5LmlzQXJyYXkoZGF0YSkgPyBQb0NoYXJ0VHlwZS5Db2x1bW4gOiBQb0NoYXJ0VHlwZS5QaWU7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlU2VyaWVBbmRBZGRUeXBlKHNlcmllczogQXJyYXk8UG9DaGFydFNlcmllPik6IHZvaWQge1xuICAgIGNvbnN0IGZpbHRlcmVkU2VyaWVzID0gc2VyaWVzLmZpbHRlcihzZXJpZSA9PlxuICAgICAgdGhpcy5pc1R5cGVDaXJjdWxhciA/IHR5cGVvZiBzZXJpZS5kYXRhID09PSAnbnVtYmVyJyA6IEFycmF5LmlzQXJyYXkoc2VyaWUuZGF0YSlcbiAgICApO1xuXG4gICAgdGhpcy5jaGFydFNlcmllcyA9IHRoaXMuYXBwZW5kVHlwZSh0aGlzLmFwcGVuZENvbG9ycyhmaWx0ZXJlZFNlcmllcykpO1xuICB9XG5cbiAgcHJpdmF0ZSBhcHBlbmRDb2xvcnMoc2VyaWVzOiBBcnJheTxQb0NoYXJ0U2VyaWU+KSB7XG4gICAgcmV0dXJuIHRoaXMuY29sb3JTZXJ2aWNlLmdldENvbG9yczxQb0NoYXJ0U2VyaWU+KHNlcmllcyk7XG4gIH1cblxuICBwcml2YXRlIGFwcGVuZFR5cGUoc2VyaWVzOiBBcnJheTxQb0NoYXJ0U2VyaWU+KSB7XG4gICAgcmV0dXJuIHNlcmllcy5tYXAoKHNlcmllLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgIHRoaXMuY2hhcnRUeXBlID0gKDxhbnk+T2JqZWN0KS52YWx1ZXMoUG9DaGFydFR5cGUpLmluY2x1ZGVzKHNlcmllLnR5cGUpXG4gICAgICAgICAgPyBzZXJpZS50eXBlXG4gICAgICAgICAgOiB0aGlzLnR5cGUgfHwgdGhpcy5kZWZhdWx0VHlwZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgLi4uc2VyaWUsIHR5cGU6IHNlcmllLnR5cGUgfHwgdGhpcy5jaGFydFR5cGUgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGFic3RyYWN0IHJlYnVpbGRDb21wb25lbnRSZWYoKTogdm9pZDtcblxuICAvLyB2w6FsaWRvIHBhcmEgZ3LDoWZpY29zIGRvIHRpcG8gY2lyY3VsYXIgZSBxdWUgc2Vyw6EgcmVmYXRvcmFkby5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IGdldFN2Z0NvbnRhaW5lclNpemUoKTogdm9pZDtcbiAgcHJvdGVjdGVkIGFic3RyYWN0IGNhbGN1bGF0ZUF4aXNYTGFiZWxBcmVhKCk6IG51bWJlcjtcbn1cbiJdfQ==