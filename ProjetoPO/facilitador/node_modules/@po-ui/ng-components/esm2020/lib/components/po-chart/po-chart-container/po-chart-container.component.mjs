import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { PoChartType } from '../enums/po-chart-type.enum';
import * as i0 from "@angular/core";
import * as i1 from "../services/po-chart-maths.service";
import * as i2 from "@angular/common";
import * as i3 from "./po-chart-line/po-chart-area/po-chart-area.component";
import * as i4 from "./po-chart-axis/po-chart-axis.component";
import * as i5 from "./po-chart-line/po-chart-line.component";
import * as i6 from "./po-chart-circular/po-chart-pie/po-chart-pie.component";
import * as i7 from "./po-chart-circular/po-chart-donut/po-chart-donut.component";
import * as i8 from "./po-chart-bar/po-chart-bar.component";
import * as i9 from "./po-chart-bar/po-chart-column/po-chart-column.component";
const _c0 = ["svgELement"];
function PoChartContainerComponent__svg_g_2_Template(rf, ctx) { if (rf & 1) {
    const _r9 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 9);
    i0.ɵɵlistener("p-categories-coordinates", function PoChartContainerComponent__svg_g_2_Template__svg_g_p_categories_coordinates_0_listener($event) { i0.ɵɵrestoreView(_r9); const ctx_r8 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r8.getCategoriesCoordinates($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-align-by-the-corners", ctx_r1.alignByTheCorners)("p-range", ctx_r1.range)("p-type", ctx_r1.type)("p-series", ctx_r1.series)("p-container-size", ctx_r1.containerSize)("p-options", ctx_r1.axisOptions)("p-categories", ctx_r1.categories);
} }
function PoChartContainerComponent__svg_g_3_Template(rf, ctx) { if (rf & 1) {
    const _r11 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 10);
    i0.ɵɵlistener("p-bar-hover", function PoChartContainerComponent__svg_g_3_Template__svg_g_p_bar_hover_0_listener($event) { i0.ɵɵrestoreView(_r11); const ctx_r10 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r10.onSerieHover($event)); })("p-bar-click", function PoChartContainerComponent__svg_g_3_Template__svg_g_p_bar_click_0_listener($event) { i0.ɵɵrestoreView(_r11); const ctx_r12 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r12.onSerieClick($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-align-by-the-corners", ctx_r2.alignByTheCorners)("p-svg-space", ctx_r2.svgSpace)("p-categories", ctx_r2.categories)("p-categories-coordinates", ctx_r2.categoriesCoordinates)("p-range", ctx_r2.range)("p-series", ctx_r2.seriesByType["area"])("p-container-size", ctx_r2.containerSize);
} }
function PoChartContainerComponent__svg_g_4_Template(rf, ctx) { if (rf & 1) {
    const _r14 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 11);
    i0.ɵɵlistener("p-bar-hover", function PoChartContainerComponent__svg_g_4_Template__svg_g_p_bar_hover_0_listener($event) { i0.ɵɵrestoreView(_r14); const ctx_r13 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r13.onSerieHover($event)); })("p-bar-click", function PoChartContainerComponent__svg_g_4_Template__svg_g_p_bar_click_0_listener($event) { i0.ɵɵrestoreView(_r14); const ctx_r15 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r15.onSerieClick($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-categories", ctx_r3.categories)("p-range", ctx_r3.range)("p-series", ctx_r3.seriesByType["column"])("p-container-size", ctx_r3.containerSize);
} }
function PoChartContainerComponent__svg_g_5_Template(rf, ctx) { if (rf & 1) {
    const _r17 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 12);
    i0.ɵɵlistener("p-point-hover", function PoChartContainerComponent__svg_g_5_Template__svg_g_p_point_hover_0_listener($event) { i0.ɵɵrestoreView(_r17); const ctx_r16 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r16.onSerieHover($event)); })("p-point-click", function PoChartContainerComponent__svg_g_5_Template__svg_g_p_point_click_0_listener($event) { i0.ɵɵrestoreView(_r17); const ctx_r18 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r18.onSerieClick($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-categories", ctx_r4.categories)("p-range", ctx_r4.range)("p-series", ctx_r4.seriesByType["line"])("p-container-size", ctx_r4.containerSize);
} }
function PoChartContainerComponent__svg_g_6_Template(rf, ctx) { if (rf & 1) {
    const _r20 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 13);
    i0.ɵɵlistener("p-bar-hover", function PoChartContainerComponent__svg_g_6_Template__svg_g_p_bar_hover_0_listener($event) { i0.ɵɵrestoreView(_r20); const ctx_r19 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r19.onSerieHover($event)); })("p-bar-click", function PoChartContainerComponent__svg_g_6_Template__svg_g_p_bar_click_0_listener($event) { i0.ɵɵrestoreView(_r20); const ctx_r21 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r21.onSerieClick($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r5 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-categories", ctx_r5.categories)("p-range", ctx_r5.range)("p-series", ctx_r5.seriesByType["bar"])("p-container-size", ctx_r5.containerSize);
} }
function PoChartContainerComponent__svg_g_7_Template(rf, ctx) { if (rf & 1) {
    const _r23 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 14);
    i0.ɵɵlistener("p-circular-hover", function PoChartContainerComponent__svg_g_7_Template__svg_g_p_circular_hover_0_listener($event) { i0.ɵɵrestoreView(_r23); const ctx_r22 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r22.onSerieHover($event)); })("p-circular-click", function PoChartContainerComponent__svg_g_7_Template__svg_g_p_circular_click_0_listener($event) { i0.ɵɵrestoreView(_r23); const ctx_r24 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r24.onSerieClick($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r6 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-series", ctx_r6.seriesByType["pie"])("p-container-size", ctx_r6.containerSize);
} }
function PoChartContainerComponent__svg_g_8_Template(rf, ctx) { if (rf & 1) {
    const _r26 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 15);
    i0.ɵɵlistener("p-circular-hover", function PoChartContainerComponent__svg_g_8_Template__svg_g_p_circular_hover_0_listener($event) { i0.ɵɵrestoreView(_r26); const ctx_r25 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r25.onSerieHover($event)); })("p-circular-click", function PoChartContainerComponent__svg_g_8_Template__svg_g_p_circular_click_0_listener($event) { i0.ɵɵrestoreView(_r26); const ctx_r27 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r27.onSerieClick($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r7 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-options", ctx_r7.options)("p-series", ctx_r7.seriesByType["donut"])("p-container-size", ctx_r7.containerSize);
} }
export class PoChartContainerComponent {
    constructor(mathsService) {
        this.mathsService = mathsService;
        this.serieClick = new EventEmitter();
        this.serieHover = new EventEmitter();
        this._series = [];
    }
    set options(value) {
        if (value instanceof Object && !(value instanceof Array)) {
            this._options = value;
            this.verifyAxisOptions(this._options);
        }
    }
    get options() {
        return this._options;
    }
    set series(data) {
        this._series = data;
        this.setAlignByTheCorners(this._series);
        this.setSeriesByType(this._series);
        this.setRange(this._series, this.options);
    }
    get series() {
        return this._series;
    }
    get isTypeCircular() {
        return this.type === PoChartType.Pie || this.type === PoChartType.Donut;
    }
    ngOnChanges(changes) {
        if (changes.type || changes.containerSize) {
            this.setViewBox();
            this.setSvgSpace();
        }
    }
    getCategoriesCoordinates(value) {
        this.categoriesCoordinates = value;
    }
    onSerieClick(event) {
        this.serieClick.emit(event);
    }
    onSerieHover(event) {
        this.serieHover.emit(event);
    }
    getRange(series, options = {}) {
        const domain = this.mathsService.calculateMinAndMaxValues(series);
        const minValue = !options.axis?.minRange && domain.minValue > 0
            ? 0
            : options.axis?.minRange < domain.minValue
                ? options.axis.minRange
                : domain.minValue;
        const maxValue = options.axis?.maxRange > domain.maxValue ? options.axis.maxRange : domain.maxValue;
        const updatedDomainValues = { minValue, maxValue };
        return { ...domain, ...updatedDomainValues };
    }
    setSvgSpace() {
        // Representa um ponto 2D dentro do viewport do SVG. Ele é a representação do cursor do mouse para comparação de coordenadas com cada dado de série.
        const svgPoint = this.svgELement.nativeElement.createSVGPoint();
        // Retorna um DOMMatrix representando as matrizes 2D e 3D transformadas a partir das coordenadas do elemento, em relação ao document, para coordenadas relativas ao viewport do SVG.
        // É utilizado nos gráficos do tipo área para que seja possível equiparar as coordenadas do evento com cada dado de série, para assim ativar o ponto de dado equivalente.
        const svgDomMatrix = this.svgELement.nativeElement.getScreenCTM()?.inverse();
        this.svgSpace = { svgPoint, svgDomMatrix };
    }
    setAlignByTheCorners(series) {
        this.alignByTheCorners = series.every(serie => serie.type === PoChartType.Area || serie.type === PoChartType.Bar);
    }
    setRange(series, options = {}) {
        if (!this.isTypeCircular) {
            this.range = this.getRange(series, options);
        }
    }
    setSeriesByType(series) {
        this.seriesByType = {
            [PoChartType.Area]: series.filter(serie => serie.type === PoChartType.Area),
            [PoChartType.Column]: series.filter(serie => serie.type === PoChartType.Column),
            [PoChartType.Bar]: series.filter(serie => serie.type === PoChartType.Bar),
            [PoChartType.Line]: series.filter(serie => serie.type === PoChartType.Line),
            [PoChartType.Donut]: series.filter(serie => serie.type === PoChartType.Donut),
            [PoChartType.Pie]: series.filter(serie => serie.type === PoChartType.Pie)
        };
    }
    setViewBox() {
        const { svgWidth, svgHeight } = this.containerSize;
        const viewBoxWidth = this.isTypeCircular ? svgHeight : svgWidth;
        // Tratamento necessário para que não corte o vetor nas extremidades
        const offsetXY = 1;
        this.viewBox = `${offsetXY} -${offsetXY} ${viewBoxWidth} ${this.containerSize.svgHeight}`;
    }
    verifyAxisOptions(options) {
        if (!this.isTypeCircular && options.hasOwnProperty('axis')) {
            this.range = this.getRange(this.series, this.options);
            this.axisOptions = {
                ...this.axisOptions,
                ...options.axis
            };
        }
    }
}
PoChartContainerComponent.ɵfac = function PoChartContainerComponent_Factory(t) { return new (t || PoChartContainerComponent)(i0.ɵɵdirectiveInject(i1.PoChartMathsService)); };
PoChartContainerComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoChartContainerComponent, selectors: [["po-chart-container"]], viewQuery: function PoChartContainerComponent_Query(rf, ctx) { if (rf & 1) {
        i0.ɵɵviewQuery(_c0, 7);
    } if (rf & 2) {
        let _t;
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.svgELement = _t.first);
    } }, inputs: { categories: ["p-categories", "categories"], type: ["p-type", "type"], containerSize: ["p-container-size", "containerSize"], options: ["p-options", "options"], series: ["p-series", "series"] }, outputs: { serieClick: "p-serie-click", serieHover: "p-serie-hover" }, features: [i0.ɵɵNgOnChangesFeature], decls: 9, vars: 10, consts: [["preserveAspectRatio", "xMidYMin meet", 1, "po-chart-svg-element"], ["svgELement", ""], ["po-chart-axis", "", 3, "p-align-by-the-corners", "p-range", "p-type", "p-series", "p-container-size", "p-options", "p-categories", "p-categories-coordinates", 4, "ngIf"], ["po-chart-area", "", 3, "p-align-by-the-corners", "p-svg-space", "p-categories", "p-categories-coordinates", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click", 4, "ngIf"], ["po-chart-column", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click", 4, "ngIf"], ["po-chart-line", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-point-hover", "p-point-click", 4, "ngIf"], ["po-chart-bar", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click", 4, "ngIf"], ["po-chart-pie", "", 3, "p-series", "p-container-size", "p-circular-hover", "p-circular-click", 4, "ngIf"], ["po-chart-donut", "", 3, "p-options", "p-series", "p-container-size", "p-circular-hover", "p-circular-click", 4, "ngIf"], ["po-chart-axis", "", 3, "p-align-by-the-corners", "p-range", "p-type", "p-series", "p-container-size", "p-options", "p-categories", "p-categories-coordinates"], ["po-chart-area", "", 3, "p-align-by-the-corners", "p-svg-space", "p-categories", "p-categories-coordinates", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click"], ["po-chart-column", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click"], ["po-chart-line", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-point-hover", "p-point-click"], ["po-chart-bar", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click"], ["po-chart-pie", "", 3, "p-series", "p-container-size", "p-circular-hover", "p-circular-click"], ["po-chart-donut", "", 3, "p-options", "p-series", "p-container-size", "p-circular-hover", "p-circular-click"]], template: function PoChartContainerComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵnamespaceSVG();
        i0.ɵɵelementStart(0, "svg", 0, 1);
        i0.ɵɵtemplate(2, PoChartContainerComponent__svg_g_2_Template, 1, 7, "g", 2);
        i0.ɵɵtemplate(3, PoChartContainerComponent__svg_g_3_Template, 1, 7, "g", 3);
        i0.ɵɵtemplate(4, PoChartContainerComponent__svg_g_4_Template, 1, 4, "g", 4);
        i0.ɵɵtemplate(5, PoChartContainerComponent__svg_g_5_Template, 1, 4, "g", 5);
        i0.ɵɵtemplate(6, PoChartContainerComponent__svg_g_6_Template, 1, 4, "g", 6);
        i0.ɵɵtemplate(7, PoChartContainerComponent__svg_g_7_Template, 1, 2, "g", 7);
        i0.ɵɵtemplate(8, PoChartContainerComponent__svg_g_8_Template, 1, 3, "g", 8);
        i0.ɵɵelementEnd();
    } if (rf & 2) {
        i0.ɵɵattribute("viewBox", ctx.viewBox)("width", ctx.containerSize.svgWidth)("height", ctx.containerSize.svgHeight);
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("ngIf", !ctx.isTypeCircular);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", (ctx.type === "area" || ctx.type === "line" || ctx.type === "column") && ctx.seriesByType["area"].length);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", (ctx.type === "area" || ctx.type === "line" || ctx.type === "column") && ctx.seriesByType["column"].length);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", (ctx.type === "area" || ctx.type === "line" || ctx.type === "column") && ctx.seriesByType["line"].length);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", ctx.type === "bar");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", ctx.type === "pie");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", ctx.type === "donut");
    } }, dependencies: [i2.NgIf, i3.PoChartAreaComponent, i4.PoChartAxisComponent, i5.PoChartLineComponent, i6.PoChartPieComponent, i7.PoChartDonutComponent, i8.PoChartBarComponent, i9.PoChartColumnComponent], encapsulation: 2 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoChartContainerComponent, [{
        type: Component,
        args: [{ selector: 'po-chart-container', template: "<svg:svg\n  #svgELement\n  class=\"po-chart-svg-element\"\n  preserveAspectRatio=\"xMidYMin meet\"\n  [attr.viewBox]=\"viewBox\"\n  [attr.width]=\"containerSize.svgWidth\"\n  [attr.height]=\"containerSize.svgHeight\"\n>\n  <!-- axis -->\n  <svg:g\n    *ngIf=\"!isTypeCircular\"\n    po-chart-axis\n    [p-align-by-the-corners]=\"alignByTheCorners\"\n    [p-range]=\"range\"\n    [p-type]=\"type\"\n    [p-series]=\"series\"\n    [p-container-size]=\"containerSize\"\n    [p-options]=\"axisOptions\"\n    [p-categories]=\"categories\"\n    (p-categories-coordinates)=\"getCategoriesCoordinates($event)\"\n  ></svg:g>\n\n  <!-- chart area -->\n  <svg:g\n    *ngIf=\"(type === 'area' || type === 'line' || type === 'column') && seriesByType['area'].length\"\n    po-chart-area\n    [p-align-by-the-corners]=\"alignByTheCorners\"\n    [p-svg-space]=\"svgSpace\"\n    [p-categories]=\"categories\"\n    [p-categories-coordinates]=\"categoriesCoordinates\"\n    [p-range]=\"range\"\n    [p-series]=\"seriesByType['area']\"\n    [p-container-size]=\"containerSize\"\n    (p-bar-hover)=\"onSerieHover($event)\"\n    (p-bar-click)=\"onSerieClick($event)\"\n  ></svg:g>\n\n  <!-- chart column -->\n  <svg:g\n    *ngIf=\"(type === 'area' || type === 'line' || type === 'column') && seriesByType['column'].length\"\n    po-chart-column\n    [p-categories]=\"categories\"\n    [p-range]=\"range\"\n    [p-series]=\"seriesByType['column']\"\n    [p-container-size]=\"containerSize\"\n    (p-bar-hover)=\"onSerieHover($event)\"\n    (p-bar-click)=\"onSerieClick($event)\"\n  ></svg:g>\n\n  <!-- chart line -->\n  <svg:g\n    *ngIf=\"(type === 'area' || type === 'line' || type === 'column') && seriesByType['line'].length\"\n    po-chart-line\n    [p-categories]=\"categories\"\n    [p-range]=\"range\"\n    [p-series]=\"seriesByType['line']\"\n    [p-container-size]=\"containerSize\"\n    (p-point-hover)=\"onSerieHover($event)\"\n    (p-point-click)=\"onSerieClick($event)\"\n  ></svg:g>\n\n  <!-- chart bar -->\n  <svg:g\n    *ngIf=\"type === 'bar'\"\n    po-chart-bar\n    [p-categories]=\"categories\"\n    [p-range]=\"range\"\n    [p-series]=\"seriesByType['bar']\"\n    [p-container-size]=\"containerSize\"\n    (p-bar-hover)=\"onSerieHover($event)\"\n    (p-bar-click)=\"onSerieClick($event)\"\n  ></svg:g>\n\n  <svg:g\n    *ngIf=\"type === 'pie'\"\n    po-chart-pie\n    [p-series]=\"seriesByType['pie']\"\n    [p-container-size]=\"containerSize\"\n    (p-circular-hover)=\"onSerieHover($event)\"\n    (p-circular-click)=\"onSerieClick($event)\"\n  ></svg:g>\n\n  <svg:g\n    *ngIf=\"type === 'donut'\"\n    po-chart-donut\n    [p-options]=\"options\"\n    [p-series]=\"seriesByType['donut']\"\n    [p-container-size]=\"containerSize\"\n    (p-circular-hover)=\"onSerieHover($event)\"\n    (p-circular-click)=\"onSerieClick($event)\"\n  ></svg:g>\n</svg:svg>\n" }]
    }], function () { return [{ type: i1.PoChartMathsService }]; }, { categories: [{
            type: Input,
            args: ['p-categories']
        }], type: [{
            type: Input,
            args: ['p-type']
        }], containerSize: [{
            type: Input,
            args: ['p-container-size']
        }], serieClick: [{
            type: Output,
            args: ['p-serie-click']
        }], serieHover: [{
            type: Output,
            args: ['p-serie-hover']
        }], svgELement: [{
            type: ViewChild,
            args: ['svgELement', { static: true }]
        }], options: [{
            type: Input,
            args: ['p-options']
        }], series: [{
            type: Input,
            args: ['p-series']
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtY29udGFpbmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1jaGFydC9wby1jaGFydC1jb250YWluZXIvcG8tY2hhcnQtY29udGFpbmVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1jaGFydC9wby1jaGFydC1jb250YWluZXIvcG8tY2hhcnQtY29udGFpbmVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQWMsWUFBWSxFQUFFLEtBQUssRUFBYSxNQUFNLEVBQWlCLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV4SCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7Ozs7Ozs7Ozs7Ozs7OztJQ094RCw0QkFXQztJQURDLHFOQUE0QixlQUFBLHVDQUFnQyxDQUFBLElBQUM7SUFDOUQsaUJBQVE7OztJQVJQLGlFQUE0Qyx5QkFBQSx1QkFBQSwyQkFBQSwwQ0FBQSxpQ0FBQSxtQ0FBQTs7Ozs7SUFXOUMsNkJBWUM7SUFGQyw2TEFBZSxlQUFBLDRCQUFvQixDQUFBLElBQUMsZ0xBQ3JCLGVBQUEsNEJBQW9CLENBQUEsSUFEQztJQUVyQyxpQkFBUTs7O0lBVFAsaUVBQTRDLGdDQUFBLG1DQUFBLDBEQUFBLHlCQUFBLHlDQUFBLDBDQUFBOzs7OztJQVk5Qyw2QkFTQztJQUZDLDZMQUFlLGVBQUEsNEJBQW9CLENBQUEsSUFBQyxnTEFDckIsZUFBQSw0QkFBb0IsQ0FBQSxJQURDO0lBRXJDLGlCQUFROzs7SUFOUCxnREFBMkIseUJBQUEsMkNBQUEsMENBQUE7Ozs7O0lBUzdCLDZCQVNDO0lBRkMsaU1BQWlCLGVBQUEsNEJBQW9CLENBQUEsSUFBQyxvTEFDckIs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SEFBOEY7UUFZOUYsZUFBb0I7UUFBcEIseUNBQW9CO1FBV3BCLGVBQW9CO1FBQXBCLHlDQUFvQjtRQVNwQixlQUFzQjtRQUF0QiwyQ0FBc0I7O3VGRHJFZCx5QkFBeUI7Y0FKckMsU0FBUzsyQkFDRSxvQkFBb0I7c0VBSVAsVUFBVTtrQkFBaEMsS0FBSzttQkFBQyxjQUFjO1lBRUosSUFBSTtrQkFBcEIsS0FBSzttQkFBQyxRQUFRO1lBRVksYUFBYTtrQkFBdkMsS0FBSzttQkFBQyxrQkFBa0I7WUFFQSxVQUFVO2tCQUFsQyxNQUFNO21CQUFDLGVBQWU7WUFFRSxVQUFVO2tCQUFsQyxNQUFNO21CQUFDLGVBQWU7WUFFb0IsVUFBVTtrQkFBcEQsU0FBUzttQkFBQyxZQUFZLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO1lBYWpCLE9BQU87a0JBQTlCLEtBQUs7bUJBQUMsV0FBVztZQVlLLE1BQU07a0JBQTVCLEtBQUs7bUJBQUMsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBQb0NoYXJ0VHlwZSB9IGZyb20gJy4uL2VudW1zL3BvLWNoYXJ0LXR5cGUuZW51bSc7XG5pbXBvcnQgeyBQb0NoYXJ0Q29udGFpbmVyU2l6ZSB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tY2hhcnQtY29udGFpbmVyLXNpemUuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvQ2hhcnRPcHRpb25zIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wby1jaGFydC1vcHRpb25zLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0NoYXJ0QXhpc09wdGlvbnMgfSBmcm9tICcuLi9pbnRlcmZhY2VzL3BvLWNoYXJ0LWF4aXMtb3B0aW9ucy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9DaGFydE1hdGhzU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3BvLWNoYXJ0LW1hdGhzLnNlcnZpY2UnO1xuaW1wb3J0IHsgUG9DaGFydE1pbk1heFZhbHVlcyB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tY2hhcnQtbWluLW1heC12YWx1ZXMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvQ2hhcnRTZXJpZSB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tY2hhcnQtc2VyaWUuaW50ZXJmYWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tY2hhcnQtY29udGFpbmVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLWNoYXJ0LWNvbnRhaW5lci5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9DaGFydENvbnRhaW5lckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG4gIEBJbnB1dCgncC1jYXRlZ29yaWVzJykgY2F0ZWdvcmllczogQXJyYXk8c3RyaW5nPjtcblxuICBASW5wdXQoJ3AtdHlwZScpIHR5cGU6IFBvQ2hhcnRUeXBlO1xuXG4gIEBJbnB1dCgncC1jb250YWluZXItc2l6ZScpIGNvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplO1xuXG4gIEBPdXRwdXQoJ3Atc2VyaWUtY2xpY2snKSBzZXJpZUNsaWNrID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQE91dHB1dCgncC1zZXJpZS1ob3ZlcicpIHNlcmllSG92ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAVmlld0NoaWxkKCdzdmdFTGVtZW50JywgeyBzdGF0aWM6IHRydWUgfSkgc3ZnRUxlbWVudDogRWxlbWVudFJlZjtcblxuICBhbGlnbkJ5VGhlQ29ybmVyczogYm9vbGVhbjtcbiAgYXhpc09wdGlvbnM6IFBvQ2hhcnRBeGlzT3B0aW9ucztcbiAgY2F0ZWdvcmllc0Nvb3JkaW5hdGVzOiBBcnJheTxudW1iZXI+O1xuICByYW5nZTogUG9DaGFydE1pbk1heFZhbHVlcztcbiAgc2VyaWVzQnlUeXBlO1xuICBzdmdTcGFjZTtcbiAgdmlld0JveDogc3RyaW5nO1xuXG4gIHByaXZhdGUgX29wdGlvbnM6IFBvQ2hhcnRPcHRpb25zO1xuICBwcml2YXRlIF9zZXJpZXM6IEFycmF5PFBvQ2hhcnRTZXJpZT4gPSBbXTtcblxuICBASW5wdXQoJ3Atb3B0aW9ucycpIHNldCBvcHRpb25zKHZhbHVlOiBQb0NoYXJ0T3B0aW9ucykge1xuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE9iamVjdCAmJiAhKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpKSB7XG4gICAgICB0aGlzLl9vcHRpb25zID0gdmFsdWU7XG5cbiAgICAgIHRoaXMudmVyaWZ5QXhpc09wdGlvbnModGhpcy5fb3B0aW9ucyk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IG9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XG4gIH1cblxuICBASW5wdXQoJ3Atc2VyaWVzJykgc2V0IHNlcmllcyhkYXRhOiBBcnJheTxQb0NoYXJ0U2VyaWU+KSB7XG4gICAgdGhpcy5fc2VyaWVzID0gZGF0YTtcbiAgICB0aGlzLnNldEFsaWduQnlUaGVDb3JuZXJzKHRoaXMuX3Nlcmllcyk7XG4gICAgdGhpcy5zZXRTZXJpZXNCeVR5cGUodGhpcy5fc2VyaWVzKTtcbiAgICB0aGlzLnNldFJhbmdlKHRoaXMuX3NlcmllcywgdGhpcy5vcHRpb25zKTtcbiAgfVxuXG4gIGdldCBzZXJpZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlcmllcztcbiAgfVxuXG4gIGdldCBpc1R5cGVDaXJjdWxhcigpIHtcbiAgICByZXR1cm4gdGhpcy50eXBlID09PSBQb0NoYXJ0VHlwZS5QaWUgfHwgdGhpcy50eXBlID09PSBQb0NoYXJ0VHlwZS5Eb251dDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbWF0aHNTZXJ2aWNlOiBQb0NoYXJ0TWF0aHNTZXJ2aWNlKSB7fVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoY2hhbmdlcy50eXBlIHx8IGNoYW5nZXMuY29udGFpbmVyU2l6ZSkge1xuICAgICAgdGhpcy5zZXRWaWV3Qm94KCk7XG4gICAgICB0aGlzLnNldFN2Z1NwYWNlKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0Q2F0ZWdvcmllc0Nvb3JkaW5hdGVzKHZhbHVlOiBBcnJheTxudW1iZXI+KTogdm9pZCB7XG4gICAgdGhpcy5jYXRlZ29yaWVzQ29vcmRpbmF0ZXMgPSB2YWx1ZTtcbiAgfVxuXG4gIG9uU2VyaWVDbGljayhldmVudDogYW55KSB7XG4gICAgdGhpcy5zZXJpZUNsaWNrLmVtaXQoZXZlbnQpO1xuICB9XG5cbiAgb25TZXJpZUhvdmVyKGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLnNlcmllSG92ZXIuZW1pdChldmVudCk7XG4gIH1cblxuICBwcml2YXRlIGdldFJhbmdlKHNlcmllczogQXJyYXk8UG9DaGFydFNlcmllPiwgb3B0aW9uczogUG9DaGFydE9wdGlvbnMgPSB7fSk6IFBvQ2hhcnRNaW5NYXhWYWx1ZXMge1xuICAgIGNvbnN0IGRvbWFpbiA9IHRoaXMubWF0aHNTZXJ2aWNlLmNhbGN1bGF0ZU1pbkFuZE1heFZhbHVlcyhzZXJpZXMpO1xuICAgIGNvbnN0IG1pblZhbHVlID1cbiAgICAgICFvcHRpb25zLmF4aXM/Lm1pblJhbmdlICYmIGRvbWFpbi5taW5WYWx1ZSA+IDBcbiAgICAgICAgPyAwXG4gICAgICAgIDogb3B0aW9ucy5heGlzPy5taW5SYW5nZSA8IGRvbWFpbi5taW5WYWx1ZVxuICAgICAgICA/IG9wdGlvbnMuYXhpcy5taW5SYW5nZVxuICAgICAgICA6IGRvbWFpbi5taW5WYWx1ZTtcbiAgICBjb25zdCBtYXhWYWx1ZSA9IG9wdGlvbnMuYXhpcz8ubWF4UmFuZ2UgPiBkb21haW4ubWF4VmFsdWUgPyBvcHRpb25zLmF4aXMubWF4UmFuZ2UgOiBkb21haW4ubWF4VmFsdWU7XG4gICAgY29uc3QgdXBkYXRlZERvbWFpblZhbHVlcyA9IHsgbWluVmFsdWUsIG1heFZhbHVlIH07XG5cbiAgICByZXR1cm4geyAuLi5kb21haW4sIC4uLnVwZGF0ZWREb21haW5WYWx1ZXMgfTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0U3ZnU3BhY2UoKSB7XG4gICAgLy8gUmVwcmVzZW50YSB1bSBwb250byAyRCBkZW50cm8gZG8gdmlld3BvcnQgZG8gU1ZHLiBFbGUgw6kgYSByZXByZXNlbnRhw6fDo28gZG8gY3Vyc29yIGRvIG1vdXNlIHBhcmEgY29tcGFyYcOnw6NvIGRlIGNvb3JkZW5hZGFzIGNvbSBjYWRhIGRhZG8gZGUgc8OpcmllLlxuICAgIGNvbnN0IHN2Z1BvaW50ID0gdGhpcy5zdmdFTGVtZW50Lm5hdGl2ZUVsZW1lbnQuY3JlYXRlU1ZHUG9pbnQoKTtcbiAgICAvLyBSZXRvcm5hIHVtIERPTU1hdHJpeCByZXByZXNlbnRhbmRvIGFzIG1hdHJpemVzIDJEIGUgM0QgdHJhbnNmb3JtYWRhcyBhIHBhcnRpciBkYXMgY29vcmRlbmFkYXMgZG8gZWxlbWVudG8sIGVtIHJlbGHDp8OjbyBhbyBkb2N1bWVudCwgcGFyYSBjb29yZGVuYWRhcyByZWxhdGl2YXMgYW8gdmlld3BvcnQgZG8gU1ZHLlxuICAgIC8vIMOJIHV0aWxpemFkbyBub3MgZ3LDoWZpY29zIGRvIHRpcG8gw6FyZWEgcGFyYSBxdWUgc2VqYSBwb3Nzw612ZWwgZXF1aXBhcmFyIGFzIGNvb3JkZW5hZGFzIGRvIGV2ZW50byBjb20gY2FkYSBkYWRvIGRlIHPDqXJpZSwgcGFyYSBhc3NpbSBhdGl2YXIgbyBwb250byBkZSBkYWRvIGVxdWl2YWxlbnRlLlxuICAgIGNvbnN0IHN2Z0RvbU1hdHJpeCA9IHRoaXMuc3ZnRUxlbWVudC5uYXRpdmVFbGVtZW50LmdldFNjcmVlbkNUTSgpPy5pbnZlcnNlKCk7XG5cbiAgICB0aGlzLnN2Z1NwYWNlID0geyBzdmdQb2ludCwgc3ZnRG9tTWF0cml4IH07XG4gIH1cblxuICBwcml2YXRlIHNldEFsaWduQnlUaGVDb3JuZXJzKHNlcmllczogQXJyYXk8UG9DaGFydFNlcmllPik6IHZvaWQge1xuICAgIHRoaXMuYWxpZ25CeVRoZUNvcm5lcnMgPSBzZXJpZXMuZXZlcnkoc2VyaWUgPT4gc2VyaWUudHlwZSA9PT0gUG9DaGFydFR5cGUuQXJlYSB8fCBzZXJpZS50eXBlID09PSBQb0NoYXJ0VHlwZS5CYXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRSYW5nZShzZXJpZXM6IEFycmF5PFBvQ2hhcnRTZXJpZT4sIG9wdGlvbnM6IFBvQ2hhcnRPcHRpb25zID0ge30pIHtcbiAgICBpZiAoIXRoaXMuaXNUeXBlQ2lyY3VsYXIpIHtcbiAgICAgIHRoaXMucmFuZ2UgPSB0aGlzLmdldFJhbmdlKHNlcmllcywgb3B0aW9ucyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRTZXJpZXNCeVR5cGUoc2VyaWVzOiBBcnJheTxQb0NoYXJ0U2VyaWU+KSB7XG4gICAgdGhpcy5zZXJpZXNCeVR5cGUgPSB7XG4gICAgICBbUG9DaGFydFR5cGUuQXJlYV06IHNlcmllcy5maWx0ZXIoc2VyaWUgPT4gc2VyaWUudHlwZSA9PT0gUG9DaGFydFR5cGUuQXJlYSksXG4gICAgICBbUG9DaGFydFR5cGUuQ29sdW1uXTogc2VyaWVzLmZpbHRlcihzZXJpZSA9PiBzZXJpZS50eXBlID09PSBQb0NoYXJ0VHlwZS5Db2x1bW4pLFxuICAgICAgW1BvQ2hhcnRUeXBlLkJhcl06IHNlcmllcy5maWx0ZXIoc2VyaWUgPT4gc2VyaWUudHlwZSA9PT0gUG9DaGFydFR5cGUuQmFyKSxcbiAgICAgIFtQb0NoYXJ0VHlwZS5MaW5lXTogc2VyaWVzLmZpbHRlcihzZXJpZSA9PiBzZXJpZS50eXBlID09PSBQb0NoYXJ0VHlwZS5MaW5lKSxcbiAgICAgIFtQb0NoYXJ0VHlwZS5Eb251dF06IHNlcmllcy5maWx0ZXIoc2VyaWUgPT4gc2VyaWUudHlwZSA9PT0gUG9DaGFydFR5cGUuRG9udXQpLFxuICAgICAgW1BvQ2hhcnRUeXBlLlBpZV06IHNlcmllcy5maWx0ZXIoc2VyaWUgPT4gc2VyaWUudHlwZSA9PT0gUG9DaGFydFR5cGUuUGllKVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHNldFZpZXdCb3goKSB7XG4gICAgY29uc3QgeyBzdmdXaWR0aCwgc3ZnSGVpZ2h0IH0gPSB0aGlzLmNvbnRhaW5lclNpemU7XG4gICAgY29uc3Qgdmlld0JveFdpZHRoID0gdGhpcy5pc1R5cGVDaXJjdWxhciA/IHN2Z0hlaWdodCA6IHN2Z1dpZHRoO1xuICAgIC8vIFRyYXRhbWVudG8gbmVjZXNzw6FyaW8gcGFyYSBxdWUgbsOjbyBjb3J0ZSBvIHZldG9yIG5hcyBleHRyZW1pZGFkZXNcbiAgICBjb25zdCBvZmZzZXRYWSA9IDE7XG5cbiAgICB0aGlzLnZpZXdCb3ggPSBgJHtvZmZzZXRYWX0gLSR7b2Zmc2V0WFl9ICR7dmlld0JveFdpZHRofSAke3RoaXMuY29udGFpbmVyU2l6ZS5zdmdIZWlnaHR9YDtcbiAgfVxuXG4gIHByaXZhdGUgdmVyaWZ5QXhpc09wdGlvbnMob3B0aW9uczogUG9DaGFydE9wdGlvbnMpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaXNUeXBlQ2lyY3VsYXIgJiYgb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnYXhpcycpKSB7XG4gICAgICB0aGlzLnJhbmdlID0gdGhpcy5nZXRSYW5nZSh0aGlzLnNlcmllcywgdGhpcy5vcHRpb25zKTtcbiAgICAgIHRoaXMuYXhpc09wdGlvbnMgPSB7XG4gICAgICAgIC4uLnRoaXMuYXhpc09wdGlvbnMsXG4gICAgICAgIC4uLm9wdGlvbnMuYXhpc1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cbiIsIjxzdmc6c3ZnXG4gICNzdmdFTGVtZW50XG4gIGNsYXNzPVwicG8tY2hhcnQtc3ZnLWVsZW1lbnRcIlxuICBwcmVzZXJ2ZUFzcGVjdFJhdGlvPVwieE1pZFlNaW4gbWVldFwiXG4gIFthdHRyLnZpZXdCb3hdPVwidmlld0JveFwiXG4gIFthdHRyLndpZHRoXT1cImNvbnRhaW5lclNpemUuc3ZnV2lkdGhcIlxuICBbYXR0ci5oZWlnaHRdPVwiY29udGFpbmVyU2l6ZS5zdmdIZWlnaHRcIlxuPlxuICA8IS0tIGF4aXMgLS0+XG4gIDxzdmc6Z1xuICAgICpuZ0lmPVwiIWlzVHlwZUNpcmN1bGFyXCJcbiAgICBwby1jaGFydC1heGlzXG4gICAgW3AtYWxpZ24tYnktdGhlLWNvcm5lcnNdPVwiYWxpZ25CeVRoZUNvcm5lcnNcIlxuICAgIFtwLXJhbmdlXT1cInJhbmdlXCJcbiAgICBbcC10eXBlXT1cInR5cGVcIlxuICAgIFtwLXNlcmllc109XCJzZXJpZXNcIlxuICAgIFtwLWNvbnRhaW5lci1zaXplXT1cImNvbnRhaW5lclNpemVcIlxuICAgIFtwLW9wdGlvbnNdPVwiYXhpc09wdGlvbnNcIlxuICAgIFtwLWNhdGVnb3JpZXNdPVwiY2F0ZWdvcmllc1wiXG4gICAgKHAtY2F0ZWdvcmllcy1jb29yZGluYXRlcyk9XCJnZXRDYXRlZ29yaWVzQ29vcmRpbmF0ZXMoJGV2ZW50KVwiXG4gID48L3N2ZzpnPlxuXG4gIDwhLS0gY2hhcnQgYXJlYSAtLT5cbiAgPHN2ZzpnXG4gICAgKm5nSWY9XCIodHlwZSA9PT0gJ2FyZWEnIHx8IHR5cGUgPT09ICdsaW5lJyB8fCB0eXBlID09PSAnY29sdW1uJykgJiYgc2VyaWVzQnlUeXBlWydhcmVhJ10ubGVuZ3RoXCJcbiAgICBwby1jaGFydC1hcmVhXG4gICAgW3AtYWxpZ24tYnktdGhlLWNvcm5lcnNdPVwiYWxpZ25CeVRoZUNvcm5lcnNcIlxuICAgIFtwLXN2Zy1zcGFjZV09XCJzdmdTcGFjZVwiXG4gICAgW3AtY2F0ZWdvcmllc109XCJjYXRlZ29yaWVzXCJcbiAgICBbcC1jYXRlZ29yaWVzLWNvb3JkaW5hdGVzXT1cImNhdGVnb3JpZXNDb29yZGluYXRlc1wiXG4gICAgW3AtcmFuZ2VdPVwicmFuZ2VcIlxuICAgIFtwLXNlcmllc109XCJzZXJpZXNCeVR5cGVbJ2FyZWEnXVwiXG4gICAgW3AtY29udGFpbmVyLXNpemVdPVwiY29udGFpbmVyU2l6ZVwiXG4gICAgKHAtYmFyLWhvdmVyKT1cIm9uU2VyaWVIb3ZlcigkZXZlbnQpXCJcbiAgICAocC1iYXItY2xpY2spPVwib25TZXJpZUNsaWNrKCRldmVudClcIlxuICA+PC9zdmc6Zz5cblxuICA8IS0tIGNoYXJ0IGNvbHVtbiAtLT5cbiAgPHN2ZzpnXG4gICAgKm5nSWY9XCIodHlwZSA9PT0gJ2FyZWEnIHx8IHR5cGUgPT09ICdsaW5lJyB8fCB0eXBlID09PSAnY29sdW1uJykgJiYgc2VyaWVzQnlUeXBlWydjb2x1bW4nXS5sZW5ndGhcIlxuICAgIHBvLWNoYXJ0LWNvbHVtblxuICAgIFtwLWNhdGVnb3JpZXNdPVwiY2F0ZWdvcmllc1wiXG4gICAgW3AtcmFuZ2VdPVwicmFuZ2VcIlxuICAgIFtwLXNlcmllc109XCJzZXJpZXNCeVR5cGVbJ2NvbHVtbiddXCJcbiAgICBbcC1jb250YWluZXItc2l6ZV09XCJjb250YWluZXJTaXplXCJcbiAgICAocC1iYXItaG92ZXIpPVwib25TZXJpZUhvdmVyKCRldmVudClcIlxuICAgIChwLWJhci1jbGljayk9XCJvblNlcmllQ2xpY2soJGV2ZW50KVwiXG4gID48L3N2ZzpnPlxuXG4gIDwhLS0gY2hhcnQgbGluZSAtLT5cbiAgPHN2ZzpnXG4gICAgKm5nSWY9XCIodHlwZSA9PT0gJ2FyZWEnIHx8IHR5cGUgPT09ICdsaW5lJyB8fCB0eXBlID09PSAnY29sdW1uJykgJiYgc2VyaWVzQnlUeXBlWydsaW5lJ10ubGVuZ3RoXCJcbiAgICBwby1jaGFydC1saW5lXG4gICAgW3AtY2F0ZWdvcmllc109XCJjYXRlZ29yaWVzXCJcbiAgICBbcC1yYW5nZV09XCJyYW5nZVwiXG4gICAgW3Atc2VyaWVzXT1cInNlcmllc0J5VHlwZVsnbGluZSddXCJcbiAgICBbcC1jb250YWluZXItc2l6ZV09XCJjb250YWluZXJTaXplXCJcbiAgICAocC1wb2ludC1ob3Zlcik9XCJvblNlcmllSG92ZXIoJGV2ZW50KVwiXG4gICAgKHAtcG9pbnQtY2xpY2spPVwib25TZXJpZUNsaWNrKCRldmVudClcIlxuICA+PC9zdmc6Zz5cblxuICA8IS0tIGNoYXJ0IGJhciAtLT5cbiAgPHN2ZzpnXG4gICAgKm5nSWY9XCJ0eXBlID09PSAnYmFyJ1wiXG4gICAgcG8tY2hhcnQtYmFyXG4gICAgW3AtY2F0ZWdvcmllc109XCJjYXRlZ29yaWVzXCJcbiAgICBbcC1yYW5nZV09XCJyYW5nZVwiXG4gICAgW3Atc2VyaWVzXT1cInNlcmllc0J5VHlwZVsnYmFyJ11cIlxuICAgIFtwLWNvbnRhaW5lci1zaXplXT1cImNvbnRhaW5lclNpemVcIlxuICAgIChwLWJhci1ob3Zlcik9XCJvblNlcmllSG92ZXIoJGV2ZW50KVwiXG4gICAgKHAtYmFyLWNsaWNrKT1cIm9uU2VyaWVDbGljaygkZXZlbnQpXCJcbiAgPjwvc3ZnOmc+XG5cbiAgPHN2ZzpnXG4gICAgKm5nSWY9XCJ0eXBlID09PSAncGllJ1wiXG4gICAgcG8tY2hhcnQtcGllXG4gICAgW3Atc2VyaWVzXT1cInNlcmllc0J5VHlwZVsncGllJ11cIlxuICAgIFtwLWNvbnRhaW5lci1zaXplXT1cImNvbnRhaW5lclNpemVcIlxuICAgIChwLWNpcmN1bGFyLWhvdmVyKT1cIm9uU2VyaWVIb3ZlcigkZXZlbnQpXCJcbiAgICAocC1jaXJjdWxhci1jbGljayk9XCJvblNlcmllQ2xpY2soJGV2ZW50KVwiXG4gID48L3N2ZzpnPlxuXG4gIDxzdmc6Z1xuICAgICpuZ0lmPVwidHlwZSA9PT0gJ2RvbnV0J1wiXG4gICAgcG8tY2hhcnQtZG9udXRcbiAgICBbcC1vcHRpb25zXT1cIm9wdGlvbnNcIlxuICAgIFtwLXNlcmllc109XCJzZXJpZXNCeVR5cGVbJ2RvbnV0J11cIlxuICAgIFtwLWNvbnRhaW5lci1zaXplXT1cImNvbnRhaW5lclNpemVcIlxuICAgIChwLWNpcmN1bGFyLWhvdmVyKT1cIm9uU2VyaWVIb3ZlcigkZXZlbnQpXCJcbiAgICAocC1jaXJjdWxhci1jbGljayk9XCJvblNlcmllQ2xpY2soJGV2ZW50KVwiXG4gID48L3N2ZzpnPlxuPC9zdmc6c3ZnPlxuIl19