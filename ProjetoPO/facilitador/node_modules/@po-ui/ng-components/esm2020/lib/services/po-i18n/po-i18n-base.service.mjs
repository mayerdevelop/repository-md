import { __decorate, __param } from "tslib";
import { HttpClient } from '@angular/common/http';
import { Inject } from '@angular/core';
import { Observable } from 'rxjs';
import { isLanguage, reloadCurrentPage } from '../../utils/util';
import { I18N_CONFIG } from './po-i18n-config-injection-token';
/**
 * @description
 *
 * O serviço `PoI18nService` possibilita utilizar múltiplos idiomas e contextos na aplicação.
 *
 * > Antes da utilização do serviço, é necessário realizar a
 * [importação e configuração do módulo `PoI18nModule`](/documentation/po-i18n#i18n-config).
 *
 * **Utilização do serviço `PoI18nService`:**
 *
 * Para utilizar o serviço basta importá-lo nos componentes que necessitarem de literais e fazer a injeção de
 * dependência no construtor:
 * ```
 *  import { PoI18nService } from '@po-ui/ng-components';
 *  ...
 *  constructor(private poI18nService: PoI18nService) { }
 *  ...
 * ```
 *
 * Por fim realizar a busca pelas literais, inscrevendo-se no [Observable](https://angular.io/guide/observables) pelo
 * método `getLiterals()`.
 *
 * > O método `getLiterals()` pode receber um objeto do tipo da interface `PoI18nLiterals` como parâmetro,
 * porém, nenhuma das propriedades são obrigatórias. Caso nenhum parâmetro seja passado, serão buscadas
 * todas as literais do contexto definido com padrão, no idioma definido como padrão.
 *
 * Exemplos de requisição:
 * ```
 * literals = {};
 * literalsEn = {};
 * literalsCrm = {};
 *
 * constructor(private poI18nService: PoI18nService) {
 *   poI18nService.getLiterals()
 *     .subscribe((literals) => {
 *       this.literals = literals;
 *     });
 *
 *   poI18nService.getLiterals({context: 'crm', literals: ['add', 'remove']})
 *     .subscribe((literals) => {
 *       this.literalsCrm = literals;
 *     });
 *
 *   poI18nService.getLiterals({language: 'en-us'})
 *     .subscribe((literals) => {
 *       this.literalsEn = literals;
 *     });
 * }
 * ```
 *
 * Para apresentar as literais capturadas acima no HTML do componente, deve-se utilizar o
 * seguinte código:
 *
 * <pre ngNonBindable>
 * {{ literals?.add }}
 * {{ literals?.remove }}
 * </pre>
 *
 * Caso as literais contenham variáveis que precisem ser substituídas, pode-se utilizar o *pipe* `poI18n`.
 * É possível informar propriedades do componente como `name` e `nickname` ou
 * informar o valor diretamente com "" ou número, conforme o exemplo abaixo:
 *
 * <pre ngNonBindable>
 * {{ literals?.people | poI18n:[120] }}
 * {{ literals?.greeting | poI18n:[name, nickname] }}
 * {{ literals?.greeting | poI18n:["Brad", "Green"] }}
 * </pre>
 *
 * > É importante o uso do operador `?` (Elvis) para evitar erros enquanto as literais não forem carregadas.
 *
 * ### Teste unitário
 *
 * Abaixo segue um exemplo de *setup* inicial de teste unitário do *AppComponent* que utiliza o `PoI18nService`:
 *
 * > Atenção: não declarar o `PoI18nService` no providers do TestBed pois a biblioteca realiza a injeção de dependência de forma dinâmica.
 * > Se o serviço for declarado o teste não fará a injeção e o teste apresentará erros.
 *
 * ```
 * import { async, TestBed } from '@angular/core/testing';
 * import { HttpClientTestingModule } from '@angular/common/http/testing';
 *
 * import { PoI18nModule } from '@po-ui/ng-components';
 *
 * import { AppComponent } from './app.component';
 *
 * describe('AppComponent', () => {
 *   const anotherPT = {
 *     text: 'texto',
 *     add: 'adicionar',
 *     remove: 'remover'
 *   };
 *
 *   const generalPT = {
 *     text: 'texto',
 *     add: 'adicionar',
 *     remove: 'remover'
 *   };
 *
 *   const config = {
 *     default: {
 *       language: 'pt-BR',
 *       context: 'general',
 *       cache: false
 *     },
 *     contexts: {
 *       general: {
 *         'pt-br': generalPT
 *       },
 *       another: {
 *         'pt-br': anotherPT
 *       }
 *     }
 *   };
 *
 *   beforeEach(async(() => {
 *     TestBed.configureTestingModule({
 *       declarations: [
 *         AppComponent
 *       ],
 *       imports: [
 *         HttpClientTestingModule,
 *         PoI18nModule.config(config)
 *       ]
 *     }).compileComponents();
 *   }));
 *
 *   it('should create the app', async(() => {
 *     const fixture = TestBed.createComponent(AppComponent);
 *     const app = fixture.debugElement.componentInstance;
 *
 *     expect(app).toBeTruthy();
 *   }));
 *
 * });
 * ```
 */
let PoI18nBaseService = class PoI18nBaseService {
    constructor(config, http, languageService) {
        this.config = config;
        this.http = http;
        this.languageService = languageService;
        this.varI18n = {};
        this.useCache = false;
        this.servicesContext = {};
        this.setConfig(config);
    }
    /**
     * <a id="get-language"></a>
     * Método que retorna o idioma padrão ativo.
     *
     * A busca deste idioma pelo método será feita na seguinte ordem:
     *
     *   1 - o idioma que foi armazenado no *localStorage*, através do método [`setLanguage()`](documentation/po-i18n#setLanguage).
     *
     *   2 - o valor inserido no módulo do i18n através do parâmetro `config`, sendo o idioma inserido na propriedade
     * `language` da interface [`PoI18nConfigDefault`](documentation/po-i18n#poI18nConfigDefault).
     *
     *   3 - o idioma do navegador utilizado.
     *
     * > Caso o idioma do navegador não seja suportado pelo PO (`pt`, `en`, `es` ou `ru`), será retornado valor `pt`.
     *
     * @returns {string} sigla do idioma padrão.
     */
    getLanguage() {
        return this.languageService.getLanguage();
    }
    getLiterals(options = {}) {
        const language = options['language'] ? options['language'].toLowerCase() : this.getLanguage();
        const context = options['context'] ? options['context'] : this.contextDefault;
        const literals = options['literals'] ? options['literals'] : [];
        return new Observable(observer => {
            if (this.servicesContext[context]) {
                // Faz o processo de busca de um contexto que contém serviço
                this.getLiteralsFromContextService(language, context, literals, observer);
            }
            else {
                // Faz o processo de busca de um contexto que utiliza constante
                this.getLiteralsFromContextConstant(language, context, literals, observer);
            }
        });
    }
    /**
     * Método que retorna o idioma padrão ativo, com somente a abreviação do idioma (duas primeiras letras).
     * Por exemplo: "pt" ou "es".
     *
     * A busca deste idioma é baseada no método [**getLanguage()**](/documentation/po-i18n#get-language).
     *
     * @returns {string} sigla do idioma padrão.
     */
    getShortLanguage() {
        return this.languageService.getShortLanguage();
    }
    /**
     * <a id="setLanguage"></a>
     * Método para alterar o idioma padrão do módulo do i18n.
     *
     * Ao utilizar este método, o idioma ficará gravado no armazenamento local do navegador, que será utilizado pelo
     * serviço do `i18n` para buscar as literais no idioma padrão.
     *
     * @param {string} language Sigla do idioma.
     *
     * Esta sigla deve ser composta por duas letras representando o idioma,
     * podendo ser adicionado outras duas letras representando o país, por exemplo: `pt`, `pt-BR`, `pt-br`, `en` ou `en-US`.
     *
     * > Caso seja informado um valor diferente deste padrão, o mesmo será ignorado.
     *
     * @param {boolean} reload Indica se a página atual poderá ser recarregada após a alteração do idioma.
     *
     * Este recurso pode ser útil para os usuários que utilizam o método `getLiterals()` do serviço do i18n para poder
     * buscar novamente as literais no novo idioma configurado.
     */
    setLanguage(language, reload = false) {
        if (!isLanguage(language)) {
            return;
        }
        this.languageService.setLanguage(language);
        if (reload) {
            reloadCurrentPage();
        }
    }
    setConfig(config) {
        // Seta as configurações padrões definidas no importação do módulo
        if (config['default']) {
            this.languageService.setLanguageDefault(config['default']['language']);
            this.contextDefault = config['default']['context'] ? config['default']['context'] : '';
            this.useCache = config['default']['cache'] ? config['default']['cache'] : false;
        }
        // Carrega a lista dos contextos e as contantes informadas
        if (config['contexts']) {
            this.setVarI18n(config['contexts']);
            // Se nenhum contexto foi definido como padrão,
            // então define o primeiro contexto
            if (!this.contextDefault) {
                for (const context in config['contexts']) {
                    if (this.config['contexts'].hasOwnProperty(context)) {
                        this.contextDefault = context;
                        break;
                    }
                }
            }
        }
    }
    // Processo de busca de um contexto que contém serviço.
    //    1 - Procura na variável I18n deste serviço
    //    2 - Procura no local storage (Se o cache estiver definido como true na configuração do módulo)
    //    3 - Dispara o serviço, mesmo que já tenha encontrado no local storage, para garantir a atualização
    //    4 - Se nenhuma literal for encontrada, então busca em pt-br
    getLiteralsFromContextService(language, context, literals, observer, translations = {}, languageAlternative = null) {
        // Idioma usado para tentar buscar as literais faltantes
        const languageSearch = languageAlternative ? languageAlternative : language;
        translations = this.mergeObject(translations, this.searchInVarI18n(languageSearch, context, literals));
        if (this.countObject(translations) > 0) {
            observer.next(translations);
        }
        // realiza a busca no localStorage e em seguida no serviço
        this.getLiteralsLocalStorageAndCache(languageSearch, context, literals, observer, translations, languageAlternative);
    }
    // Procura no local storage e em seguida no serviço
    // Caso não encontre nem no serviço, recomeça a busca em pt-br
    getLiteralsLocalStorageAndCache(language, context, literals, observer, translations, languageAlternative = null) {
        const languageSearch = languageAlternative ? languageAlternative : language;
        let translationTemp;
        // Verifica se usa cache
        if (this.useCache) {
            translationTemp = this.searchInLocalStorage(languageSearch, context, literals);
            if (this.countObject(translationTemp) > 0) {
                this.updateVarI18n(language, context, translationTemp);
                translations = this.mergeObject(translationTemp, translations);
                observer.next(translations);
            }
        }
        // Busca do Serviço
        this.getHttpService(this.servicesContext[context], languageSearch, literals).subscribe(response => {
            if (response) {
                this.updateLocalStorage(language, context, response);
                this.updateVarI18n(language, context, response);
                translationTemp = this.searchInVarI18n(language, context, literals);
                translations = this.mergeObject(translationTemp, translations);
                observer.next(translations);
            }
            // Se não encontrou todas as literais pesquisadas no idioma
            // Então refaz o processo procurando em português
            if (literals.length > this.countObject(translations)) {
                if (languageAlternative === 'pt-br') {
                    // Se não encontrou nem em português, então retorna o nome das literais
                    translations = this.completeFaultLiterals(language, context, literals, translations);
                    this.updateLocalStorage(language, context, translations);
                    this.updateVarI18n(language, context, translations);
                    observer.next(translations);
                }
                else {
                    this.getLiteralsFromContextService(language, context, literals, observer, translations, 'pt-br');
                }
            }
        });
    }
    // Procura pela lista de literais
    // Se não encontrar todas, procura em pt-br
    getLiteralsFromContextConstant(language, context, literals, observer, translations = {}) {
        translations = this.mergeObject(translations, this.searchInVarI18n(language, context, literals));
        if (this.countObject(translations) > 0) {
            observer.next(translations);
        }
        // Se foi pesquisado por literais
        if (literals.length > 0) {
            // Se não encontrou todas as literais pesquisadas no idioma, procura em português
            if (literals.length > this.countObject(translations)) {
                if (language === 'pt-br') {
                    // Se não encontrou nem em português, então retorna o nome das literais
                    translations = this.completeFaultLiterals(language, context, literals, translations);
                    observer.next(translations);
                }
                else {
                    this.getLiteralsFromContextConstant('pt-br', context, literals, observer, translations);
                }
            }
        }
        else {
            // Se não encontrar nenhuma literal, procura em português
            if (this.countObject(translations) === 0 && language !== 'pt-br') {
                this.getLiteralsFromContextConstant('pt-br', context, literals, observer, translations);
            }
            // caso não informar literais e não houver tradução
            observer.next(translations);
            observer.complete();
        }
    }
    // Busca pelas literais no local storage
    searchInLocalStorage(language, context, literals) {
        const translations = {};
        if (literals.length > 0) {
            for (let i = 0; i < literals.length; i++) {
                const literal = literals[i];
                const translation = localStorage.getItem(language + '-' + context + '-' + literal);
                if (translation) {
                    translations[literal] = translation;
                }
            }
        }
        return translations;
    }
    // Busca pelas literais na variável do serviço
    searchInVarI18n(language, context, literals) {
        let translations = {};
        if (this.varI18n[language] && this.varI18n[language][context]) {
            const content = this.varI18n[language][context];
            if (literals.length > 0) {
                // Busca as literais desejadas
                for (let i = 0; i < literals.length; i++) {
                    const literal = literals[i];
                    if (content.hasOwnProperty(literal)) {
                        translations[literal] = content[literal];
                    }
                }
            }
            else {
                // Atribui todas as literais
                translations = { ...content };
            }
        }
        return translations;
    }
    // Atualiza o local storage
    updateLocalStorage(language, context, data) {
        if (this.useCache) {
            for (const literal of Object.keys(data)) {
                localStorage.setItem(language + '-' + context + '-' + literal, data[literal]);
            }
        }
    }
    // Atualiza a variável local com as literais com os objetos passados na configuração
    setVarI18n(contexts) {
        // Percorre os contextos
        for (const context of Object.keys(contexts)) {
            const contextContent = contexts[context];
            // Percorre os idiomas dentro do contexto
            for (const language of Object.keys(contextContent)) {
                const languageContent = contextContent[language];
                if (language === 'url') {
                    this.servicesContext[context] = languageContent;
                }
                else {
                    this.updateVarI18n(language, context, languageContent);
                }
            }
        }
    }
    // Atualiza a variável local com as literais idioma e contexto
    updateVarI18n(language, context, data) {
        language = language.toLowerCase();
        if (!this.varI18n[language]) {
            this.varI18n[language] = { [context]: {} };
        }
        if (!this.varI18n[language][context]) {
            this.varI18n[language][context] = {};
        }
        // Cria ou atualiza o contexto dentro do storage
        this.varI18n[language][context] = this.mergeObject(data, this.varI18n[language][context]);
    }
    getHttpService(url, language, literals) {
        let param = '?language=' + language;
        if (literals.length > 0) {
            param += '&literals=' + literals.join();
        }
        // Remove a barra final do endereço
        url = url.replace(/\/$/, '');
        return this.http.get(`${url}${param}`);
    }
    // Completa com o nome da literais, as que não foram encontradas
    completeFaultLiterals(language, context, literals, translations) {
        for (let i = 0; i < literals.length; i++) {
            const literal = literals[i];
            if (!translations[literal]) {
                translations[literal] = literal;
            }
        }
        return translations;
    }
    // Conta os atributos do objeto
    countObject(obj) {
        return Object.keys(obj).length;
    }
    // Faz o merge dos objetos, sempre dando preferência para o primeiro objeto de parâmetro
    mergeObject(objPermanent, obj) {
        return { ...obj, ...objPermanent };
    }
};
PoI18nBaseService = __decorate([
    __param(0, Inject(I18N_CONFIG)),
    __param(1, Inject(HttpClient))
], PoI18nBaseService);
export { PoI18nBaseService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8taTE4bi1iYXNlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL3NlcnZpY2VzL3BvLWkxOG4vcG8taTE4bi1iYXNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXZDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFbEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBR2pFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUkvRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUlHO0FBRUgsSUFBYSxpQkFBaUIsR0FBOUIsTUFBYSxpQkFBaUI7SUFTNUIsWUFDK0IsTUFBcUIsRUFDdEIsSUFBaUIsRUFDckMsZUFBbUM7UUFGZCxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ3RCLFNBQUksR0FBSixJQUFJLENBQWE7UUFDckMsb0JBQWUsR0FBZixlQUFlLENBQW9CO1FBWHJDLFlBQU8sR0FBUSxFQUFFLENBQUM7UUFJbEIsYUFBUSxHQUFZLEtBQUssQ0FBQztRQUUxQixvQkFBZSxHQUFRLEVBQUUsQ0FBQztRQU9oQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFRDs7Ozs7Ozs7Ozs7Ozs7OztPQWdCRztJQUNILFdBQVc7UUFDVCxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMs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SUFDakMsQ0FBQztJQUVELHdGQUF3RjtJQUNoRixXQUFXLENBQUMsWUFBaUIsRUFBRSxHQUFRO1FBQzdDLE9BQU8sRUFBRSxHQUFHLEdBQUcsRUFBRSxHQUFHLFlBQVksRUFBRSxDQUFDO0lBQ3JDLENBQUM7Q0FDRixDQUFBO0FBbFdZLGlCQUFpQjtJQVV6QixXQUFBLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQTtJQUNuQixXQUFBLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQTtHQVhWLGlCQUFpQixDQWtXN0I7U0FsV1ksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IGlzTGFuZ3VhZ2UsIHJlbG9hZEN1cnJlbnRQYWdlIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyBQb0xhbmd1YWdlU2VydmljZSB9IGZyb20gJy4uL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLnNlcnZpY2UnO1xuXG5pbXBvcnQgeyBJMThOX0NPTkZJRyB9IGZyb20gJy4vcG8taTE4bi1jb25maWctaW5qZWN0aW9uLXRva2VuJztcbmltcG9ydCB7IFBvSTE4bkNvbmZpZyB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1pMThuLWNvbmZpZy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9JMThuTGl0ZXJhbHMgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8taTE4bi1saXRlcmFscy5pbnRlcmZhY2UnO1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIE8gc2VydmnDp28gYFBvSTE4blNlcnZpY2VgIHBvc3NpYmlsaXRhIHV0aWxpemFyIG3Dumx0aXBsb3MgaWRpb21hcyBlIGNvbnRleHRvcyBuYSBhcGxpY2HDp8Ojby5cbiAqXG4gKiA+IEFudGVzIGRhIHV0aWxpemHDp8OjbyBkbyBzZXJ2acOnbywgw6kgbmVjZXNzw6FyaW8gcmVhbGl6YXIgYVxuICogW2ltcG9ydGHDp8OjbyBlIGNvbmZpZ3VyYcOnw6NvIGRvIG3Ds2R1bG8gYFBvSTE4bk1vZHVsZWBdKC9kb2N1bWVudGF0aW9uL3BvLWkxOG4jaTE4bi1jb25maWcpLlxuICpcbiAqICoqVXRpbGl6YcOnw6NvIGRvIHNlcnZpw6dvIGBQb0kxOG5TZXJ2aWNlYDoqKlxuICpcbiAqIFBhcmEgdXRpbGl6YXIgbyBzZXJ2acOnbyBiYXN0YSBpbXBvcnTDoS1sbyBub3MgY29tcG9uZW50ZXMgcXVlIG5lY2Vzc2l0YXJlbSBkZSBsaXRlcmFpcyBlIGZhemVyIGEgaW5qZcOnw6NvIGRlXG4gKiBkZXBlbmTDqm5jaWEgbm8gY29uc3RydXRvcjpcbiAqIGBgYFxuICogIGltcG9ydCB7IFBvSTE4blNlcnZpY2UgfSBmcm9tICdAcG8tdWkvbmctY29tcG9uZW50cyc7XG4gKiAgLi4uXG4gKiAgY29uc3RydWN0b3IocHJpdmF0ZSBwb0kxOG5TZXJ2aWNlOiBQb0kxOG5TZXJ2aWNlKSB7IH1cbiAqICAuLi5cbiAqIGBgYFxuICpcbiAqIFBvciBmaW0gcmVhbGl6YXIgYSBidXNjYSBwZWxhcyBsaXRlcmFpcywgaW5zY3JldmVuZG8tc2Ugbm8gW09ic2VydmFibGVdKGh0dHBzOi8vYW5ndWxhci5pby9ndWlkZS9vYnNlcnZhYmxlcykgcGVsb1xuICogbcOpdG9kbyBgZ2V0TGl0ZXJhbHMoKWAuXG4gKlxuICogPiBPIG3DqXRvZG8gYGdldExpdGVyYWxzKClgIHBvZGUgcmVjZWJlciB1bSBvYmpldG8gZG8gdGlwbyBkYSBpbnRlcmZhY2UgYFBvSTE4bkxpdGVyYWxzYCBjb21vIHBhcsOibWV0cm8sXG4gKiBwb3LDqW0sIG5lbmh1bWEgZGFzIHByb3ByaWVkYWRlcyBzw6NvIG9icmlnYXTDs3JpYXMuIENhc28gbmVuaHVtIHBhcsOibWV0cm8gc2VqYSBwYXNzYWRvLCBzZXLDo28gYnVzY2FkYXNcbiAqIHRvZGFzIGFzIGxpdGVyYWlzIGRvIGNvbnRleHRvIGRlZmluaWRvIGNvbSBwYWRyw6NvLCBubyBpZGlvbWEgZGVmaW5pZG8gY29tbyBwYWRyw6NvLlxuICpcbiAqIEV4ZW1wbG9zIGRlIHJlcXVpc2nDp8OjbzpcbiAqIGBgYFxuICogbGl0ZXJhbHMgPSB7fTtcbiAqIGxpdGVyYWxzRW4gPSB7fTtcbiAqIGxpdGVyYWxzQ3JtID0ge307XG4gKlxuICogY29uc3RydWN0b3IocHJpdmF0ZSBwb0kxOG5TZXJ2aWNlOiBQb0kxOG5TZXJ2aWNlKSB7XG4gKiAgIHBvSTE4blNlcnZpY2UuZ2V0TGl0ZXJhbHMoKVxuICogICAgIC5zdWJzY3JpYmUoKGxpdGVyYWxzKSA9PiB7XG4gKiAgICAgICB0aGlzLmxpdGVyYWxzID0gbGl0ZXJhbHM7XG4gKiAgICAgfSk7XG4gKlxuICogICBwb0kxOG5TZXJ2aWNlLmdldExpdGVyYWxzKHtjb250ZXh0OiAnY3JtJywgbGl0ZXJhbHM6IFsnYWRkJywgJ3JlbW92ZSddfSlcbiAqICAgICAuc3Vic2NyaWJlKChsaXRlcmFscykgPT4ge1xuICogICAgICAgdGhpcy5saXRlcmFsc0NybSA9IGxpdGVyYWxzO1xuICogICAgIH0pO1xuICpcbiAqICAgcG9JMThuU2VydmljZS5nZXRMaXRlcmFscyh7bGFuZ3VhZ2U6ICdlbi11cyd9KVxuICogICAgIC5zdWJzY3JpYmUoKGxpdGVyYWxzKSA9PiB7XG4gKiAgICAgICB0aGlzLmxpdGVyYWxzRW4gPSBsaXRlcmFscztcbiAqICAgICB9KTtcbiAqIH1cbiAqIGBgYFxuICpcbiAqIFBhcmEgYXByZXNlbnRhciBhcyBsaXRlcmFpcyBjYXB0dXJhZGFzIGFjaW1hIG5vIEhUTUwgZG8gY29tcG9uZW50ZSwgZGV2ZS1zZSB1dGlsaXphciBvXG4gKiBzZWd1aW50ZSBjw7NkaWdvOlxuICpcbiAqIDxwcmUgbmdOb25CaW5kYWJsZT5cbiAqIHt7IGxpdGVyYWxzPy5hZGQgfX1cbiAqIHt7IGxpdGVyYWxzPy5yZW1vdmUgfX1cbiAqIDwvcHJlPlxuICpcbiAqIENhc28gYXMgbGl0ZXJhaXMgY29udGVuaGFtIHZhcmnDoXZlaXMgcXVlIHByZWNpc2VtIHNlciBzdWJzdGl0dcOtZGFzLCBwb2RlLXNlIHV0aWxpemFyIG8gKnBpcGUqIGBwb0kxOG5gLlxuICogw4kgcG9zc8OtdmVsIGluZm9ybWFyIHByb3ByaWVkYWRlcyBkbyBjb21wb25lbnRlIGNvbW8gYG5hbWVgIGUgYG5pY2tuYW1lYCBvdVxuICogaW5mb3JtYXIgbyB2YWxvciBkaXJldGFtZW50ZSBjb20gXCJcIiBvdSBuw7ptZXJvLCBjb25mb3JtZSBvIGV4ZW1wbG8gYWJhaXhvOlxuICpcbiAqIDxwcmUgbmdOb25CaW5kYWJsZT5cbiAqIHt7IGxpdGVyYWxzPy5wZW9wbGUgfCBwb0kxOG46WzEyMF0gfX1cbiAqIHt7IGxpdGVyYWxzPy5ncmVldGluZyB8IHBvSTE4bjpbbmFtZSwgbmlja25hbWVdIH19XG4gKiB7eyBsaXRlcmFscz8uZ3JlZXRpbmcgfCBwb0kxOG46W1wiQnJhZFwiLCBcIkdyZWVuXCJdIH19XG4gKiA8L3ByZT5cbiAqXG4gKiA+IMOJIGltcG9ydGFudGUgbyB1c28gZG8gb3BlcmFkb3IgYD9gIChFbHZpcykgcGFyYSBldml0YXIgZXJyb3MgZW5xdWFudG8gYXMgbGl0ZXJhaXMgbsOjbyBmb3JlbSBjYXJyZWdhZGFzLlxuICpcbiAqICMjIyBUZXN0ZSB1bml0w6FyaW9cbiAqXG4gKiBBYmFpeG8gc2VndWUgdW0gZXhlbXBsbyBkZSAqc2V0dXAqIGluaWNpYWwgZGUgdGVzdGUgdW5pdMOhcmlvIGRvICpBcHBDb21wb25lbnQqIHF1ZSB1dGlsaXphIG8gYFBvSTE4blNlcnZpY2VgOlxuICpcbiAqID4gQXRlbsOnw6NvOiBuw6NvIGRlY2xhcmFyIG8gYFBvSTE4blNlcnZpY2VgIG5vIHByb3ZpZGVycyBkbyBUZXN0QmVkIHBvaXMgYSBiaWJsaW90ZWNhIHJlYWxpemEgYSBpbmplw6fDo28gZGUgZGVwZW5kw6puY2lhIGRlIGZvcm1hIGRpbsOibWljYS5cbiAqID4gU2UgbyBzZXJ2acOnbyBmb3IgZGVjbGFyYWRvIG8gdGVzdGUgbsOjbyBmYXLDoSBhIGluamXDp8OjbyBlIG8gdGVzdGUgYXByZXNlbnRhcsOhIGVycm9zLlxuICpcbiAqIGBgYFxuICogaW1wb3J0IHsgYXN5bmMsIFRlc3RCZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlL3Rlc3RpbmcnO1xuICogaW1wb3J0IHsgSHR0cENsaWVudFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cC90ZXN0aW5nJztcbiAqXG4gKiBpbXBvcnQgeyBQb0kxOG5Nb2R1bGUgfSBmcm9tICdAcG8tdWkvbmctY29tcG9uZW50cyc7XG4gKlxuICogaW1wb3J0IHsgQXBwQ29tcG9uZW50IH0gZnJvbSAnLi9hcHAuY29tcG9uZW50JztcbiAqXG4gKiBkZXNjcmliZSgnQXBwQ29tcG9uZW50JywgKCkgPT4ge1xuICogICBjb25zdCBhbm90aGVyUFQgPSB7XG4gKiAgICAgdGV4dDogJ3RleHRvJyxcbiAqICAgICBhZGQ6ICdhZGljaW9uYXInLFxuICogICAgIHJlbW92ZTogJ3JlbW92ZXInXG4gKiAgIH07XG4gKlxuICogICBjb25zdCBnZW5lcmFsUFQgPSB7XG4gKiAgICAgdGV4dDogJ3RleHRvJyxcbiAqICAgICBhZGQ6ICdhZGljaW9uYXInLFxuICogICAgIHJlbW92ZTogJ3JlbW92ZXInXG4gKiAgIH07XG4gKlxuICogICBjb25zdCBjb25maWcgPSB7XG4gKiAgICAgZGVmYXVsdDoge1xuICogICAgICAgbGFuZ3VhZ2U6ICdwdC1CUicsXG4gKiAgICAgICBjb250ZXh0OiAnZ2VuZXJhbCcsXG4gKiAgICAgICBjYWNoZTogZmFsc2VcbiAqICAgICB9LFxuICogICAgIGNvbnRleHRzOiB7XG4gKiAgICAgICBnZW5lcmFsOiB7XG4gKiAgICAgICAgICdwdC1icic6IGdlbmVyYWxQVFxuICogICAgICAgfSxcbiAqICAgICAgIGFub3RoZXI6IHtcbiAqICAgICAgICAgJ3B0LWJyJzogYW5vdGhlclBUXG4gKiAgICAgICB9XG4gKiAgICAgfVxuICogICB9O1xuICpcbiAqICAgYmVmb3JlRWFjaChhc3luYygoKSA9PiB7XG4gKiAgICAgVGVzdEJlZC5jb25maWd1cmVUZXN0aW5nTW9kdWxlKHtcbiAqICAgICAgIGRlY2xhcmF0aW9uczogW1xuICogICAgICAgICBBcHBDb21wb25lbnRcbiAqICAgICAgIF0sXG4gKiAgICAgICBpbXBvcnRzOiBbXG4gKiAgICAgICAgIEh0dHBDbGllbnRUZXN0aW5nTW9kdWxlLFxuICogICAgICAgICBQb0kxOG5Nb2R1bGUuY29uZmlnKGNvbmZpZylcbiAqICAgICAgIF1cbiAqICAgICB9KS5jb21waWxlQ29tcG9uZW50cygpO1xuICogICB9KSk7XG4gKlxuICogICBpdCgnc2hvdWxkIGNyZWF0ZSB0aGUgYXBwJywgYXN5bmMoKCkgPT4ge1xuICogICAgIGNvbnN0IGZpeHR1cmUgPSBUZXN0QmVkLmNyZWF0ZUNvbXBvbmVudChBcHBDb21wb25lbnQpO1xuICogICAgIGNvbnN0IGFwcCA9IGZpeHR1cmUuZGVidWdFbGVtZW50LmNvbXBvbmVudEluc3RhbmNlO1xuICpcbiAqICAgICBleHBlY3QoYXBwKS50b0JlVHJ1dGh5KCk7XG4gKiAgIH0pKTtcbiAqXG4gKiB9KTtcbiAqIGBgYFxuICovXG5cbmV4cG9ydCBjbGFzcyBQb0kxOG5CYXNlU2VydmljZSB7XG4gIHByaXZhdGUgdmFySTE4bjogYW55ID0ge307XG5cbiAgcHJpdmF0ZSBjb250ZXh0RGVmYXVsdDogc3RyaW5nO1xuXG4gIHByaXZhdGUgdXNlQ2FjaGU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBwcml2YXRlIHNlcnZpY2VzQ29udGV4dDogYW55ID0ge307XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChJMThOX0NPTkZJRykgcHJpdmF0ZSBjb25maWc/OiBQb0kxOG5Db25maWcsXG4gICAgQEluamVjdChIdHRwQ2xpZW50KSBwcml2YXRlIGh0dHA/OiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlPzogUG9MYW5ndWFnZVNlcnZpY2VcbiAgKSB7XG4gICAgdGhpcy5zZXRDb25maWcoY29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiA8YSBpZD1cImdldC1sYW5ndWFnZVwiPjwvYT5cbiAgICogTcOpdG9kbyBxdWUgcmV0b3JuYSBvIGlkaW9tYSBwYWRyw6NvIGF0aXZvLlxuICAgKlxuICAgKiBBIGJ1c2NhIGRlc3RlIGlkaW9tYSBwZWxvIG3DqXRvZG8gc2Vyw6EgZmVpdGEgbmEgc2VndWludGUgb3JkZW06XG4gICAqXG4gICAqICAgMSAtIG8gaWRpb21hIHF1ZSBmb2kgYXJtYXplbmFkbyBubyAqbG9jYWxTdG9yYWdlKiwgYXRyYXbDqXMgZG8gbcOpdG9kbyBbYHNldExhbmd1YWdlKClgXShkb2N1bWVudGF0aW9uL3BvLWkxOG4jc2V0TGFuZ3VhZ2UpLlxuICAgKlxuICAgKiAgIDIgLSBvIHZhbG9yIGluc2VyaWRvIG5vIG3Ds2R1bG8gZG8gaTE4biBhdHJhdsOpcyBkbyBwYXLDom1ldHJvIGBjb25maWdgLCBzZW5kbyBvIGlkaW9tYSBpbnNlcmlkbyBuYSBwcm9wcmllZGFkZVxuICAgKiBgbGFuZ3VhZ2VgIGRhIGludGVyZmFjZSBbYFBvSTE4bkNvbmZpZ0RlZmF1bHRgXShkb2N1bWVudGF0aW9uL3BvLWkxOG4jcG9JMThuQ29uZmlnRGVmYXVsdCkuXG4gICAqXG4gICAqICAgMyAtIG8gaWRpb21hIGRvIG5hdmVnYWRvciB1dGlsaXphZG8uXG4gICAqXG4gICAqID4gQ2FzbyBvIGlkaW9tYSBkbyBuYXZlZ2Fkb3IgbsOjbyBzZWphIHN1cG9ydGFkbyBwZWxvIFBPIChgcHRgLCBgZW5gLCBgZXNgIG91IGBydWApLCBzZXLDoSByZXRvcm5hZG8gdmFsb3IgYHB0YC5cbiAgICpcbiAgICogQHJldHVybnMge3N0cmluZ30gc2lnbGEgZG8gaWRpb21hIHBhZHLDo28uXG4gICAqL1xuICBnZXRMYW5ndWFnZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmxhbmd1YWdlU2VydmljZS5nZXRMYW5ndWFnZSgpO1xuICB9XG5cbiAgZ2V0TGl0ZXJhbHMob3B0aW9uczogUG9JMThuTGl0ZXJhbHMgPSB7fSk6IE9ic2VydmFibGU8b2JqZWN0PiB7XG4gICAgY29uc3QgbGFuZ3VhZ2UgPSBvcHRpb25zWydsYW5ndWFnZSddID8gb3B0aW9uc1snbGFuZ3VhZ2UnXS50b0xvd2VyQ2FzZSgpIDogdGhpcy5nZXRMYW5ndWFnZSgpO1xuICAgIGNvbnN0IGNvbnRleHQgPSBvcHRpb25zWydjb250ZXh0J10gPyBvcHRpb25zWydjb250ZXh0J10gOiB0aGlzLmNvbnRleHREZWZhdWx0O1xuICAgIGNvbnN0IGxpdGVyYWxzOiBBcnJheTxzdHJpbmc+ID0gb3B0aW9uc1snbGl0ZXJhbHMnXSA/IG9wdGlvbnNbJ2xpdGVyYWxzJ10gOiBbXTtcblxuICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XG4gICAgICBpZiAodGhpcy5zZXJ2aWNlc0NvbnRleHRbY29udGV4dF0pIHtcbiAgICAgICAgLy8gRmF6IG8gcHJvY2Vzc28gZGUgYnVzY2EgZGUgdW0gY29udGV4dG8gcXVlIGNvbnTDqW0gc2VydmnDp29cbiAgICAgICAgdGhpcy5nZXRMaXRlcmFsc0Zyb21Db250ZXh0U2VydmljZShsYW5ndWFnZSwgY29udGV4dCwgbGl0ZXJhbHMsIG9ic2VydmVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZheiBvIHByb2Nlc3NvIGRlIGJ1c2NhIGRlIHVtIGNvbnRleHRvIHF1ZSB1dGlsaXphIGNvbnN0YW50ZVxuICAgICAgICB0aGlzLmdldExpdGVyYWxzRnJvbUNvbnRleHRDb25zdGFudChsYW5ndWFnZSwgY29udGV4dCwgbGl0ZXJhbHMsIG9ic2VydmVyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNw6l0b2RvIHF1ZSByZXRvcm5hIG8gaWRpb21hIHBhZHLDo28gYXRpdm8sIGNvbSBzb21lbnRlIGEgYWJyZXZpYcOnw6NvIGRvIGlkaW9tYSAoZHVhcyBwcmltZWlyYXMgbGV0cmFzKS5cbiAgICogUG9yIGV4ZW1wbG86IFwicHRcIiBvdSBcImVzXCIuXG4gICAqXG4gICAqIEEgYnVzY2EgZGVzdGUgaWRpb21hIMOpIGJhc2VhZGEgbm8gbcOpdG9kbyBbKipnZXRMYW5ndWFnZSgpKipdKC9kb2N1bWVudGF0aW9uL3BvLWkxOG4jZ2V0LWxhbmd1YWdlKS5cbiAgICpcbiAgICogQHJldHVybnMge3N0cmluZ30gc2lnbGEgZG8gaWRpb21hIHBhZHLDo28uXG4gICAqL1xuICBnZXRTaG9ydExhbmd1YWdlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmdldFNob3J0TGFuZ3VhZ2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiA8YSBpZD1cInNldExhbmd1YWdlXCI+PC9hPlxuICAgKiBNw6l0b2RvIHBhcmEgYWx0ZXJhciBvIGlkaW9tYSBwYWRyw6NvIGRvIG3Ds2R1bG8gZG8gaTE4bi5cbiAgICpcbiAgICogQW8gdXRpbGl6YXIgZXN0ZSBtw6l0b2RvLCBvIGlkaW9tYSBmaWNhcsOhIGdyYXZhZG8gbm8gYXJtYXplbmFtZW50byBsb2NhbCBkbyBuYXZlZ2Fkb3IsIHF1ZSBzZXLDoSB1dGlsaXphZG8gcGVsb1xuICAgKiBzZXJ2acOnbyBkbyBgaTE4bmAgcGFyYSBidXNjYXIgYXMgbGl0ZXJhaXMgbm8gaWRpb21hIHBhZHLDo28uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBsYW5ndWFnZSBTaWdsYSBkbyBpZGlvbWEuXG4gICAqXG4gICAqIEVzdGEgc2lnbGEgZGV2ZSBzZXIgY29tcG9zdGEgcG9yIGR1YXMgbGV0cmFzIHJlcHJlc2VudGFuZG8gbyBpZGlvbWEsXG4gICAqIHBvZGVuZG8gc2VyIGFkaWNpb25hZG8gb3V0cmFzIGR1YXMgbGV0cmFzIHJlcHJlc2VudGFuZG8gbyBwYcOtcywgcG9yIGV4ZW1wbG86IGBwdGAsIGBwdC1CUmAsIGBwdC1icmAsIGBlbmAgb3UgYGVuLVVTYC5cbiAgICpcbiAgICogPiBDYXNvIHNlamEgaW5mb3JtYWRvIHVtIHZhbG9yIGRpZmVyZW50ZSBkZXN0ZSBwYWRyw6NvLCBvIG1lc21vIHNlcsOhIGlnbm9yYWRvLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHJlbG9hZCBJbmRpY2Egc2UgYSBww6FnaW5hIGF0dWFsIHBvZGVyw6Egc2VyIHJlY2FycmVnYWRhIGFww7NzIGEgYWx0ZXJhw6fDo28gZG8gaWRpb21hLlxuICAgKlxuICAgKiBFc3RlIHJlY3Vyc28gcG9kZSBzZXIgw7p0aWwgcGFyYSBvcyB1c3XDoXJpb3MgcXVlIHV0aWxpemFtIG8gbcOpdG9kbyBgZ2V0TGl0ZXJhbHMoKWAgZG8gc2VydmnDp28gZG8gaTE4biBwYXJhIHBvZGVyXG4gICAqIGJ1c2NhciBub3ZhbWVudGUgYXMgbGl0ZXJhaXMgbm8gbm92byBpZGlvbWEgY29uZmlndXJhZG8uXG4gICAqL1xuICBzZXRMYW5ndWFnZShsYW5ndWFnZTogc3RyaW5nLCByZWxvYWQ6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQge1xuICAgIGlmICghaXNMYW5ndWFnZShsYW5ndWFnZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmxhbmd1YWdlU2VydmljZS5zZXRMYW5ndWFnZShsYW5ndWFnZSk7XG5cbiAgICBpZiAocmVsb2FkKSB7XG4gICAgICByZWxvYWRDdXJyZW50UGFnZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0Q29uZmlnKGNvbmZpZzogUG9JMThuQ29uZmlnKSB7XG4gICAgLy8gU2V0YSBhcyBjb25maWd1cmHDp8O1ZXMgcGFkcsO1ZXMgZGVmaW5pZGFzIG5vIGltcG9ydGHDp8OjbyBkbyBtw7NkdWxvXG4gICAgaWYgKGNvbmZpZ1snZGVmYXVsdCddKSB7XG4gICAgICB0aGlzLmxhbmd1YWdlU2VydmljZS5zZXRMYW5ndWFnZURlZmF1bHQoY29uZmlnWydkZWZhdWx0J11bJ2xhbmd1YWdlJ10pO1xuXG4gICAgICB0aGlzLmNvbnRleHREZWZhdWx0ID0gY29uZmlnWydkZWZhdWx0J11bJ2NvbnRleHQnXSA/IGNvbmZpZ1snZGVmYXVsdCddWydjb250ZXh0J10gOiAnJztcbiAgICAgIHRoaXMudXNlQ2FjaGUgPSBjb25maWdbJ2RlZmF1bHQnXVsnY2FjaGUnXSA/IGNvbmZpZ1snZGVmYXVsdCddWydjYWNoZSddIDogZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQ2FycmVnYSBhIGxpc3RhIGRvcyBjb250ZXh0b3MgZSBhcyBjb250YW50ZXMgaW5mb3JtYWRhc1xuICAgIGlmIChjb25maWdbJ2NvbnRleHRzJ10pIHtcbiAgICAgIHRoaXMuc2V0VmFySTE4bihjb25maWdbJ2NvbnRleHRzJ10pO1xuXG4gICAgICAvLyBTZSBuZW5odW0gY29udGV4dG8gZm9pIGRlZmluaWRvIGNvbW8gcGFkcsOjbyxcbiAgICAgIC8vIGVudMOjbyBkZWZpbmUgbyBwcmltZWlybyBjb250ZXh0b1xuICAgICAgaWYgKCF0aGlzLmNvbnRleHREZWZhdWx0KSB7XG4gICAgICAgIGZvciAoY29uc3QgY29udGV4dCBpbiBjb25maWdbJ2NvbnRleHRzJ10pIHtcbiAgICAgICAgICBpZiAodGhpcy5jb25maWdbJ2NvbnRleHRzJ10uaGFzT3duUHJvcGVydHkoY29udGV4dCkpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGV4dERlZmF1bHQgPSBjb250ZXh0O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gUHJvY2Vzc28gZGUgYnVzY2EgZGUgdW0gY29udGV4dG8gcXVlIGNvbnTDqW0gc2VydmnDp28uXG4gIC8vICAgIDEgLSBQcm9jdXJhIG5hIHZhcmnDoXZlbCBJMThuIGRlc3RlIHNlcnZpw6dvXG4gIC8vICAgIDIgLSBQcm9jdXJhIG5vIGxvY2FsIHN0b3JhZ2UgKFNlIG8gY2FjaGUgZXN0aXZlciBkZWZpbmlkbyBjb21vIHRydWUgbmEgY29uZmlndXJhw6fDo28gZG8gbcOzZHVsbylcbiAgLy8gICAgMyAtIERpc3BhcmEgbyBzZXJ2acOnbywgbWVzbW8gcXVlIGrDoSB0ZW5oYSBlbmNvbnRyYWRvIG5vIGxvY2FsIHN0b3JhZ2UsIHBhcmEgZ2FyYW50aXIgYSBhdHVhbGl6YcOnw6NvXG4gIC8vICAgIDQgLSBTZSBuZW5odW1hIGxpdGVyYWwgZm9yIGVuY29udHJhZGEsIGVudMOjbyBidXNjYSBlbSBwdC1iclxuICBwcml2YXRlIGdldExpdGVyYWxzRnJvbUNvbnRleHRTZXJ2aWNlKFxuICAgIGxhbmd1YWdlOiBzdHJpbmcsXG4gICAgY29udGV4dDogc3RyaW5nLFxuICAgIGxpdGVyYWxzOiBBcnJheTxzdHJpbmc+LFxuICAgIG9ic2VydmVyOiBhbnksXG4gICAgdHJhbnNsYXRpb25zOiBhbnkgPSB7fSxcbiAgICBsYW5ndWFnZUFsdGVybmF0aXZlOiBzdHJpbmcgPSBudWxsXG4gICkge1xuICAgIC8vIElkaW9tYSB1c2FkbyBwYXJhIHRlbnRhciBidXNjYXIgYXMgbGl0ZXJhaXMgZmFsdGFudGVzXG4gICAgY29uc3QgbGFuZ3VhZ2VTZWFyY2ggPSBsYW5ndWFnZUFsdGVybmF0aXZlID8gbGFuZ3VhZ2VBbHRlcm5hdGl2ZSA6IGxhbmd1YWdlO1xuXG4gICAgdHJhbnNsYXRpb25zID0gdGhpcy5tZXJnZU9iamVjdCh0cmFuc2xhdGlvbnMsIHRoaXMuc2VhcmNoSW5WYXJJMThuKGxhbmd1YWdlU2VhcmNoLCBjb250ZXh0LCBsaXRlcmFscykpO1xuXG4gICAgaWYgKHRoaXMuY291bnRPYmplY3QodHJhbnNsYXRpb25zKSA+IDApIHtcbiAgICAgIG9ic2VydmVyLm5leHQodHJhbnNsYXRpb25zKTtcbiAgICB9XG5cbiAgICAvLyByZWFsaXphIGEgYnVzY2Egbm8gbG9jYWxTdG9yYWdlIGUgZW0gc2VndWlkYSBubyBzZXJ2acOnb1xuICAgIHRoaXMuZ2V0TGl0ZXJhbHNMb2NhbFN0b3JhZ2VBbmRDYWNoZShcbiAgICAgIGxhbmd1YWdlU2VhcmNoLFxuICAgICAgY29udGV4dCxcbiAgICAgIGxpdGVyYWxzLFxuICAgICAgb2JzZXJ2ZXIsXG4gICAgICB0cmFuc2xhdGlvbnMsXG4gICAgICBsYW5ndWFnZUFsdGVybmF0aXZlXG4gICAgKTtcbiAgfVxuXG4gIC8vIFByb2N1cmEgbm8gbG9jYWwgc3RvcmFnZSBlIGVtIHNlZ3VpZGEgbm8gc2VydmnDp29cbiAgLy8gQ2FzbyBuw6NvIGVuY29udHJlIG5lbSBubyBzZXJ2acOnbywgcmVjb21lw6dhIGEgYnVzY2EgZW0gcHQtYnJcbiAgcHJpdmF0ZSBnZXRMaXRlcmFsc0xvY2FsU3RvcmFnZUFuZENhY2hlKFxuICAgIGxhbmd1YWdlOiBzdHJpbmcsXG4gICAgY29udGV4dDogc3RyaW5nLFxuICAgIGxpdGVyYWxzOiBBcnJheTxzdHJpbmc+LFxuICAgIG9ic2VydmVyOiBhbnksXG4gICAgdHJhbnNsYXRpb25zOiBhbnksXG4gICAgbGFuZ3VhZ2VBbHRlcm5hdGl2ZTogc3RyaW5nID0gbnVsbFxuICApIHtcbiAgICBjb25zdCBsYW5ndWFnZVNlYXJjaCA9IGxhbmd1YWdlQWx0ZXJuYXRpdmUgPyBsYW5ndWFnZUFsdGVybmF0aXZlIDogbGFuZ3VhZ2U7XG4gICAgbGV0IHRyYW5zbGF0aW9uVGVtcDtcbiAgICAvLyBWZXJpZmljYSBzZSB1c2EgY2FjaGVcbiAgICBpZiAodGhpcy51c2VDYWNoZSkge1xuICAgICAgdHJhbnNsYXRpb25UZW1wID0gdGhpcy5zZWFyY2hJbkxvY2FsU3RvcmFnZShsYW5ndWFnZVNlYXJjaCwgY29udGV4dCwgbGl0ZXJhbHMpO1xuICAgICAgaWYgKHRoaXMuY291bnRPYmplY3QodHJhbnNsYXRpb25UZW1wKSA+IDApIHtcbiAgICAgICAgdGhpcy51cGRhdGVWYXJJMThuKGxhbmd1YWdlLCBjb250ZXh0LCB0cmFuc2xhdGlvblRlbXApO1xuICAgICAgICB0cmFuc2xhdGlvbnMgPSB0aGlzLm1lcmdlT2JqZWN0KHRyYW5zbGF0aW9uVGVtcCwgdHJhbnNsYXRpb25zKTtcbiAgICAgICAgb2JzZXJ2ZXIubmV4dCh0cmFuc2xhdGlvbnMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEJ1c2NhIGRvIFNlcnZpw6dvXG4gICAgdGhpcy5nZXRIdHRwU2VydmljZSh0aGlzLnNlcnZpY2VzQ29udGV4dFtjb250ZXh0XSwgbGFuZ3VhZ2VTZWFyY2gsIGxpdGVyYWxzKS5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgaWYgKHJlc3BvbnNlKSB7XG4gICAgICAgIHRoaXMudXBkYXRlTG9jYWxTdG9yYWdlKGxhbmd1YWdlLCBjb250ZXh0LCByZXNwb25zZSk7XG4gICAgICAgIHRoaXMudXBkYXRlVmFySTE4bihsYW5ndWFnZSwgY29udGV4dCwgcmVzcG9uc2UpO1xuICAgICAgICB0cmFuc2xhdGlvblRlbXAgPSB0aGlzLnNlYXJjaEluVmFySTE4bihsYW5ndWFnZSwgY29udGV4dCwgbGl0ZXJhbHMpO1xuICAgICAgICB0cmFuc2xhdGlvbnMgPSB0aGlzLm1lcmdlT2JqZWN0KHRyYW5zbGF0aW9uVGVtcCwgdHJhbnNsYXRpb25zKTtcbiAgICAgICAgb2JzZXJ2ZXIubmV4dCh0cmFuc2xhdGlvbnMpO1xuICAgICAgfVxuXG4gICAgICAvLyBTZSBuw6NvIGVuY29udHJvdSB0b2RhcyBhcyBsaXRlcmFpcyBwZXNxdWlzYWRhcyBubyBpZGlvbWFcbiAgICAgIC8vIEVudMOjbyByZWZheiBvIHByb2Nlc3NvIHByb2N1cmFuZG8gZW0gcG9ydHVndcOqc1xuICAgICAgaWYgKGxpdGVyYWxzLmxlbmd0aCA+IHRoaXMuY291bnRPYmplY3QodHJhbnNsYXRpb25zKSkge1xuICAgICAgICBpZiAobGFuZ3VhZ2VBbHRlcm5hdGl2ZSA9PT0gJ3B0LWJyJykge1xuICAgICAgICAgIC8vIFNlIG7Do28gZW5jb250cm91IG5lbSBlbSBwb3J0dWd1w6pzLCBlbnTDo28gcmV0b3JuYSBvIG5vbWUgZGFzIGxpdGVyYWlzXG4gICAgICAgICAgdHJhbnNsYXRpb25zID0gdGhpcy5jb21wbGV0ZUZhdWx0TGl0ZXJhbHMobGFuZ3VhZ2UsIGNvbnRleHQsIGxpdGVyYWxzLCB0cmFuc2xhdGlvbnMpO1xuICAgICAgICAgIHRoaXMudXBkYXRlTG9jYWxTdG9yYWdlKGxhbmd1YWdlLCBjb250ZXh0LCB0cmFuc2xhdGlvbnMpO1xuICAgICAgICAgIHRoaXMudXBkYXRlVmFySTE4bihsYW5ndWFnZSwgY29udGV4dCwgdHJhbnNsYXRpb25zKTtcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KHRyYW5zbGF0aW9ucyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5nZXRMaXRlcmFsc0Zyb21Db250ZXh0U2VydmljZShsYW5ndWFnZSwgY29udGV4dCwgbGl0ZXJhbHMsIG9ic2VydmVyLCB0cmFuc2xhdGlvbnMsICdwdC1icicpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBQcm9jdXJhIHBlbGEgbGlzdGEgZGUgbGl0ZXJhaXNcbiAgLy8gU2UgbsOjbyBlbmNvbnRyYXIgdG9kYXMsIHByb2N1cmEgZW0gcHQtYnJcbiAgcHJpdmF0ZSBnZXRMaXRlcmFsc0Zyb21Db250ZXh0Q29uc3RhbnQoXG4gICAgbGFuZ3VhZ2U6IHN0cmluZyxcbiAgICBjb250ZXh0OiBzdHJpbmcsXG4gICAgbGl0ZXJhbHM6IEFycmF5PHN0cmluZz4sXG4gICAgb2JzZXJ2ZXI6IGFueSxcbiAgICB0cmFuc2xhdGlvbnM6IGFueSA9IHt9XG4gICkge1xuICAgIHRyYW5zbGF0aW9ucyA9IHRoaXMubWVyZ2VPYmplY3QodHJhbnNsYXRpb25zLCB0aGlzLnNlYXJjaEluVmFySTE4bihsYW5ndWFnZSwgY29udGV4dCwgbGl0ZXJhbHMpKTtcbiAgICBpZiAodGhpcy5jb3VudE9iamVjdCh0cmFuc2xhdGlvbnMpID4gMCkge1xuICAgICAgb2JzZXJ2ZXIubmV4dCh0cmFuc2xhdGlvbnMpO1xuICAgIH1cblxuICAgIC8vIFNlIGZvaSBwZXNxdWlzYWRvIHBvciBsaXRlcmFpc1xuICAgIGlmIChsaXRlcmFscy5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBTZSBuw6NvIGVuY29udHJvdSB0b2RhcyBhcyBsaXRlcmFpcyBwZXNxdWlzYWRhcyBubyBpZGlvbWEsIHByb2N1cmEgZW0gcG9ydHVndcOqc1xuICAgICAgaWYgKGxpdGVyYWxzLmxlbmd0aCA+IHRoaXMuY291bnRPYmplY3QodHJhbnNsYXRpb25zKSkge1xuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09ICdwdC1icicpIHtcbiAgICAgICAgICAvLyBTZSBuw6NvIGVuY29udHJvdSBuZW0gZW0gcG9ydHVndcOqcywgZW50w6NvIHJldG9ybmEgbyBub21lIGRhcyBsaXRlcmFpc1xuICAgICAgICAgIHRyYW5zbGF0aW9ucyA9IHRoaXMuY29tcGxldGVGYXVsdExpdGVyYWxzKGxhbmd1YWdlLCBjb250ZXh0LCBsaXRlcmFscywgdHJhbnNsYXRpb25zKTtcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KHRyYW5zbGF0aW9ucyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5nZXRMaXRlcmFsc0Zyb21Db250ZXh0Q29uc3RhbnQoJ3B0LWJyJywgY29udGV4dCwgbGl0ZXJhbHMsIG9ic2VydmVyLCB0cmFuc2xhdGlvbnMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFNlIG7Do28gZW5jb250cmFyIG5lbmh1bWEgbGl0ZXJhbCwgcHJvY3VyYSBlbSBwb3J0dWd1w6pzXG4gICAgICBpZiAodGhpcy5jb3VudE9iamVjdCh0cmFuc2xhdGlvbnMpID09PSAwICYmIGxhbmd1YWdlICE9PSAncHQtYnInKSB7XG4gICAgICAgIHRoaXMuZ2V0TGl0ZXJhbHNGcm9tQ29udGV4dENvbnN0YW50KCdwdC1icicsIGNvbnRleHQsIGxpdGVyYWxzLCBvYnNlcnZlciwgdHJhbnNsYXRpb25zKTtcbiAgICAgIH1cblxuICAgICAgLy8gY2FzbyBuw6NvIGluZm9ybWFyIGxpdGVyYWlzIGUgbsOjbyBob3V2ZXIgdHJhZHXDp8Ojb1xuICAgICAgb2JzZXJ2ZXIubmV4dCh0cmFuc2xhdGlvbnMpO1xuICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICB9XG4gIH1cblxuICAvLyBCdXNjYSBwZWxhcyBsaXRlcmFpcyBubyBsb2NhbCBzdG9yYWdlXG4gIHByaXZhdGUgc2VhcmNoSW5Mb2NhbFN0b3JhZ2UobGFuZ3VhZ2U6IHN0cmluZywgY29udGV4dDogc3RyaW5nLCBsaXRlcmFsczogQXJyYXk8c3RyaW5nPik6IGFueSB7XG4gICAgY29uc3QgdHJhbnNsYXRpb25zOiBhbnkgPSB7fTtcblxuICAgIGlmIChsaXRlcmFscy5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpdGVyYWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGxpdGVyYWwgPSBsaXRlcmFsc1tpXTtcbiAgICAgICAgY29uc3QgdHJhbnNsYXRpb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShsYW5ndWFnZSArICctJyArIGNvbnRleHQgKyAnLScgKyBsaXRlcmFsKTtcbiAgICAgICAgaWYgKHRyYW5zbGF0aW9uKSB7XG4gICAgICAgICAgdHJhbnNsYXRpb25zW2xpdGVyYWxdID0gdHJhbnNsYXRpb247XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zbGF0aW9ucztcbiAgfVxuXG4gIC8vIEJ1c2NhIHBlbGFzIGxpdGVyYWlzIG5hIHZhcmnDoXZlbCBkbyBzZXJ2acOnb1xuICBwcml2YXRlIHNlYXJjaEluVmFySTE4bihsYW5ndWFnZTogc3RyaW5nLCBjb250ZXh0OiBzdHJpbmcsIGxpdGVyYWxzOiBBcnJheTxzdHJpbmc+KTogYW55IHtcbiAgICBsZXQgdHJhbnNsYXRpb25zOiBhbnkgPSB7fTtcblxuICAgIGlmICh0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdICYmIHRoaXMudmFySTE4bltsYW5ndWFnZV1bY29udGV4dF0pIHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdW2NvbnRleHRdO1xuXG4gICAgICBpZiAobGl0ZXJhbHMubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBCdXNjYSBhcyBsaXRlcmFpcyBkZXNlamFkYXNcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaXRlcmFscy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGNvbnN0IGxpdGVyYWwgPSBsaXRlcmFsc1tpXTtcbiAgICAgICAgICBpZiAoY29udGVudC5oYXNPd25Qcm9wZXJ0eShsaXRlcmFsKSkge1xuICAgICAgICAgICAgdHJhbnNsYXRpb25zW2xpdGVyYWxdID0gY29udGVudFtsaXRlcmFsXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEF0cmlidWkgdG9kYXMgYXMgbGl0ZXJhaXNcbiAgICAgICAgdHJhbnNsYXRpb25zID0geyAuLi5jb250ZW50IH07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cmFuc2xhdGlvbnM7XG4gIH1cblxuICAvLyBBdHVhbGl6YSBvIGxvY2FsIHN0b3JhZ2VcbiAgcHJpdmF0ZSB1cGRhdGVMb2NhbFN0b3JhZ2UobGFuZ3VhZ2U6IHN0cmluZywgY29udGV4dDogc3RyaW5nLCBkYXRhOiBhbnkpIHtcbiAgICBpZiAodGhpcy51c2VDYWNoZSkge1xuICAgICAgZm9yIChjb25zdCBsaXRlcmFsIG9mIE9iamVjdC5rZXlzKGRhdGEpKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGxhbmd1YWdlICsgJy0nICsgY29udGV4dCArICctJyArIGxpdGVyYWwsIGRhdGFbbGl0ZXJhbF0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIEF0dWFsaXphIGEgdmFyacOhdmVsIGxvY2FsIGNvbSBhcyBsaXRlcmFpcyBjb20gb3Mgb2JqZXRvcyBwYXNzYWRvcyBuYSBjb25maWd1cmHDp8Ojb1xuICBwcml2YXRlIHNldFZhckkxOG4oY29udGV4dHM6IE9iamVjdCkge1xuICAgIC8vIFBlcmNvcnJlIG9zIGNvbnRleHRvc1xuICAgIGZvciAoY29uc3QgY29udGV4dCBvZiBPYmplY3Qua2V5cyhjb250ZXh0cykpIHtcbiAgICAgIGNvbnN0IGNvbnRleHRDb250ZW50ID0gY29udGV4dHNbY29udGV4dF07XG4gICAgICAvLyBQZXJjb3JyZSBvcyBpZGlvbWFzIGRlbnRybyBkbyBjb250ZXh0b1xuICAgICAgZm9yIChjb25zdCBsYW5ndWFnZSBvZiBPYmplY3Qua2V5cyhjb250ZXh0Q29udGVudCkpIHtcbiAgICAgICAgY29uc3QgbGFuZ3VhZ2VDb250ZW50ID0gY29udGV4dENvbnRlbnRbbGFuZ3VhZ2VdO1xuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09ICd1cmwnKSB7XG4gICAgICAgICAgdGhpcy5zZXJ2aWNlc0NvbnRleHRbY29udGV4dF0gPSBsYW5ndWFnZUNvbnRlbnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVWYXJJMThuKGxhbmd1YWdlLCBjb250ZXh0LCBsYW5ndWFnZUNvbnRlbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gQXR1YWxpemEgYSB2YXJpw6F2ZWwgbG9jYWwgY29tIGFzIGxpdGVyYWlzIGlkaW9tYSBlIGNvbnRleHRvXG4gIHByaXZhdGUgdXBkYXRlVmFySTE4bihsYW5ndWFnZTogc3RyaW5nLCBjb250ZXh0OiBzdHJpbmcsIGRhdGE6IGFueSkge1xuICAgIGxhbmd1YWdlID0gbGFuZ3VhZ2UudG9Mb3dlckNhc2UoKTtcblxuICAgIGlmICghdGhpcy52YXJJMThuW2xhbmd1YWdlXSkge1xuICAgICAgdGhpcy52YXJJMThuW2xhbmd1YWdlXSA9IHsgW2NvbnRleHRdOiB7fSB9O1xuICAgIH1cbiAgICBpZiAoIXRoaXMudmFySTE4bltsYW5ndWFnZV1bY29udGV4dF0pIHtcbiAgICAgIHRoaXMudmFySTE4bltsYW5ndWFnZV1bY29udGV4dF0gPSB7fTtcbiAgICB9XG5cbiAgICAvLyBDcmlhIG91IGF0dWFsaXphIG8gY29udGV4dG8gZGVudHJvIGRvIHN0b3JhZ2VcbiAgICB0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdW2NvbnRleHRdID0gdGhpcy5tZXJnZU9iamVjdChkYXRhLCB0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdW2NvbnRleHRdKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0SHR0cFNlcnZpY2UodXJsOiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGxpdGVyYWxzOiBBcnJheTxzdHJpbmc+KSB7XG4gICAgbGV0IHBhcmFtID0gJz9sYW5ndWFnZT0nICsgbGFuZ3VhZ2U7XG4gICAgaWYgKGxpdGVyYWxzLmxlbmd0aCA+IDApIHtcbiAgICAgIHBhcmFtICs9ICcmbGl0ZXJhbHM9JyArIGxpdGVyYWxzLmpvaW4oKTtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgYSBiYXJyYSBmaW5hbCBkbyBlbmRlcmXDp29cbiAgICB1cmwgPSB1cmwucmVwbGFjZSgvXFwvJC8sICcnKTtcblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGAke3VybH0ke3BhcmFtfWApO1xuICB9XG5cbiAgLy8gQ29tcGxldGEgY29tIG8gbm9tZSBkYSBsaXRlcmFpcywgYXMgcXVlIG7Do28gZm9yYW0gZW5jb250cmFkYXNcbiAgcHJpdmF0ZSBjb21wbGV0ZUZhdWx0TGl0ZXJhbHMobGFuZ3VhZ2U6IHN0cmluZywgY29udGV4dDogc3RyaW5nLCBsaXRlcmFsczogQXJyYXk8c3RyaW5nPiwgdHJhbnNsYXRpb25zOiBhbnkpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpdGVyYWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBsaXRlcmFsID0gbGl0ZXJhbHNbaV07XG4gICAgICBpZiAoIXRyYW5zbGF0aW9uc1tsaXRlcmFsXSkge1xuICAgICAgICB0cmFuc2xhdGlvbnNbbGl0ZXJhbF0gPSBsaXRlcmFsO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJhbnNsYXRpb25zO1xuICB9XG5cbiAgLy8gQ29udGEgb3MgYXRyaWJ1dG9zIGRvIG9iamV0b1xuICBwcml2YXRlIGNvdW50T2JqZWN0KG9iajogb2JqZWN0KSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikubGVuZ3RoO1xuICB9XG5cbiAgLy8gRmF6IG8gbWVyZ2UgZG9zIG9iamV0b3MsIHNlbXByZSBkYW5kbyBwcmVmZXLDqm5jaWEgcGFyYSBvIHByaW1laXJvIG9iamV0byBkZSBwYXLDom1ldHJvXG4gIHByaXZhdGUgbWVyZ2VPYmplY3Qob2JqUGVybWFuZW50OiBhbnksIG9iajogYW55KSB7XG4gICAgcmV0dXJuIHsgLi4ub2JqLCAuLi5vYmpQZXJtYW5lbnQgfTtcbiAgfVxufVxuIl19