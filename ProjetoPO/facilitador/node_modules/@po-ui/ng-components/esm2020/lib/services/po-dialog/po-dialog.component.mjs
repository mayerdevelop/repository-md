import { Component, ViewChild } from '@angular/core';
import { poLocaleDefault } from '../po-language/po-language.constant';
import { PoDialogType } from './po-dialog.enum';
import { PoModalComponent } from '../../components/po-modal/po-modal.component';
import * as i0 from "@angular/core";
import * as i1 from "../po-language/po-language.service";
import * as i2 from "../../components/po-modal/po-modal.component";
export const poDialogAlertLiteralsDefault = {
    en: { ok: 'Ok' },
    es: { ok: 'Ok' },
    pt: { ok: 'Ok' },
    ru: { ok: 'Ок' }
};
export const poDialogConfirmLiteralsDefault = {
    en: { cancel: 'Cancel', confirm: 'Confirm' },
    es: { cancel: 'Cancelar', confirm: 'Confirmar' },
    pt: { cancel: 'Cancelar', confirm: 'Confirmar' },
    ru: { cancel: 'отменить', confirm: 'подтвердить' }
};
/**
 * @docsPrivate
 *
 * @description
 *
 * Componente que serve como container do po-dialog.service
 */
export class PoDialogComponent {
    constructor(languageService) {
        // Objeto primary do poModal
        this.primaryAction = { label: 'ok', action: () => { } };
        this.language = languageService.getShortLanguage();
    }
    ngOnDestroy() {
        this.closeSubscription.unsubscribe();
    }
    ngOnInit() {
        this.closeSubscription = this.poModal.onXClosed.subscribe(close => this.close(true));
    }
    // Fecha o poModal
    close(xClosed = false) {
        if (xClosed && this.closeAction) {
            this.closeAction();
        }
        this.poModal.close();
        this.destroy();
    }
    destroy() {
        if (this.componentRef) {
            this.componentRef.destroy();
        }
    }
    // Insere os valores recebidos de this.open para o poModal
    configDialog(primaryLabel, primaryAction, secondaryLabel, secondaryAction, closeAction) {
        this.primaryAction = {
            label: primaryLabel,
            action: () => {
                if (primaryAction) {
                    primaryAction();
                }
                this.close();
            }
        };
        if (secondaryLabel) {
            this.secondaryAction = {
                label: secondaryLabel,
                action: () => {
                    if (secondaryAction) {
                        secondaryAction();
                    }
                    this.close();
                }
            };
        }
        this.closeAction = closeAction;
    }
    // Insere os valores recebidos de po-dialog.service de acordo com o tipo de diálago solicitado
    open(dialogOptions, dialogType, componentRef) {
        this.title = dialogOptions.title;
        this.message = dialogOptions.message;
        this.componentRef = componentRef;
        this.setDialogLiterals(dialogOptions, dialogType);
        switch (dialogType) {
            case PoDialogType.Confirm: {
                this.configDialog(this.literalsConfirm.confirm, dialogOptions.confirm, this.literalsConfirm.cancel, dialogOptions.cancel, dialogOptions.close);
                break;
            }
            case PoDialogType.Alert: {
                this.configDialog(this.literalsAlert.ok, dialogOptions.ok);
                break;
            }
        }
        this.poModal.open();
    }
    setDialogLiterals(dialogOptions, dialogType) {
        const alertLiterals = poDialogAlertLiteralsDefault;
        const confirmLiterals = poDialogConfirmLiteralsDefault;
        const literals = dialogOptions.literals;
        if (dialogType === PoDialogType.Alert) {
            this.literalsAlert = { ...alertLiterals[poLocaleDefault], ...alertLiterals[this.language], ...literals };
        }
        else {
            this.literalsConfirm = {
                ...confirmLiterals[poLocaleDefault],
                ...confirmLiterals[this.language],
                ...literals
            };
        }
    }
}
PoDialogComponent.ɵfac = function PoDialogComponent_Factory(t) { return new (t || PoDialogComponent)(i0.ɵɵdirectiveInject(i1.PoLanguageService)); };
PoDialogComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoDialogComponent, selectors: [["ng-component"]], viewQuery: function PoDialogComponent_Query(rf, ctx) { if (rf & 1) {
        i0.ɵɵviewQuery(PoModalComponent, 7);
    } if (rf & 2) {
        let _t;
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.poModal = _t.first);
    } }, decls: 2, vars: 4, consts: [[3, "p-title", "p-primary-action", "p-secondary-action"], [3, "innerHtml"]], template: function PoDialogComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵelementStart(0, "po-modal", 0);
        i0.ɵɵelement(1, "div", 1);
        i0.ɵɵelementEnd();
    } if (rf & 2) {
        i0.ɵɵproperty("p-title", ctx.title)("p-primary-action", ctx.primaryAction)("p-secondary-action", ctx.secondaryAction);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("innerHtml", ctx.message, i0.ɵɵsanitizeHtml);
    } }, dependencies: [i2.PoModalComponent], encapsulation: 2 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoDialogComponent, [{
        type: Component,
        args: [{ template: "<po-modal [p-title]=\"title\" [p-primary-action]=\"primaryAction\" [p-secondary-action]=\"secondaryAction\">\n  <div [innerHtml]=\"message\"></div>\n</po-modal>\n" }]
    }], function () { return [{ type: i1.PoLanguageService }]; }, { poModal: [{
            type: ViewChild,
            args: [PoModalComponent, { static: true }]
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvc2VydmljZXMvcG8tZGlhbG9nL3BvLWRpYWxvZy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL3NlcnZpY2VzL3BvLWRpYWxvZy9wby1kaWFsb2cuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBbUMsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSXRGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQU90RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFFaEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOENBQThDLENBQUM7Ozs7QUFFaEYsTUFBTSxDQUFDLE1BQU0sNEJBQTRCLEdBQUc7SUFDMUMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDdkMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDdkMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDdkMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7Q0FDeEMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLDhCQUE4QixHQUFHO0lBQzVDLEVBQUUsRUFBMkIsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUU7SUFDckUsRUFBRSxFQUEyQixFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRTtJQUN6RSxFQUFFLEVBQTJCLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFO0lBQ3pFLEVBQUUsRUFBMkIsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUU7Q0FDNUUsQ0FBQztBQUVGOzs7Ozs7R0FNRztBQUtILE1BQU0sT0FBTyxpQkFBaUI7SUE4QjVCLFlBQVksZUFBa0M7UUFwQjlDLDRCQUE0QjtRQUM1QixrQkFBYSxHQUFrQixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFFLENBQUMsRUFBRSxDQUFDO1FBb0IvRCxJQUFJLENBQUMsUUFBUSxHQUFHLGVBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQ3JELENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxRQUFRO1FBQ04sSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN2RixDQUFDO0lBRUQsa0JBQWtCO0lBQ2xCLEtBQUssQ0FBQyxPQUFPLEdBQUcsS0FBSztRQUNuQixJQUFJLE9BQU8sSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQy9CLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUNwQjtRQUVELElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2pCLENBQUM7SUFFRCxPQUFPO1FBQ0wsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDN0I7SUFDSCxDQUFDO0lBRUQsMERBQTBEO0lBQzFELFlBQVksQ0FBQyxZQUFhLEVBQUUsYUFBYyxFQUFFLGNBQWUsRUFBRSxlQUFnQixFQUFFLFdBQVk7UUFDekYsSUFBSSxDQUFDLGFBQWEsR0FBRztZQUNuQixLQUFLLEVBQUUsWUFBWTtZQUNuQixNQUFNLEVBQUUsR0FBRyxFQUFFO2dCQUNYLElBQUksYUFBYSxFQUFFO29CQUNqQixhQUFhLEVBQUUsQ0FBQztpQkFDakI7Z0JBQ0QsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2YsQ0FBQztTQUNGLENBQUM7UUFFRixJQUFJLGNBQWMsRUFBRTtZQUNsQixJQUFJLENBQUMsZUFBZSxHQUFHO2dCQUNyQixLQUFLLEVBQUUsY0FBYztnQkFDckIsTUFBTSxFQUFFLEdBQUcsRUFBRTtvQkFDWCxJQUFJLGVBQWUsRUFBRTt3QkFDbkIsZUFBZSxFQUFFLENBQUM7cUJBQ25CO29CQUNELElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDZixDQUFDO2FBQ0YsQ0FBQztTQUNIO1FBRUQsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7SUFDakMsQ0FBQztJQUVELDhGQUE4RjtJQUM5RixJQUFJLENBQ0YsYUFBNEQsRUFDNUQsVUFBd0IsRUFDeEIsWUFBOEM7UUFFOUMsSUFBSSxDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMsS0FBSyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxPQUFPLEdBQUcsYUFBYSxDQUFDLE9BQU8sQ0FBQztRQUVyQyxJQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztRQUVqQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsYUFBYSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBRWxELFFBQVEsVUFBVSxFQUFFO1lBQ2xCLEtBQUssWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN6QixJQUFJLENBQUMsWUFBWSxDQUNmLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUNILGFBQWMsQ0FBQyxPQUFPLEVBQy9DLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxFQUNGLGFBQWMsQ0FBQyxNQUFNLEVBQ3JCLGFBQWMsQ0FBQyxLQUFLLENBQzlDLENBQUM7Z0JBQ0YsTUFBTTthQUNQO1lBQ0QsS0FBSyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3ZCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLEVBQXlCLGFBQWMsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDbkYsTUFBTTthQUNQO1NBQ0Y7UUFFRCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFFTyxpQkFBaUIsQ0FBQyxhQUE0RCxFQUFFLFVBQXdCO1FBQzlHLE1BQU0sYUFBYSxHQUFHLDRCQUE0QixDQUFDO1FBQ25ELE1BQU0sZUFBZSxHQUFHLDhCQUE4QixDQUFDO1FBQ3ZELE1BQU0sUUFBUSxHQUFHLGFBQWEsQ0FBQyxRQUFRLENBQUM7UUFFeEMsSUFBSSxVQUFVLEtBQUssWUFBWSxDQUFDLEtBQUssRUFBRTtZQUNyQyxJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsR0FBRyxhQUFhLENBQUMsZUFBZSxDQUFDLEVBQUUsR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEdBQUcsUUFBUSxFQUFFLENBQUM7U0FDMUc7YUFBTTtZQUNMLElBQUksQ0FBQyxlQUFlLEdBQUc7Z0JBQ3JCLEdBQUcsZUFBZSxDQUFDLGVBQWUsQ0FBQztnQkFDbkMsR0FBRyxlQUFlLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztnQkFDakMsR0FBRyxRQUFRO2FBQ1osQ0FBQztTQUNIO0lBQ0gsQ0FBQzs7a0ZBcElVLGlCQUFpQjtvRUFBakIsaUJBQWlCO3VCQUVqQixnQkFBZ0I7Ozs7O1FDMUM3QixtQ0FBc0c7UUFDcEcseUJBQWlDO1FBQ25DLGlCQUFXOztRQUZELG1DQUFpQix1Q0FBQSwyQ0FBQTtRQUNwQixlQUFxQjtRQUFyQiwwREFBcUI7O3VGRHVDZixpQkFBaUI7Y0FIN0IsU0FBUzs7b0VBS3VDLE9BQU87a0JBQXJELFNBQVM7bUJBQUMsZ0JBQWdCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBDb21wb25lbnRSZWYsIE9uRGVzdHJveSwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IHBvTG9jYWxlRGVmYXVsdCB9IGZyb20gJy4uL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLmNvbnN0YW50JztcblxuaW1wb3J0IHsgUG9MYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuLi9wby1sYW5ndWFnZS9wby1sYW5ndWFnZS5zZXJ2aWNlJztcblxuaW1wb3J0IHsgUG9EaWFsb2dBbGVydExpdGVyYWxzIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLWRpYWxvZy1hbGVydC1saXRlcmFscy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9EaWFsb2dBbGVydE9wdGlvbnMsIFBvRGlhbG9nQ29uZmlybU9wdGlvbnMgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tZGlhbG9nLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0RpYWxvZ0NvbmZpcm1MaXRlcmFscyB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1kaWFsb2ctY29uZmlybS1saXRlcmFscy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9EaWFsb2dUeXBlIH0gZnJvbSAnLi9wby1kaWFsb2cuZW51bSc7XG5pbXBvcnQgeyBQb01vZGFsQWN0aW9uIH0gZnJvbSAnLi4vLi4vY29tcG9uZW50cy9wby1tb2RhbC9wby1tb2RhbC1hY3Rpb24uaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvTW9kYWxDb21wb25lbnQgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL3BvLW1vZGFsL3BvLW1vZGFsLmNvbXBvbmVudCc7XG5cbmV4cG9ydCBjb25zdCBwb0RpYWxvZ0FsZXJ0TGl0ZXJhbHNEZWZhdWx0ID0ge1xuICBlbjogPFBvRGlhbG9nQWxlcnRMaXRlcmFscz57IG9rOiAnT2snIH0sXG4gIGVzOiA8UG9EaWFsb2dBbGVydExpdGVyYWxzPnsgb2s6ICdPaycgfSxcbiAgcHQ6IDxQb0RpYWxvZ0FsZXJ0TGl0ZXJhbHM+eyBvazogJ09rJyB9LFxuICBydTogPFBvRGlhbG9nQWxlcnRMaXRlcmFscz57IG9rOiAn0J7QuicgfVxufTtcblxuZXhwb3J0IGNvbnN0IHBvRGlhbG9nQ29uZmlybUxpdGVyYWxzRGVmYXVsdCA9IHtcbiAgZW46IDxQb0RpYWxvZ0NvbmZpcm1MaXRlcmFscz57IGNhbmNlbDogJ0NhbmNlbCcsIGNvbmZpcm06ICdDb25maXJtJyB9LFxuICBlczogPFBvRGlhbG9nQ29uZmlybUxpdGVyYWxzPnsgY2FuY2VsOiAnQ2FuY2VsYXInLCBjb25maXJtOiAnQ29uZmlybWFyJyB9LFxuICBwdDogPFBvRGlhbG9nQ29uZmlybUxpdGVyYWxzPnsgY2FuY2VsOiAnQ2FuY2VsYXInLCBjb25maXJtOiAnQ29uZmlybWFyJyB9LFxuICBydTogPFBvRGlhbG9nQ29uZmlybUxpdGVyYWxzPnsgY2FuY2VsOiAn0L7RgtC80LXQvdC40YLRjCcsIGNvbmZpcm06ICfQv9C+0LTRgtCy0LXRgNC00LjRgtGMJyB9XG59O1xuXG4vKipcbiAqIEBkb2NzUHJpdmF0ZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIENvbXBvbmVudGUgcXVlIHNlcnZlIGNvbW8gY29udGFpbmVyIGRvIHBvLWRpYWxvZy5zZXJ2aWNlXG4gKi9cblxuQENvbXBvbmVudCh7XG4gIHRlbXBsYXRlVXJsOiAnLi9wby1kaWFsb2cuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFBvRGlhbG9nQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95LCBPbkluaXQge1xuICAvLyBWaWV3Q2hpbGQgcGFyYSBvIHVzbyBkbyBwby1tb2RhbC5jb21wb25lbnRcbiAgQFZpZXdDaGlsZChQb01vZGFsQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSBwb01vZGFsOiBQb01vZGFsQ29tcG9uZW50O1xuXG4gIC8vIFRpdGxlIGRvIHBvTW9kYWxcbiAgdGl0bGU6IHN0cmluZztcblxuICAvLyBNZXNzYWdlIGRvIHBvTW9kYWxcbiAgbWVzc2FnZTogc3RyaW5nO1xuXG4gIC8vIE9iamV0byBwcmltYXJ5IGRvIHBvTW9kYWxcbiAgcHJpbWFyeUFjdGlvbjogUG9Nb2RhbEFjdGlvbiA9IHsgbGFiZWw6ICdvaycsIGFjdGlvbjogKCkgPT4ge30gfTtcblxuICAvLyBPYmpldG8gc2Vjb25kYXJ5IGRvIHBvTW9kYWxcbiAgc2Vjb25kYXJ5QWN0aW9uOiBQb01vZGFsQWN0aW9uO1xuXG4gIC8vIENhbGxiYWNrIGV4ZWN1dGFkbyBhbyBmZWNoYXIgbyBwb01vZGFsXG4gIGNsb3NlQWN0aW9uOiBGdW5jdGlvbjtcblxuICAvLyBMaXRlcmFpcyB1c2FkYXMgbm9zIGJvdMOjbyBkZSBhbGVydGEgZG8gcG9Nb2RhbFxuICBsaXRlcmFsc0FsZXJ0OiBQb0RpYWxvZ0FsZXJ0TGl0ZXJhbHM7XG5cbiAgLy8gTGl0ZXJhaXMgdXNhZGFzIG5vcyBib3TDtWVzIGRlIGNvbmZpcm1hw6fDo28gZG8gcG9Nb2RhbFxuICBsaXRlcmFsc0NvbmZpcm06IFBvRGlhbG9nQ29uZmlybUxpdGVyYWxzO1xuXG4gIC8vIEF0cmlidXRvIHBhcmEgYXJtYXplbmFyIGEgcmVmZXJlbmNpYSBkbyBjb21wb25lbnRlIGNyaWFkbyB2aWEgc2VydmnDp28uXG4gIHByaXZhdGUgY29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8UG9EaWFsb2dDb21wb25lbnQ+O1xuICBwcml2YXRlIGNsb3NlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgbGFuZ3VhZ2U6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihsYW5ndWFnZVNlcnZpY2U6IFBvTGFuZ3VhZ2VTZXJ2aWNlKSB7XG4gICAgdGhpcy5sYW5ndWFnZSA9IGxhbmd1YWdlU2VydmljZS5nZXRTaG9ydExhbmd1YWdlKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmNsb3NlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmNsb3NlU3Vic2NyaXB0aW9uID0gdGhpcy5wb01vZGFsLm9uWENsb3NlZC5zdWJzY3JpYmUoY2xvc2UgPT4gdGhpcy5jbG9zZSh0cnVlKSk7XG4gIH1cblxuICAvLyBGZWNoYSBvIHBvTW9kYWxcbiAgY2xvc2UoeENsb3NlZCA9IGZhbHNlKTogdm9pZCB7XG4gICAgaWYgKHhDbG9zZWQgJiYgdGhpcy5jbG9zZUFjdGlvbikge1xuICAgICAgdGhpcy5jbG9zZUFjdGlvbigpO1xuICAgIH1cblxuICAgIHRoaXMucG9Nb2RhbC5jbG9zZSgpO1xuICAgIHRoaXMuZGVzdHJveSgpO1xuICB9XG5cbiAgZGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcbiAgICAgIHRoaXMuY29tcG9uZW50UmVmLmRlc3Ryb3koKTtcbiAgICB9XG4gIH1cblxuICAvLyBJbnNlcmUgb3MgdmFsb3JlcyByZWNlYmlkb3MgZGUgdGhpcy5vcGVuIHBhcmEgbyBwb01vZGFsXG4gIGNvbmZpZ0RpYWxvZyhwcmltYXJ5TGFiZWw/LCBwcmltYXJ5QWN0aW9uPywgc2Vjb25kYXJ5TGFiZWw/LCBzZWNvbmRhcnlBY3Rpb24/LCBjbG9zZUFjdGlvbj8pIHtcbiAgICB0aGlzLnByaW1hcnlBY3Rpb24gPSB7XG4gICAgICBsYWJlbDogcHJpbWFyeUxhYmVsLFxuICAgICAgYWN0aW9uOiAoKSA9PiB7XG4gICAgICAgIGlmIChwcmltYXJ5QWN0aW9uKSB7XG4gICAgICAgICAgcHJpbWFyeUFjdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKHNlY29uZGFyeUxhYmVsKSB7XG4gICAgICB0aGlzLnNlY29uZGFyeUFjdGlvbiA9IHtcbiAgICAgICAgbGFiZWw6IHNlY29uZGFyeUxhYmVsLFxuICAgICAgICBhY3Rpb246ICgpID0+IHtcbiAgICAgICAgICBpZiAoc2Vjb25kYXJ5QWN0aW9uKSB7XG4gICAgICAgICAgICBzZWNvbmRhcnlBY3Rpb24oKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cblxuICAgIHRoaXMuY2xvc2VBY3Rpb24gPSBjbG9zZUFjdGlvbjtcbiAgfVxuXG4gIC8vIEluc2VyZSBvcyB2YWxvcmVzIHJlY2ViaWRvcyBkZSBwby1kaWFsb2cuc2VydmljZSBkZSBhY29yZG8gY29tIG8gdGlwbyBkZSBkacOhbGFnbyBzb2xpY2l0YWRvXG4gIG9wZW4oXG4gICAgZGlhbG9nT3B0aW9uczogUG9EaWFsb2dDb25maXJtT3B0aW9ucyB8IFBvRGlhbG9nQWxlcnRPcHRpb25zLFxuICAgIGRpYWxvZ1R5cGU6IFBvRGlhbG9nVHlwZSxcbiAgICBjb21wb25lbnRSZWY/OiBDb21wb25lbnRSZWY8UG9EaWFsb2dDb21wb25lbnQ+XG4gICk6IHZvaWQge1xuICAgIHRoaXMudGl0bGUgPSBkaWFsb2dPcHRpb25zLnRpdGxlO1xuICAgIHRoaXMubWVzc2FnZSA9IGRpYWxvZ09wdGlvbnMubWVzc2FnZTtcblxuICAgIHRoaXMuY29tcG9uZW50UmVmID0gY29tcG9uZW50UmVmO1xuXG4gICAgdGhpcy5zZXREaWFsb2dMaXRlcmFscyhkaWFsb2dPcHRpb25zLCBkaWFsb2dUeXBlKTtcblxuICAgIHN3aXRjaCAoZGlhbG9nVHlwZSkge1xuICAgICAgY2FzZSBQb0RpYWxvZ1R5cGUuQ29uZmlybToge1xuICAgICAgICB0aGlzLmNvbmZpZ0RpYWxvZyhcbiAgICAgICAgICB0aGlzLmxpdGVyYWxzQ29uZmlybS5jb25maXJtLFxuICAgICAgICAgICg8UG9EaWFsb2dDb25maXJtT3B0aW9ucz5kaWFsb2dPcHRpb25zKS5jb25maXJtLFxuICAgICAgICAgIHRoaXMubGl0ZXJhbHNDb25maXJtLmNhbmNlbCxcbiAgICAgICAgICAoPFBvRGlhbG9nQ29uZmlybU9wdGlvbnM+ZGlhbG9nT3B0aW9ucykuY2FuY2VsLFxuICAgICAgICAgICg8UG9EaWFsb2dDb25maXJtT3B0aW9ucz5kaWFsb2dPcHRpb25zKS5jbG9zZVxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgUG9EaWFsb2dUeXBlLkFsZXJ0OiB7XG4gICAgICAgIHRoaXMuY29uZmlnRGlhbG9nKHRoaXMubGl0ZXJhbHNBbGVydC5vaywgKDxQb0RpYWxvZ0FsZXJ0T3B0aW9ucz5kaWFsb2dPcHRpb25zKS5vayk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMucG9Nb2RhbC5vcGVuKCk7XG4gIH1cblxuICBwcml2YXRlIHNldERpYWxvZ0xpdGVyYWxzKGRpYWxvZ09wdGlvbnM6IFBvRGlhbG9nQ29uZmlybU9wdGlvbnMgfCBQb0RpYWxvZ0FsZXJ0T3B0aW9ucywgZGlhbG9nVHlwZTogUG9EaWFsb2dUeXBlKSB7XG4gICAgY29uc3QgYWxlcnRMaXRlcmFscyA9IHBvRGlhbG9nQWxlcnRMaXRlcmFsc0RlZmF1bHQ7XG4gICAgY29uc3QgY29uZmlybUxpdGVyYWxzID0gcG9EaWFsb2dDb25maXJtTGl0ZXJhbHNEZWZhdWx0O1xuICAgIGNvbnN0IGxpdGVyYWxzID0gZGlhbG9nT3B0aW9ucy5saXRlcmFscztcblxuICAgIGlmIChkaWFsb2dUeXBlID09PSBQb0RpYWxvZ1R5cGUuQWxlcnQpIHtcbiAgICAgIHRoaXMubGl0ZXJhbHNBbGVydCA9IHsgLi4uYWxlcnRMaXRlcmFsc1twb0xvY2FsZURlZmF1bHRdLCAuLi5hbGVydExpdGVyYWxzW3RoaXMubGFuZ3VhZ2VdLCAuLi5saXRlcmFscyB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxpdGVyYWxzQ29uZmlybSA9IHtcbiAgICAgICAgLi4uY29uZmlybUxpdGVyYWxzW3BvTG9jYWxlRGVmYXVsdF0sXG4gICAgICAgIC4uLmNvbmZpcm1MaXRlcmFsc1t0aGlzLmxhbmd1YWdlXSxcbiAgICAgICAgLi4ubGl0ZXJhbHNcbiAgICAgIH07XG4gICAgfVxuICB9XG59XG4iLCI8cG8tbW9kYWwgW3AtdGl0bGVdPVwidGl0bGVcIiBbcC1wcmltYXJ5LWFjdGlvbl09XCJwcmltYXJ5QWN0aW9uXCIgW3Atc2Vjb25kYXJ5LWFjdGlvbl09XCJzZWNvbmRhcnlBY3Rpb25cIj5cbiAgPGRpdiBbaW5uZXJIdG1sXT1cIm1lc3NhZ2VcIj48L2Rpdj5cbjwvcG8tbW9kYWw+XG4iXX0=