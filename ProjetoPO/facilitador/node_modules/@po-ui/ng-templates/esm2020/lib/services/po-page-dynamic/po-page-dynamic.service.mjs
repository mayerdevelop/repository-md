import { Injectable } from '@angular/core';
import { HttpHeaders } from '@angular/common/http';
import { merge, of, throwError } from 'rxjs';
import { map, catchError } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@po-ui/ng-components";
export const poPageDynamicLiterals = {
    en: {
        errorRenderPage: 'Error loading page',
        notPossibleLoadMetadataPage: 'The page metadata could not be loaded'
    },
    es: {
        errorRenderPage: 'Error al cargar la página',
        notPossibleLoadMetadataPage: 'No se pudieron cargar los metadatos de la página.'
    },
    pt: {
        errorRenderPage: 'Erro ao carregar a página',
        notPossibleLoadMetadataPage: 'Não foi possível carregar os metadados da página'
    },
    ru: {
        errorRenderPage: 'Ошибка загрузки страницы',
        notPossibleLoadMetadataPage: 'Не удалось загрузить метаданные страницы'
    }
};
export class PoPageDynamicService {
    constructor(http, notification, languageService) {
        this.http = http;
        this.notification = notification;
        this.headers = new HttpHeaders({
            'X-PO-SCREEN-LOCK': 'true'
        });
        this.endpoint = '/';
        this.language = languageService.getShortLanguage();
    }
    configServiceApi(config = {}) {
        this.endpoint = config.endpoint;
        this.metadata = config.metadata || this.metadata;
    }
    getMetadata(type = 'list') {
        const key = `${this.endpoint}-${type}-metadata`;
        const cache = JSON.parse(localStorage.getItem(key)) || {};
        const metadataUrlBase = this.metadata || `${this.endpoint}/metadata`;
        const url = `${metadataUrlBase}?type=${type}&version=${cache.version || ''}`;
        return this.http.get(url).pipe(map((response) => {
            if (response.version !== undefined && response.version === cache.version) {
                return cache;
            }
            localStorage.setItem(key, JSON.stringify(response));
            return { ...cache, ...response };
        }), catchError((error) => {
            if (Object.keys(cache).length) {
                return of(cache);
            }
            const { errorRenderPage, notPossibleLoadMetadataPage } = poPageDynamicLiterals[this.language];
            this.notification.warning(notPossibleLoadMetadataPage);
            return merge(of({ title: errorRenderPage }), throwError(error));
        }));
    }
    // Deleta um único recurso
    deleteResource(id, endpoint) {
        const localEndPoint = this.getLocalEndPoint(endpoint, true);
        const url = id ? `${localEndPoint}/${id}` : localEndPoint;
        return this.http.delete(url, { headers: this.headers });
    }
    // Deleta recursos em lote
    deleteResources(ids, endpoint) {
        return this.http.request('delete', `${this.getLocalEndPoint(endpoint)}`, { headers: this.headers, body: ids });
    }
    // Busca uma lista de recursos
    getResources(params, endpoint) {
        return this.http.get(this.getLocalEndPoint(endpoint), { headers: this.headers, params });
    }
    // Busca um único recurso
    getResource(id, endpoint) {
        return this.http.get(`${this.getLocalEndPoint(endpoint, true)}/${id}`, { headers: this.headers });
    }
    // Cria um recurso
    createResource(resource, endpoint) {
        return this.http.post(`${this.getLocalEndPoint(endpoint)}`, resource, { headers: this.headers });
    }
    // Atualiza um recurso
    updateResource(id, resource, endpoint) {
        return this.http.put(`${this.getLocalEndPoint(endpoint, true)}/${id}`, resource, { headers: this.headers });
    }
    getLocalEndPoint(endpoint, checkSingleBar = false) {
        endpoint = endpoint ?? this.endpoint;
        if (checkSingleBar) {
            endpoint = endpoint === '/' ? '' : endpoint;
        }
        return endpoint;
    }
}
PoPageDynamicService.ɵfac = function PoPageDynamicService_Factory(t) { return new (t || PoPageDynamicService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.PoNotificationService), i0.ɵɵinject(i2.PoLanguageService)); };
PoPageDynamicService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: PoPageDynamicService, factory: PoPageDynamicService.ɵfac, providedIn: 'root' });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoPageDynamicService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: i1.HttpClient }, { type: i2.PoNotificationService }, { type: i2.PoLanguageService }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1keW5hbWljLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy90ZW1wbGF0ZXMvc3JjL2xpYi9zZXJ2aWNlcy9wby1wYWdlLWR5bmFtaWMvcG8tcGFnZS1keW5hbWljLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQWlDLFdBQVcsRUFBYyxNQUFNLHNCQUFzQixDQUFDO0FBRTlGLE9BQU8sRUFBRSxLQUFLLEVBQWMsRUFBRSxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN6RCxPQUFPLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7O0FBTWpELE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUE2QztJQUM3RSxFQUFFLEVBQUU7UUFDRixlQUFlLEVBQUUsb0JBQW9CO1FBQ3JDLDJCQUEyQixFQUFFLHVDQUF1QztLQUNyRTtJQUNELEVBQUUsRUFBRTtRQUNGLGVBQWUsRUFBRSwyQkFBMkI7UUFDNUMsMkJBQTJCLEVBQUUsbURBQW1EO0tBQ2pGO0lBQ0QsRUFBRSxFQUFFO1FBQ0YsZUFBZSxFQUFFLDJCQUEyQjtRQUM1QywyQkFBMkIsRUFBRSxrREFBa0Q7S0FDaEY7SUFDRCxFQUFFLEVBQUU7UUFDRixlQUFlLEVBQUUsMEJBQTBCO1FBQzNDLDJCQUEyQixFQUFFLDBDQUEwQztLQUN4RTtDQUNGLENBQUM7QUFLRixNQUFNLE9BQU8sb0JBQW9CO0lBUy9CLFlBQ1UsSUFBZ0IsRUFDaEIsWUFBbUMsRUFDM0MsZUFBa0M7UUFGMUIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUNoQixpQkFBWSxHQUFaLFlBQVksQ0FBdUI7UUFWcEMsWUFBTyxHQUFnQixJQUFJLFdBQVcsQ0FBQztZQUM5QyxrQkFBa0IsRUFBRSxNQUFNO1NBQzNCLENBQUMs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QUFjLEdBQUcsS0FBSztRQUNoRSxRQUFRLEdBQUcsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDckMsSUFBSSxjQUFjLEVBQUU7WUFDbEIsUUFBUSxHQUFHLFFBQVEsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO1NBQzdDO1FBQ0QsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQzs7d0ZBM0ZVLG9CQUFvQjswRUFBcEIsb0JBQW9CLFdBQXBCLG9CQUFvQixtQkFGbkIsTUFBTTt1RkFFUCxvQkFBb0I7Y0FIaEMsVUFBVTtlQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEVycm9yUmVzcG9uc2UsIEh0dHBIZWFkZXJzLCBIdHRwUGFyYW1zIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG5pbXBvcnQgeyBtZXJnZSwgT2JzZXJ2YWJsZSwgb2YsIHRocm93RXJyb3IgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgUG9MYW5ndWFnZVNlcnZpY2UsIFBvTm90aWZpY2F0aW9uU2VydmljZSB9IGZyb20gJ0Bwby11aS9uZy1jb21wb25lbnRzJztcblxuaW1wb3J0IHsgUG9QYWdlRHluYW1pY0xpdGVyYWxzIH0gZnJvbSAnLi9wby1wYWdlLWR5bmFtaWMtbGl0ZXJhbHMuaW50ZXJmYWNlJztcblxuZXhwb3J0IGNvbnN0IHBvUGFnZUR5bmFtaWNMaXRlcmFsczogeyBba2V5OiBzdHJpbmddOiBQb1BhZ2VEeW5hbWljTGl0ZXJhbHMgfSA9IHtcbiAgZW46IHtcbiAgICBlcnJvclJlbmRlclBhZ2U6ICdFcnJvciBsb2FkaW5nIHBhZ2UnLFxuICAgIG5vdFBvc3NpYmxlTG9hZE1ldGFkYXRhUGFnZTogJ1RoZSBwYWdlIG1ldGFkYXRhIGNvdWxkIG5vdCBiZSBsb2FkZWQnXG4gIH0sXG4gIGVzOiB7XG4gICAgZXJyb3JSZW5kZXJQYWdlOiAnRXJyb3IgYWwgY2FyZ2FyIGxhIHDDoWdpbmEnLFxuICAgIG5vdFBvc3NpYmxlTG9hZE1ldGFkYXRhUGFnZTogJ05vIHNlIHB1ZGllcm9uIGNhcmdhciBsb3MgbWV0YWRhdG9zIGRlIGxhIHDDoWdpbmEuJ1xuICB9LFxuICBwdDoge1xuICAgIGVycm9yUmVuZGVyUGFnZTogJ0Vycm8gYW8gY2FycmVnYXIgYSBww6FnaW5hJyxcbiAgICBub3RQb3NzaWJsZUxvYWRNZXRhZGF0YVBhZ2U6ICdOw6NvIGZvaSBwb3Nzw612ZWwgY2FycmVnYXIgb3MgbWV0YWRhZG9zIGRhIHDDoWdpbmEnXG4gIH0sXG4gIHJ1OiB7XG4gICAgZXJyb3JSZW5kZXJQYWdlOiAn0J7RiNC40LHQutCwINC30LDQs9GA0YPQt9C60Lgg0YHRgtGA0LDQvdC40YbRiycsXG4gICAgbm90UG9zc2libGVMb2FkTWV0YWRhdGFQYWdlOiAn0J3QtSDRg9C00LDQu9C+0YHRjCDQt9Cw0LPRgNGD0LfQuNGC0Ywg0LzQtdGC0LDQtNCw0L3QvdGL0LUg0YHRgtGA0LDQvdC40YbRiydcbiAgfVxufTtcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgUG9QYWdlRHluYW1pY1NlcnZpY2Uge1xuICByZWFkb25seSBoZWFkZXJzOiBIdHRwSGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycyh7XG4gICAgJ1gtUE8tU0NSRUVOLUxPQ0snOiAndHJ1ZSdcbiAgfSk7XG5cbiAgcHJpdmF0ZSBlbmRwb2ludCA9ICcvJztcbiAgcHJpdmF0ZSBsYW5ndWFnZTogc3RyaW5nO1xuICBwcml2YXRlIG1ldGFkYXRhOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgbm90aWZpY2F0aW9uOiBQb05vdGlmaWNhdGlvblNlcnZpY2UsXG4gICAgbGFuZ3VhZ2VTZXJ2aWNlOiBQb0xhbmd1YWdlU2VydmljZVxuICApIHtcbiAgICB0aGlzLmxhbmd1YWdlID0gbGFuZ3VhZ2VTZXJ2aWNlLmdldFNob3J0TGFuZ3VhZ2UoKTtcbiAgfVxuXG4gIGNvbmZpZ1NlcnZpY2VBcGkoY29uZmlnOiB7IGVuZHBvaW50Pzogc3RyaW5nOyBtZXRhZGF0YT86IHN0cmluZyB9ID0ge30pIHtcbiAgICB0aGlzLmVuZHBvaW50ID0gY29uZmlnLmVuZHBvaW50O1xuICAgIHRoaXMubWV0YWRhdGEgPSBjb25maWcubWV0YWRhdGEgfHwgdGhpcy5tZXRhZGF0YTtcbiAgfVxuXG4gIGdldE1ldGFkYXRhPFQ+KHR5cGU6IHN0cmluZyA9ICdsaXN0Jyk6IE9ic2VydmFibGU8VD4ge1xuICAgIGNvbnN0IGtleSA9IGAke3RoaXMuZW5kcG9pbnR9LSR7dHlwZX0tbWV0YWRhdGFgO1xuICAgIGNvbnN0IGNhY2hlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKSB8fCB7fTtcbiAgICBjb25zdCBtZXRhZGF0YVVybEJhc2UgPSB0aGlzLm1ldGFkYXRhIHx8IGAke3RoaXMuZW5kcG9pbnR9L21ldGFkYXRhYDtcblxuICAgIGNvbnN0IHVybCA9IGAke21ldGFkYXRhVXJsQmFzZX0/dHlwZT0ke3R5cGV9JnZlcnNpb249JHtjYWNoZS52ZXJzaW9uIHx8ICcnfWA7XG5cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxUPih1cmwpLnBpcGUoXG4gICAgICBtYXAoKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnZlcnNpb24gIT09IHVuZGVmaW5lZCAmJiByZXNwb25zZS52ZXJzaW9uID09PSBjYWNoZS52ZXJzaW9uKSB7XG4gICAgICAgICAgcmV0dXJuIGNhY2hlO1xuICAgICAgICB9XG5cbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeShyZXNwb25zZSkpO1xuXG4gICAgICAgIHJldHVybiB7IC4uLmNhY2hlLCAuLi5yZXNwb25zZSB9O1xuICAgICAgfSksXG4gICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKGNhY2hlKS5sZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4gb2YoY2FjaGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyBlcnJvclJlbmRlclBhZ2UsIG5vdFBvc3NpYmxlTG9hZE1ldGFkYXRhUGFnZSB9ID0gcG9QYWdlRHluYW1pY0xpdGVyYWxzW3RoaXMubGFuZ3VhZ2VdO1xuXG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9uLndhcm5pbmcobm90UG9zc2libGVMb2FkTWV0YWRhdGFQYWdlKTtcblxuICAgICAgICByZXR1cm4gbWVyZ2Uob2YoeyB0aXRsZTogZXJyb3JSZW5kZXJQYWdlIH0pLCB0aHJvd0Vycm9yKGVycm9yKSk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICAvLyBEZWxldGEgdW0gw7puaWNvIHJlY3Vyc29cbiAgZGVsZXRlUmVzb3VyY2UoaWQ/LCBlbmRwb2ludD86IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgY29uc3QgbG9jYWxFbmRQb2ludCA9IHRoaXMuZ2V0TG9jYWxFbmRQb2ludChlbmRwb2ludCwgdHJ1ZSk7XG4gICAgY29uc3QgdXJsID0gaWQgPyBgJHtsb2NhbEVuZFBvaW50fS8ke2lkfWAgOiBsb2NhbEVuZFBvaW50O1xuICAgIHJldHVybiB0aGlzLmh0dHAuZGVsZXRlKHVybCwgeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMgfSk7XG4gIH1cblxuICAvLyBEZWxldGEgcmVjdXJzb3MgZW0gbG90ZVxuICBkZWxldGVSZXNvdXJjZXMoaWRzOiBBcnJheTxhbnk+LCBlbmRwb2ludD86IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KCdkZWxldGUnLCBgJHt0aGlzLmdldExvY2FsRW5kUG9pbnQoZW5kcG9pbnQpfWAsIHsgaGVhZGVyczogdGhpcy5oZWFkZXJzLCBib2R5OiBpZHMgfSk7XG4gIH1cblxuICAvLyBCdXNjYSB1bWEgbGlzdGEgZGUgcmVjdXJzb3NcbiAgZ2V0UmVzb3VyY2VzKHBhcmFtcz86IEh0dHBQYXJhbXMsIGVuZHBvaW50Pzogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh0aGlzLmdldExvY2FsRW5kUG9pbnQoZW5kcG9pbnQpLCB7IGhlYWRlcnM6IHRoaXMuaGVhZGVycywgcGFyYW1zIH0pO1xuICB9XG5cbiAgLy8gQnVzY2EgdW0gw7puaWNvIHJlY3Vyc29cbiAgZ2V0UmVzb3VyY2UoaWQsIGVuZHBvaW50Pzogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldChgJHt0aGlzLmdldExvY2FsRW5kUG9pbnQoZW5kcG9pbnQsIHRydWUpfS8ke2lkfWAsIHsgaGVhZGVyczogdGhpcy5oZWFkZXJzIH0pO1xuICB9XG5cbiAgLy8gQ3JpYSB1bSByZWN1cnNvXG4gIGNyZWF0ZVJlc291cmNlKHJlc291cmNlLCBlbmRwb2ludD86IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KGAke3RoaXMuZ2V0TG9jYWxFbmRQb2ludChlbmRwb2ludCl9YCwgcmVzb3VyY2UsIHsgaGVhZGVyczogdGhpcy5oZWFkZXJzIH0pO1xuICB9XG5cbiAgLy8gQXR1YWxpemEgdW0gcmVjdXJzb1xuICB1cGRhdGVSZXNvdXJjZShpZCwgcmVzb3VyY2UsIGVuZHBvaW50Pzogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLnB1dChgJHt0aGlzLmdldExvY2FsRW5kUG9pbnQoZW5kcG9pbnQsIHRydWUpfS8ke2lkfWAsIHJlc291cmNlLCB7IGhlYWRlcnM6IHRoaXMuaGVhZGVycyB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TG9jYWxFbmRQb2ludChlbmRwb2ludD86IHN0cmluZywgY2hlY2tTaW5nbGVCYXIgPSBmYWxzZSkge1xuICAgIGVuZHBvaW50ID0gZW5kcG9pbnQgPz8gdGhpcy5lbmRwb2ludDtcbiAgICBpZiAoY2hlY2tTaW5nbGVCYXIpIHtcbiAgICAgIGVuZHBvaW50ID0gZW5kcG9pbnQgPT09ICcvJyA/ICcnIDogZW5kcG9pbnQ7XG4gICAgfVxuICAgIHJldHVybiBlbmRwb2ludDtcbiAgfVxufVxuIl19